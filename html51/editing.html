<!DOCTYPE html><html data-bug-component="HTML5 spec" data-bug-product="HTML WG" lang="ja"><meta charset="utf-8"><title>5 User interaction — （古）HTML 5.1 日本語訳
    </title><script src="js/bug-assist.js"></script>
<style type="text/css">
body {line-height:1.5}
     .applies thead th > * { display: block; }
     .applies thead code { display: block; }
     .applies tbody th { white-space: nowrap; }
     .applies td { text-align: center; }
     .applies .yes { background: yellow; }

     .matrix, .matrix td { border: hidden; text-align: right; }
     .matrix { margin-left: 2em; }

     .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
     .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
     .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

     td.eg { border-width: thin; text-align: center; }

     #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
     #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
     #table-example-1 caption { padding-bottom: 0.5em; }
     #table-example-1 thead, #table-example-1 tbody { border: none; }
     #table-example-1 th, #table-example-1 td { border: solid thin; }
     #table-example-1 th { font-weight: normal; }
     #table-example-1 td { border-style: none solid; vertical-align: top; }
     #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
     #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
     #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
     #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
     #table-example-1 tbody td:first-child::after { content: leader(". "); }
     #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
     #table-example-1 tbody td:first-child + td { width: 10em; }
     #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
     #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

     .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
     .apple-table-examples * { font-family: "Times", serif; }
     .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
     .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
     .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
     .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
     .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
     .apple-table-examples td { text-align: right; vertical-align: top; }
     .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
     .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
     .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
     .apple-table-examples sup { line-height: 0; }

     .details-example img { vertical-align: top; }

     #base64-table {
       white-space: nowrap;
       font-size: 0.6em;
       column-width: 6em;
       column-count: 5;
       column-gap: 1em;
       -moz-column-width: 6em;
       -moz-column-count: 5;
       -moz-column-gap: 1em;
       -webkit-column-width: 6em;
       -webkit-column-count: 5;
       -webkit-column-gap: 1em;
     }
     #base64-table thead { display: none; }
     #base64-table * { border: none; }
     #base64-table tbody td:first-child:after { content: ':'; }
     #base64-table tbody td:last-child { text-align: right; }

     #named-character-references-table {
       white-space: nowrap;
       font-size: 0.6em;
       column-width: 30em;
       column-gap: 1em;
       -moz-column-width: 30em;
       -moz-column-gap: 1em;
       -webkit-column-width: 30em;
       -webkit-column-gap: 1em;
     }
     #named-character-references-table > table > tbody > tr > td:first-child + td,
     #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
     #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
     #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

     .glyph.control { color: red; }

     @font-face {
       font-family: 'Essays1743';
       src: url('fonts/Essays1743.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-weight: bold;
       src: url('fonts/Essays1743-Bold.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       src: url('fonts/Essays1743-Italic.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       font-weight: bold;
       src: url('fonts/Essays1743-BoldItalic.ttf');
     }

    </style>
<style type="text/css">
       pre { margin-left: 2em; white-space: pre-wrap; }
       h2 { margin: 3em 0 1em 0; }
       h3 { margin: 2.5em 0 1em 0; }
       h4 { margin: 2.5em 0 0.75em 0; }
       h5, h6 { margin: 2.5em 0 1em; }
       h1 + h2, h1 + h2 + h2, h1 + p, h1 + p + h2 { margin: 0.75em 0 0.75em; }
       h2 + h3, h3 + h4, h4 + h5, h5 + h6 { margin-top: 0.5em; }
       p { margin: 1em 0; }
       hr:not(.top) { display: block; background: none; border: none; padding: 0; margin: 2em 0; height: auto; }
       .element dd,  .element dl { margin-top: 0em; margin-bottom: 0.25em;}
       dt { margin-top: 0.75em; margin-bottom: 0.5em; clear: left; }
        .element dt { margin-top: 0.5em; margin-bottom: 0.5em;  }
       dt + dt { margin-top: 0; }
       dd dt { margin-top: 0.25em; margin-bottom: 0; }
       dd p { margin-top: 0; }
       dd dl + p { margin-top: 1em; }
       dd table + p { margin-top: 1em; }
       p + * > li, dd li { margin: 1em 0; }
       dt, dfn { font-weight: bold; font-style: normal; }
       i, em { font-style: italic; }
       dt dfn { font-style: italic; }
       pre, code { font-size: inherit; font-family: monospace; font-variant: normal; }
       pre strong { color: black; font: inherit; font-weight: bold; background: yellow; }
       pre em { font-weight: bolder; font-style: normal; }
       @media screen { code { color: #D93B00; } code :link, code :visited { color: inherit; } }
       var { background-color: #f9f9f9; border: 1px solid #eee; padding: 0 2px; }
       var sub { vertical-align: bottom; font-size: smaller; position: relative; top: 0.1em; }
       table { border-collapse: collapse; border-style: hidden hidden none hidden; }
       table thead, table tbody { border-bottom: solid; }
       table tbody th:first-child { border-left: solid; }
       table tbody th { text-align: left; }
       table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
       blockquote { margin: 0 0 0 2em; border: 0; padding: 0; font-style: italic; }

       .bad, .bad *:not(.XXX) { color: #5F6D7A; border-color: gray; background: transparent; }
       .matrix, .matrix td { border: none; text-align: right; }
       .matrix { margin-left: 2em; }
       .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
       .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
       .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

       .toc dfn, h1 dfn, h2 dfn, h3 dfn, h4 dfn, h5 dfn, h6 dfn { font: inherit; }
       img.extra, p.overview { float: right; }
       pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
       pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
       pre.idl::before { content: "IDL"; font: bold small sans-serif; padding: 0.5em; background: white; position: absolute; top: 0; margin: -1px 0 0 -4em; width: 1.5em; border: thin solid; border-radius: 0 0 0 0.5em }
       pre.css { border: solid thin; background: #FFFFEE; color: black; padding: 0.5em 1em; }
       pre.css:first-line { color: #AAAA50; }
       dl.domintro {padding: 0.5em 1em; border: none; background:#E9FBE9; border: 1px solid lightgray; }
       hr + dl.domintro, div.impl + dl.domintro { margin-top: 2.5em; margin-bottom: 1.5em; }
       dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
       dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
       dl.domintro dd p { margin: 0.5em 0; }
       dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This definition is non-normative. Implementation requirements are given below this definition.'; color: #606060; border:1px solid lightgray; background: white; padding: 0 0.25em;font-size:.9em;}
       dl.switch { padding-left: 2em; }
       dl.switch > dt { text-indent: -1.5em; }
       dl.switch > dt:before { content: '\21AA'; padding: 0 0.5em 0 0; display: inline-block; width: 1em; text-align: right; line-height: 0.5em; }
       dl.triple { padding: 0 0 0 1em; }
       dl.triple dt, dl.triple dd { margin: 0; display: inline }
       dl.triple dt:after { content: ':'; }
       dl.triple dd:after { content: '\A'; white-space: pre; }
       .diff-old { text-decoration: line-through; color: silver; background: transparent; }
       .diff-chg, .diff-new { text-decoration: underline; color: green; background: transparent; }
       a .diff-new { border-bottom: 1px blue solid; }

       figure.diagrams { border: double black; background: white; padding: 1em; }
       figure.diagrams img { display: block; margin: 1em auto; } 

       h2 { page-break-before: always; }
       h1, h2, h3, h4, h5, h6 { page-break-after: avoid; }
       h1 + h2, hr + h2.no-toc { page-break-before: auto; }

       p  > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang]),
       li > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang])
       { border-bottom: solid #9999CC; }

       div.head { margin: 0 0 1em; padding: 1em 0 0 0; }
       div.head p { margin: 0; }
       div.head h1 { margin: 0; }
       div.head .logo { float: right; margin: 0 1em; }
       div.head .logo img { border: none } /* remove border from top image */
       div.head dl { margin: 1em 0; }
       div.head p.copyright, div.head p.alt { font-size: x-small; font-style: oblique; margin: 0; }

       body > .toc > li { margin-top: 1em; margin-bottom: 1em; }
       body > .toc.brief > li { margin-top: 0.35em; margin-bottom: 0.35em; }
       body > .toc > li > * { margin-bottom: 0.5em; }
       body > .toc > li > * > li > * { margin-bottom: 0.25em; }
       .toc, .toc li { list-style: none; }

       .brief { margin-top: 1em; margin-bottom: 1em; line-height: 1.1; }
       .brief li { margin: 0; padding: 0; }
       .brief li p { margin: 0; padding: 0; }

       .category-list { margin-top: -0.75em; margin-bottom: 1em; line-height: 1.5; }
       .category-list::before { content: '\21D2\A0'; font-size: 1.2em; font-weight: 900; }
       .category-list li { display: inline; }
       .category-list li:not(:last-child)::after { content: ', '; }
       .category-list li > span, .category-list li > a { text-transform: lowercase; }
       .category-list li * { text-transform: none; } /* don't affect <code> nested in <a> */

       .XXX { color: #E50000; background: white; border: solid red; padding: 0.5em; margin: 1em 0; }
       .XXX > :first-child { margin-top: 0; }
       p .XXX { line-height: 3em; }
       .annotation { border: solid thin black; background: #0C479D; color: white; position: relative; margin: 8px 0 20px 0; }
       .annotation:before { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 6px -6px -6px 6px; background: #333333; z-index: -1; content: ''; }
       .annotation :link, .annotation :visited { color: inherit; }
       .annotation :link:hover, .annotation :visited:hover { background: transparent; }
       .annotation span { border: none ! important; }
       .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
       .warning { background-color: #F9F0D4; border: medium double #FF0000; margin: 1em; padding: 1em; }
       .note em, .warning em, .note i, .warning i { font-style: normal; }
       p.note, div.note { padding: 0.5em 2em; }
       span.note { padding: 0 2em; }
       .note p:first-child, .warning p:first-child { margin-top: 0; }
       .note p:last-child, .warning p:last-child { margin-bottom: 0; }
       .warning:before { font-style: normal; }
       p.note:before { content: 'Note: '; font-weight: bolder;}
       p.warning:before { content: '\26A0 Warning! '; font-weight:bolder;}
       .critical {margin:1em; border:double red; padding:1em; background-color:#F9F0D4;}

       .bookkeeping:before { display: block; content: 'Bookkeeping details'; font-weight: bolder; font-style: italic; }
       .bookkeeping { font-size: 0.8em; margin: 2em 0; }
       .bookkeeping p { margin: 0.5em 2em; display: list-item; list-style: square; }
       .bookkeeping dt { margin: 0.5em 2em 0; }
       .bookkeeping dd { margin: 0 3em 0.5em; }

       h4 { position: relative; z-index: 3; }
       h4 + .element, h4 + div + .element { margin-top: -2.5em; padding-top: 2em; }
       .element {
         background: #F4F4FA;
         color: black;
         margin: 0 0 1em 0.15em;
         padding: 0 1em 0.25em 0.75em;
         border-left: solid #9999FF 0.25em;
         position: relative;
         z-index: 1;
       }
       .element:before {
         position: absolute;
         z-index: 2;
         top: 0;
         left: -1.15em;
         height: 2em;
         width: 0.9em;
         background: #F4F4FA;
         content: ' ';
         border-style: none none solid solid;
         border-color: #9999FF;
         border-width: 0.25em;
       }

       .example { display: block; color: #222222; background: #FCFCFC; border-left-style: solid;border-color:#c0c0c0; border-left-width: 0.25em; margin-left: 1em; padding-left: 1em;padding-bottom: 0.5em;}
       div.example:before { content: 'Code Example: '; font-weight: bolder;}
       td > .example:only-child { margin: 0 0 0 0.1em; }

       ul.domTree, ul.domTree ul { padding: 0 0 0 1em; margin: 0; }
       ul.domTree li { padding: 0; margin: 0; list-style: none; position: relative; }
       ul.domTree li li { list-style: none; }
       ul.domTree li:first-child::before { position: absolute; top: 0; height: 0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree li:not(:last-child)::after { position: absolute; top: 0; bottom: -0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree span { font-style: italic; font-family: serif; }
       ul.domTree .t1 code { color: purple; font-weight: bold; }
       ul.domTree .t2 { font-style: normal; font-family: monospace; }
       ul.domTree .t2 .name { color: black; font-weight: bold; }
       ul.domTree .t2 .value { color: blue; font-weight: normal; }
       ul.domTree .t3 code, .domTree .t4 code, .domTree .t5 code { color: gray; }
       ul.domTree .t7 code, .domTree .t8 code { color: green; }
       ul.domTree .t10 code { color: teal; }

       body.dfnEnabled dfn { cursor: pointer; }
       .dfnPanel {
         display: inline;
         position: absolute;
         z-index: 10;
         height: auto;
         width: auto;
         padding: 0.5em 0.75em;
         font: small sans-serif, Droid Sans Fallback;
         background: #DDDDDD;
         color: black;
         border: outset 0.2em;
       }
       .dfnPanel * { margin: 0; padding: 0; font: inherit; text-indent: 0; }
       .dfnPanel :link, .dfnPanel :visited { color: black; }
       .dfnPanel p { font-weight: bolder; }
       .dfnPanel * + p { margin-top: 0.25em; }
       .dfnPanel li { list-style-position: inside; }

       #configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
       #configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
       #configUI p label { display: block; }
       #configUI #updateUI, #configUI .loginUI { text-align: center; }
       #configUI input[type=button] { display: block; margin: auto; }

       fieldset { margin: 1em; padding: 0.5em 1em; }
       fieldset > legend + * { margin-top: 0; }
       fieldset > :last-child { margin-bottom: 0; }
       fieldset p { margin: 0.5em 0; }
       header p.subline {color:#005A9C; font: 140% sans-serif;margin: 0.75em 0;}
       #authorButton {overflow: visible; padding: 0.1em 0.3em; position: fixed; right: 2em; top: 6em; width: auto;}

       @media print {#authorButton { display:none;}}

  </style><!--<link href="switcher/W3C-ED-au.css" rel="stylesheet" type="text/css">--><link href="notice.css" rel="stylesheet"><link href="https://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css"><script>
   function getCookie(name) {
     var params = location.search.substr(1).split("&");
     for (var index = 0; index < params.length; index++) {
       if (params[index] == name)
         return "1";
       var data = params[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     var cookies = document.cookie.split("; ");
     for (var index = 0; index < cookies.length; index++) {
       var data = cookies[index].split("=");
       if (data[0] == name)
         return unescape(data[1]);
     }
     return null;
   }
  </script><!-- style switcher script by Stommepoes  --><link href="switcher/author-view.css" id="author-view" rel="alternate stylesheet" title="Author documentation only"><script src="switcher/authorstylesheet.js"></script><link href="disabled-elements.html" rel="prev" title="4.14 Disabled elements">
  <link href="Overview.html#contents" rel="contents" title="目次">
  <link href="browsers.html" rel="next" title="6 Loading Web pages">
  <body class="split chapter" onload="fixBrokenLink();"><div class="head" id="head">
<header><span id="styleSwitch"></span>
   <p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="http://www.w3.org/Icons/w3c_home" width="72"></a></p>

    <h1 id="big-title">HTML 5.1 日本語訳
    </h1>
    <p class="no-num no-toc subline">HTMLとXHTMLのための語彙と関連API</p>
   <p class="no-num no-toc subline">Editor's Draft 2 October 2014</p>
   </header></div>
  

  <nav class="prev_next">
   <a href="disabled-elements.html">← 4.14 Disabled elements</a> –
   <a href="Overview.html#contents">Table of contents</a> –
   <a href="browsers.html">6 Loading Web pages →</a>
  <ol class="toc"><li><a href="editing.html#editing"><span class="secno">5 </span>User interaction</a>
  <ol><li><a href="editing.html#the-hidden-attribute"><span class="secno">5.1 </span>The <code>hidden</code> attribute</a></li><li><a href="editing.html#inert-subtrees"><span class="secno">5.2</span> 不活性サブツリー</a></li><li><a href="editing.html#activation"><span class="secno">5.3</span> アクティベーション</a></li><li><a href="editing.html#focus"><span class="secno">5.4</span> フォーカス</a>
    <ol><li><a href="editing.html#introduction-4"><span class="secno">5.4.1</span> 導入</a></li><li><a href="editing.html#data-model"><span class="secno">5.4.2</span> データモデル</a></li><li><a href="editing.html#the-tabindex-attribute"><span class="secno">5.4.3 </span>The <code data-anolis-xref="attr-tabindex">tabindex</code> attribute</a></li><li><a href="editing.html#processing-model-4"><span class="secno">5.4.4 </span>Processing model</a></li><li><a href="editing.html#sequential-focus-navigation"><span class="secno">5.4.5 </span>Sequential focus navigation</a></li><li><a href="editing.html#focus-management-apis"><span class="secno">5.4.6</span> フォーカス管理API</a></li></ol></li><li><a href="editing.html#assigning-keyboard-shortcuts"><span class="secno">5.5</span> キーボードショートカットの割り当て</a>
    <ol><li><a href="editing.html#introduction-5"><span class="secno">5.5.1</span> 導入</a></li><li><a href="editing.html#the-accesskey-attribute"><span class="secno">5.5.2 </span>The <code>accesskey</code> attribute</a></li><li><a href="editing.html#processing-model-5"><span class="secno">5.5.3 </span>Processing model</a></li></ol></li><li><a href="editing.html#editing-0"><span class="secno">5.6</span> 編集</a>
    <ol><li><a href="editing.html#contenteditable"><span class="secno">5.6.1 </span>Making document regions editable: The <code data-anolis-xref="attr-contenteditable">contenteditable</code> content attribute</a></li><li><a href="editing.html#making-entire-documents-editable:-the-designmode-idl-attribute"><span class="secno">5.6.2 </span>Making entire documents editable: The <code data-anolis-xref="dom-document-designMode">designMode</code> IDL attribute</a></li><li><a href="editing.html#best-practices-for-in-page-editors"><span class="secno">5.6.3</span> ページ内編集者のためのベストプラクティス</a></li><li><a href="editing.html#editing-apis"><span class="secno">5.6.4</span> 編集API</a></li><li><a href="editing.html#spelling-and-grammar-checking"><span class="secno">5.6.5</span> スペルと文法チェック</a></li></ol></li><li><a href="editing.html#dnd"><span class="secno">5.7 </span>Drag and drop</a>
    <ol><li><a href="editing.html#introduction-6"><span class="secno">5.7.1</span> 導入</a></li><li><a href="editing.html#the-drag-data-store"><span class="secno">5.7.2</span> ドラッグデータストア</a></li><li><a href="editing.html#the-datatransfer-interface"><span class="secno">5.7.3 </span>The <code>DataTransfer</code> interface</a>
      <ol><li><a href="editing.html#the-datatransferitemlist-interface"><span class="secno">5.7.3.1 </span>The <code>DataTransferItemList</code> interface</a></li><li><a href="editing.html#the-datatransferitem-interface"><span class="secno">5.7.3.2 </span>The <code>DataTransferItem</code> interface</a></li></ol></li><li><a href="editing.html#the-dragevent-interface"><span class="secno">5.7.4 </span>The <code>DragEvent</code> interface</a></li><li><a href="editing.html#drag-and-drop-processing-model"><span class="secno">5.7.5 </span>Drag-and-drop processing model</a></li><li><a href="editing.html#dndevents"><span class="secno">5.7.6</span> イベントの概要</a></li><li><a href="editing.html#the-draggable-attribute"><span class="secno">5.7.7 </span>The <code>draggable</code> attribute</a></li><li><a href="editing.html#the-dropzone-attribute"><span class="secno">5.7.8 </span>The <code>dropzone</code> attribute</a></li><li><a href="editing.html#security-risks-in-the-drag-and-drop-model"><span class="secno">5.7.9 </span>Security risks in the drag-and-drop model</a></li></ol></li></ol></li></ol></nav>
<div> <input id=annoying-warning type=checkbox title="hide note"> <label for=annoying-warning>(隠す)</label> <div class=annoying-warning> <p>訳注: この文書は<strong><a href="https://www.w3.org/TR/html51/">HTML 5.1 Recommendation</a>の日本語訳ではありません</strong>。代わりに最新の<a href="https://www.w3.org/TR/html/">W3C HTML仕様</a>を参照ください。<p>この日本語訳は<strong>メンテナンスされていません</strong>。この翻訳文書の代わりに<a href="https://momdo.github.io/html/">WHATWG HTML日本語訳</a>を参照することができます。</div> </div>
  <h2 id="editing"><span class="secno">5</span> <dfn>ユーザーとの対話処理</dfn></h2>


  <h3 id="the-hidden-attribute"><span class="secno">5.1</span> <dfn data-anolis-xref="attr-hidden" id="attr-hidden"><code>hidden</code></dfn>属性</h3>

  <p>すべての<a href="infrastructure.html#html-elements">HTML要素</a>は<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>コンテンツ属性設定を持ってもよい。<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性は<a href="infrastructure.html#boolean-attribute">真偽属性</a>である。要素で指定される場合、それは、要素がまだないこと、またはもはやページの現在の状態には直接関係がない、または、ユーザーが直接アクセスするのとは対照的に、ページの他の部分で再利用するコンテンツを宣言するために使用されていることを示す。<span class="impl">User agents should not render elements that have the <code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code> attribute specified. This requirement may be implemented indirectly through the style layer. For example, an HTML+CSS user agent could implement these requirements <a href="rendering.html#hiddenCSS">using the rules suggested in the Rendering section</a>.</span></p>

  <p class="note">この属性は通常CSSを使用して実装されているため、CSSを使用して上書きすることもできる。たとえば、'display: block'をすべての要素に適用する規則は、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性の影響を相殺するだろう。したがって著者は、期待通りに属性がスタイル付けされていることを確認し、そのスタイルシートを書く際に注意する必要がある。</p>

  <div class="example">

   <p>以下の骨格の例において、属性は、ユーザーがログインするまでウェブゲームのメイン画面を非表示にするために使用される：</p>

   <pre>  &lt;h1&gt;The Example Game&lt;/h1&gt;
  &lt;section id="login"&gt;
   &lt;h2&gt;Login&lt;/h2&gt;
   &lt;form&gt;
    ...
    &lt;!-- calls login() once the user's credentials have been checked --&gt;
   &lt;/form&gt;
   &lt;script&gt;
    function login() {
      // switch screens
      document.getElementById('login').hidden = true;
      document.getElementById('game').hidden = false;
    }
   &lt;/script&gt;
  &lt;/section&gt;
  &lt;section id="game" hidden&gt;
   ...
  &lt;/section&gt;</pre>

  </div>

  <p><code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性は、別のプレゼンテーションに合法的に示すことができたコンテンツを隠すために使用されてはならない。たとえば、タブ付きインターフェースは単にオーバーフロープレゼンテーションの一種であるため、タブ付きダイアログでパネルを隠すために<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>を使用することは誤りである。―それはスクロールバーをもつ1つの大きなページ内のすべてのフォームコントロールを示すのと同様である。ちょうど1つのプレゼンテーションからコンテンツを非表示にするためにこの属性を使用することも同様に誤りである。―何かが<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>とマークされる場合、それは、たとえばプリンタなどを含む、すべてのプレゼンテーションから隠されている。</p><!--bug
  19406--><!-- for example, "<a hidden href=#content>Skip to content</a>" would be inappropriate. --><!-- (but only add that example if you first add some more good valid examples -->

  
  

  <p>自身が<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>でない要素は、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>である要素へ<a href="links.html#hyperlink">ハイパーリンク</a>されてはならない。自身が<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>でない<code><a href="forms.html#the-label-element">label</a></code>および<code><a href="forms.html#the-output-element">output</a></code>要素の<code data-anolis-xref="">for</code>属性も同様に、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>である要素を参照してはならない。どちらの場合も、このような参照はユーザーの混乱を引き起こすだろう。</p>

  <p>しかし、要素およびスクリプトは、他のコンテキストで<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>である要素を参照してもよい。</p>
  <div class="example">

   <p>たとえば、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性でマークされたセクションにリンクする<code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code>属性を使用するのは誤りだろう。コンテンツが適切または関連しない場合、それにリンクする理由はない。</p>

   <p>しかし、自身が<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>である説明を参照するために、ARIA <code data-anolis-xref="attr-aria-describedby">aria-describedby</code>属性を使用することは構わないだろう。説明を非表示にすることはそれらが単独で有用でないことを意味する一方で、それらは、それらが説明する画像から参照される特定のコンテキストにおいて有用である方法で記述することもできる。</p>

   <p>同様に、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性を持つ<code><a href="scripting-1.html#the-canvas-element">canvas</a></code>要素は、オフスクリーンバッファとしてスクリプト化されたグラフィックスエンジンによって使用されるかもしれず、フォームコントロールは、<code data-anolis-xref="attr-fae-form"><a href="forms.html#attr-fae-form">form</a></code>属性を使用する隠し<code><a href="forms.html#the-form-element">form</a></code>要素を参照するかもしれない。</p>

  </div>

  <p>アクセシビリティーAPIは、デフォルトのビューで非表示としてマークする間構造化されたコンテンツを公開する方法を提供することを推奨する。このようなコンテンツは、支援技術（AT）またはメインストリームのユーザーエージェントを使用しているかどうか、任意の様式で、通常の文書フローでユーザーに知覚できるようにすべきでない。</p>

  <p>このような機能が利用可能な際、このようなコンテンツが<a data-anolis-xref="concept-id" href="infrastructure.html#concept-id">ID参照</a>または<a href="infrastructure.html#valid-hash-name-reference">妥当なハッシュ名参照</a>によって間接的に参照されるならば、適切な場合に、ユーザーエージェントは、ATに<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>要素の完全なセマンティックを公開するためにそれらを使用してもよい。これは、通常のドキュメントフローに属するすべてのプレゼンテーションで隠されたコンテンツを維持しながら、ATが、ユーザーの要求に応じて、これらの<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>要素の構造にアクセスできる。<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>要素のユーザー起動の表示を防ぎたい著者は、そのような機構を持つ要素を参照すべきでない。</p>

  <p class="auth">ATへそのようなコンテンツを公開する際に一部のユーザーエージェントは非表示コンテンツを平坦化しているので、著者は、平坦化する際に不可欠な意味を失う<code title="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>内容を参照すべきでない。</p>

  <div class="example">

   <p>たとえば、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性でマークされたセクションにリンクする<code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code>属性を使用するのは誤りだろう。コンテンツが適切または関連しない場合、それにリンクする理由はない。</p>

   <p>しかし、自身が<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>である説明を参照するために、ARIA <code data-anolis-xref="attr-aria-describedby">aria-describedby</code>属性を使用することは構わないだろう。説明を非表示にすることはそれらが単独で有用でないことを意味する一方で、それらは、それらが説明する画像から参照される特定のコンテキストにおいて有用である方法で記述することもできる。</p>

   <p>同様に、<code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性を持つ<code><a href="scripting-1.html#the-canvas-element">canvas</a></code>要素は、オフスクリーンバッファとしてスクリプト化されたグラフィックスエンジンによって使用されるかもしれず、フォームコントロールは、<code data-anolis-xref="attr-fae-form"><a href="forms.html#attr-fae-form">form</a></code>属性を使用する隠し<code><a href="forms.html#the-form-element">form</a></code>要素を参照するかもしれない。</p>

  </div>

  <p><code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code>属性によって非表示にされたセクション内の要素は依然としてアクティブである。たとえば、そのようなセクションでのスクリプトやフォームコントロールは、依然として実行および送信する。それらのプレゼンテーションのみがユーザーに変更される。</p>

  <div class="impl">

  <p>The <dfn data-anolis-xref="dom-hidden" id="dom-hidden"><code>hidden</code></dfn> IDL attribute must <a href="infrastructure.html#reflect">reflect</a>
  the content attribute of the same name.</p>

  </div>



  <h3 id="inert-subtrees"><span class="secno">5.2</span> 不活性サブツリー</h3>

  <p>（特に要素やテキストノード）あるノードは<dfn id="inert">不活性</dfn>としてマークできる。ノードが<a href="#inert">不活性</a>であるとき、あたかもノードがユーザーインタラクションイベントを対象する目的のために不在であるかのように、ユーザーエージェントは動作しなければならず、テキスト検索ユーザーインターフェース（一般に"ページ内検索"として知られる）の目的に対してノードを無視してもよく、そのノード内のテキストの選択からユーザーを防いでもよい。しかし、ユーザーエージェントは、ユーザーが検索とテキスト選択に制限を上書きできるようにすべきである。</p>

  <p class="example">たとえば、<code><a href="sections.html#the-body-element">body</a></code>の中央に位置する単一の<a href="#inert">不活性</a>段落からなるページを考えてみる。ユーザーが<code><a href="sections.html#the-body-element">body</a></code>上から<a href="#inert">不活性</a>段落へポインティングデバイスを移動させ、段落上をクリックする場合、<code data-anolis-xref="event-mouseover"><a href="infrastructure.html#event-mouseover">mouseover</a></code>イベントは発火せず、<code data-anolis-xref="event-mousemove"><a href="infrastructure.html#event-mousemove">mousemove</a></code>および<code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code>イベントは段落よりむしろ<code><a href="sections.html#the-body-element">body</a></code>要素で発火するだろう。</p>

  <p class="note">ノードが不活性である場合、ノードは一般にフォーカスできない。<a data-anolis-xref="concept-command" href="interactive-elements.html#concept-command">コマンド</a>である不活性ノードはまた、無効であるだろう。</p>

  <p><a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>が<a href="#inert">不活性</a>としてマークされる間に、その<a href="browsers.html#nested-browsing-context">ネストされたブラウジングコンテキスト</a>の<a href="browsers.html#active-document">アクティブ文書</a>、およびその<code><a href="dom.html#document">Document</a></code>におけるすべてのノードは、<a href="#inert">不活性</a>としてマークされなければならない。</p>

  <p><code><a href="dom.html#document">Document</a></code>全体は、<dfn id="blocked-by-a-modal-dialog">モーダルダイアログダイアログによってブロックされる</dfn><var data-anolis-xref="">subject</var>としてマークできる。<code><a href="dom.html#document">Document</a></code>がそのようにマークされている一方で、<var data-anolis-xref="">subject</var>要素およびその子孫を除いて、<a data-anolis-xref="in a Document" href="infrastructure.html#in-a-document"><code>Document</code>内の</a>すべてのノードは、<a href="#inert">不活性</a>とマークされなければならない。（この段落で除外される要素は、さらに他の手段を介して<a href="#inert">不活性</a>にマークすることができる。モーダルダイアログの一部であることは<a href="#inert">不活性</a>とマークされることからノードを"守る"ことはない。）</p>

  <p>一度に1つのみ要素が<a href="#blocked-by-a-modal-dialog">モーダルダイアログによってブロック</a>されているとして<code><a href="dom.html#document">Document</a></code>をマークすることができる。新しい<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>が<code><a href="dom.html#document">Document</a></code>を<a data-anolis-xref="blocked by a modal
  dialog" href="#blocked-by-a-modal-dialog">ブロック</a>するために作成された場合、前の要素がもしあれば、<code><a href="dom.html#document">Document</a></code>のブロックを中止する。</p>

  <p class="note"><code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>要素の<code data-anolis-xref="dom-dialog-showModal"><a href="interactive-elements.html#dom-dialog-showmodal">showModal()</a></code>メソッドは、このメカニズムを利用する。</p>




  <h3 id="activation"><span class="secno">5.3</span> アクティベーション</h3>

  <p>HTMLの特定の要素は、ユーザーがアクティブにすることができることを意味する、<a href="#activation-behavior">アクティベーション動作</a>を持つ。This triggers a sequence of events dependent on the activation mechanism, and normally culminating in a <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event<span class="impl">, as described below</span>.</p>

  <div class="impl">

  <p>The user agent should allow the user to manually trigger elements that have an <a href="#activation-behavior">activation
  behavior</a>, for instance using keyboard or voice input, or through mouse clicks. When the
  user triggers an element with a defined <a href="#activation-behavior">activation behavior</a> in a manner other than
  clicking it, the default action of the interaction event must be to <a href="#run-synthetic-click-activation-steps">run synthetic click
  activation steps</a> on the element.</p><!-- interaction event spec point --> 

  <p>Each element has a <var data-anolis-xref="">click in progress</var> flag, initially set to false.</p>

  <p>When a user agent is to <dfn id="run-synthetic-click-activation-steps">run synthetic click activation steps</dfn> on an element, the user
  agent must run the following steps:</p>

  <ol><li><p>If the element's <var data-anolis-xref="">click in progress</var> flag is set to true, then abort
   these steps.</li>

   <li><p>Set the <var data-anolis-xref="">click in progress</var> flag on the element to true.</li>

   <li><p><a href="#run-pre-click-activation-steps">Run pre-click activation steps</a> on the element.</li>

   <li><p><a href="webappapis.html#fire-a-click-event">Fire a <code data-anolis-xref="event-click">click</code> event</a> at the element. If the
   <a href="#run-synthetic-click-activation-steps">run synthetic click activation steps</a> algorithm was invoked because the <code data-anolis-xref="dom-click"><a href="#dom-click">click()</a></code> method was invoked, then the <code data-anolis-xref="dom-event-isTrusted"><a href="infrastructure.html#dom-event-istrusted">isTrusted</a></code> attribute must be initialised to false.</li>

   <li>

    <p>If this <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event is not canceled, <a href="#run-post-click-activation-steps">run post-click
    activation steps</a> on the element.</p>

    <p>If the event <em>is</em> canceled, the user agent must <a href="#run-canceled-activation-steps">run canceled activation
    steps</a> on the element instead.</p>

   </li>

   <li><p>Set the <var data-anolis-xref="">click in progress</var> flag on the element to false.</li>

  </ol><p>When a pointing device is clicked, the user agent must <a href="#run-authentic-click-activation-steps">run authentic click activation
  steps</a> instead of firing the click event<!-- interaction event spec point --> When a user agent is to <dfn id="run-authentic-click-activation-steps">run authentic click activation steps</dfn> for a given event <var data-anolis-xref="">event</var>, it must follow these steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">target</var> be the element designated by the user (the target of <var data-anolis-xref="">event</var>).</li>

   <li><p>If <var data-anolis-xref="">target</var> is a <code><a href="scripting-1.html#the-canvas-element">canvas</a></code> element, run the <span>canvas
   <code><a href="infrastructure.html#mouseevent">MouseEvent</a></code> rerouting steps</span>. If this changes <var data-anolis-xref="">event</var>'s
   target, then let <var data-anolis-xref="">target</var> be the new target.</li><!--(this is commented out because you can't possibly get here reentrantly and you can't get here while click() is running.)
   <li><p>If <var data-x="">target</var>'s <var data-x="">click in progress</var> flag is set to
   true, then abort these steps.</p></li>
-->



   <li><p>Set the <var data-anolis-xref="">click in progress</var> flag on <var data-anolis-xref="">target</var> to
   true.</li>

   <li><p>Let <var data-anolis-xref="">e</var> be the <a href="#nearest-activatable-element">nearest activatable element</a> of <var data-anolis-xref="">target</var> (defined below), if any.</li>

   <li><p>If there is an element <var data-anolis-xref="">e</var>, <a href="#run-pre-click-activation-steps">run pre-click activation steps</a>
   on it.</li>

   <li>

    <p><a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">Dispatch</a> <var data-anolis-xref="">event</var> (the
    required <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event) at <var data-anolis-xref="">target</var>.</p><!--
    interaction event spec point --> 

    <p>If there is an element <var data-anolis-xref="">e</var> and the <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code>
    event is not canceled, <a href="#run-post-click-activation-steps">run post-click activation steps</a> on element <var data-anolis-xref="">e</var>.</p>

    <p>If there is an element <var data-anolis-xref="">e</var> and the event <em>is</em> canceled, <a href="#run-canceled-activation-steps">run
    canceled activation steps</a> on element <var data-anolis-xref="">e</var>.</p>

   </li>

   <li><p>Set the <var data-anolis-xref="">click in progress</var> flag on <var data-anolis-xref="">target</var> to
   false.</li>

  </ol><p class="note">The algorithms above don't run for arbitrary synthetic events dispatched by author
  script. The <code data-anolis-xref="dom-click"><a href="#dom-click">click()</a></code> method can be used to make the <a href="#run-synthetic-click-activation-steps">run
  synthetic click activation steps</a> algorithm happen programmatically.</p>

  <p class="note">Click-focusing behavior (e.g. the focusing of a text field when user clicks in
  one) typically happens before the click, when the mouse button is first depressed, and is
  therefore not discussed here.</p><!-- interaction event spec point --> 

  <p>Given an element <var data-anolis-xref="">target</var>, the <dfn id="nearest-activatable-element">nearest activatable element</dfn> is the
  element returned by the following algorithm:</p>

  <ol><li><p>If <var data-anolis-xref="">target</var> has a defined <a href="#activation-behavior">activation behavior</a>, then return
   <var data-anolis-xref="">target</var> and abort these steps.</li>

   <li><p>If <var data-anolis-xref="">target</var> has a parent element, then set <var data-anolis-xref="">target</var> to
   that parent element and return to the first step.</li>

   <li><p>Otherwise, there is no <a href="#nearest-activatable-element">nearest activatable element</a>.</li>

  </ol><p>When a user agent is to <dfn id="run-pre-click-activation-steps">run pre-click activation steps</dfn> on an element, it must run
  the <dfn id="pre-click-activation-steps">pre-click activation steps</dfn> defined for that element, if any.</p>

  <p>When a user agent is to <dfn id="run-canceled-activation-steps">run canceled activation steps</dfn> on an element, it must run the
  <dfn id="canceled-activation-steps">canceled activation steps</dfn> defined for that element, if any.</p>

  <p>When a user agent is to <dfn id="run-post-click-activation-steps">run post-click activation steps</dfn> on an element, it must run
  the <dfn id="activation-behavior">activation behavior</dfn> defined for that element, if any. Activation behaviors can
  refer to the <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event that was fired by the steps above
  leading up to this point.</p>

  </div><!--TOPIC:DOM APIs--><!-- v2 idea: HTMLImageElement.click(x, y); or clickPoint(), if click() can't be done in IE; can
       this be emulated in IE by posting a synthetic mouse click event with those X and Y coords?
       (ack Csaba Gabor)
  -->



  

  <dl class="domintro"><dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-click"><a href="#dom-click">click</a></code>()</dt>

   <dd>

    <p>あたかも要素をクリックされたかのように動作する。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-click" id="dom-click"><code>click()</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the element is a form control that is <a data-anolis-xref="concept-fe-disabled" href="forms.html#concept-fe-disabled">disabled</a>, abort these steps.</li>

   <li><p><a href="#run-synthetic-click-activation-steps">Run synthetic click activation steps</a> on the element.</li>

  </ol></div><!--TOPIC:HTML-->




  <h3 id="focus"><span class="secno">5.4</span> フォーカス</h3><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2807 --><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2811 --><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2809 --><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2812 --><!-- v2: more things to define, if no other specs define them:
   - define onfocus/onblur behaviour for Window
   - Other things to look at are IE's focus APIs (HTMLElement.setActive(),
     onBeforeActivate, onActivate, onBeforeDeactivate, onDeactivate):
       https://bugzilla.mozilla.org/show_bug.cgi?id=296471
       https://bugzilla.mozilla.org/show_bug.cgi?id=296469
       http://msdn.microsoft.com/workshop/author/dhtml/reference/methods/setactive.asp
       http://msdn.microsoft.com/workshop/author/dhtml/reference/events/onbeforeactivate.asp
  -->

  
  
  
  

  

  <h4 id="introduction-4"><span class="secno">5.4.1</span> 導入</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>HTMLユーザーインターフェースは典型的に、フォームコントロール、スクロール可能領域、リンク、ダイアログボックス、ブラウザタブなど、複数のインタラクティブウィジットから成る。これらウィジェットは、他（たとえば、リンク、フォームコントロール）を含むもの（たとえば、ブラウザタブ、ダイアログボックス）をもつ、階層構造を形成する。</p>

  <p>キーボードを使用するインターフェースと情報交換する場合、アクティブなウィジェットから、<i data-anolis-xref="">フォーカスされる</i>と呼ばれる、インタラクティブなウィジェットの階層構造を通して、キー入力はシステムから流れる。</p>

  <div class="example">

   <p>グラフィカル環境で動作するブラウザタブにおいて動作するHTMLアプリケーションを考えてみる。このアプリケーションが、いくつかのテキストフィールドおよびリンクをもつページを持ち、それ自身がテキストフィールドとボタンを持った、モーダルダイアログを表示していると想定する。</p>

   <p>このシナリオにおいて、その子の間でHTMLアプリケーションを含むブラウザタブを持つだろう、フォーカス可能なウィジェットの階層構造は、ブラウザウィンドウを含むかもしれない。タブ自身は、ダイアログと同様に、その子として、様々なリンクおよびテキストフィールドを持つだろう。ダイアログ自身は、その子として、テキストフィールドおよびボタンを持つだろう。</p>

   <p><!-- purely decorative: it repeats the previous
   paragraph, in graphical form --><img alt="" src="http://www.w3.org/TR/html51/images/focus-tree.png"><p>この例で<i>フォーカス</i>をもつウィジェットがダイアログボックスでテキストフィールドであった場合、キー入力は、グラフィカルシステムから①ウェブブラウザ、②タブ、③ダイアログ、そして最後に④テキストフィールドへ流されるだろう。</p>

  </div>

  <p>キーボード<em>イベント</em>は、常にこの<i data-anolis-xref="">フォーカスされた</i>要素で対象にされる。</p>


  <h4 id="data-model"><span class="secno">5.4.2</span> データモデル</h4>

  <p>用語<dfn id="focusable-area">フォーカス可能領域</dfn>は、キーボード入力の対象になることができるインターフェースの領域を参照するために使用される。フォーカス可能領域は、要素、要素の一部、またはユーザーエージェントによって処理される他の領域となることができる。</p>

  <p>各<i><a href="#focusable-area">フォーカス可能領域</a></i>は、DOMで<i><a href="#focusable-area">フォーカス可能領域</a></i>の位置を表す<code><a href="infrastructure.html#node">Node</a></code> オブジェクトである、<dfn id="dom-anchor">DOMアンカー</dfn>を持つ。（<i><a href="#focusable-area">フォーカス可能領域</a></i>が<code><a href="infrastructure.html#node">Node</a></code>自身である場合、それはそれ自身の<i><a href="#dom-anchor">DOM anchor</a></i>である。）<i><a href="#focusable-area">フォーカス可能領域</a></i>を表すために他のDOMオブジェクトが存在しない場合、<i><a href="#dom-anchor">DOMアンカー</a></i>は、<i><a href="#focusable-area">フォーカス可能領域</a></i>に適するようないくつかのAPIで使用される。</p>

  <p>以下のテーブルは、 どのオブジェクトがs can be <i data-anolis-xref="focusable area"><a href="#focusable-area">フォーカス可能領域</a></i>となることができるかを説明する。左の列におけるセルは、<i data-anolis-xref="focusable
  area"><a href="#focusable-area">フォーカス可能領域</a></i>となることができるオブジェクトを説明する。右の列におけるセルは、この要素に対する<i data-anolis-xref="DOM anchor"><a href="#dom-anchor">DOMアンカー</a></i>を説明する。（両方の列をまたぐセルは、非規範的な例である。）</p>

  <table id="table-fa"><thead><tr><th id="th-fa-area"><i><a href="#focusable-area">フォーカス可能領域</a></i>
     </th><th id="th-fa-dom-rep"><i><a href="#dom-anchor">DOMアンカー</a></i>
    </th></tr><tr><th colspan="2" id="th-fa-examples">例

   <tbody></th></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-1">
     <a data-anolis-xref="concept-element-disabled" href="disabled-elements.html#concept-element-disabled">実際に無効</a>でない、<a data-anolis-xref="expressly inert control" href="#expressly-inert-control">明確に不活性</a>でない、および<a href="rendering.html#being-rendered">描画されている</a>または<span>関連するキャンバスフォールバックコンテンツとして使用されている</span>かのいずれかである、その<a href="#specially-focusable">タブインデックスフォーカスフラグ</a>設定を持つ要素 <!--
     CANVAS-FOCUS-FALLBACK -->
     <td headers="td-fa-1 th-fa-dom-rep">
     要素自身。
    </td></th></tr><tr><td colspan="2" headers="td-fa-1 th-fa-examples">
     <p class="example"><code><a href="embedded-content.html#the-iframe-element">iframe</a></code>、<code data-anolis-xref="attr-input-type-text"><a href="forms.html#text-(type=text)-state-and-search-state-(type=search)">&lt;input type=text&gt;</a></code>、時に<code data-anolis-xref="a"><a href="text-level-semantics.html#the-a-element">&lt;a href=""&gt;</a></code> （プラットフォーム慣習に依存する）。

   <tbody></td></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-2">
     <a href="rendering.html#being-rendered">描画されている</a>および<a data-anolis-xref="expressly
     inert control" href="#expressly-inert-control">明示的に不活性</a>でない<code><a href="embedded-content.html#the-img-element">img</a></code>要素に関連する<a href="embedded-content.html#image-map">イメージマップ</a>における<code><a href="embedded-content.html#the-area-element">area</a></code>要素の形状。
     <td headers="td-fa-2 th-fa-dom-rep">
     <code><a href="embedded-content.html#the-img-element">img</a></code>要素
    </td></th></tr><tr><td colspan="2" headers="td-fa-2 th-fa-examples">
     <div class="example">
      <p>次の例において、それぞれ画像の、<code><a href="embedded-content.html#the-area-element">area</a></code>要素は2つの形状を作成する。最初の形状の<i><a href="#dom-anchor">DOMアンカー</a></i>は、最初の<code><a href="embedded-content.html#the-img-element">img</a></code>要素であり、2つめの形状の<i><a href="#dom-anchor">DOM anchor</a></i>は、2つめの<code><a href="embedded-content.html#the-img-element">img</a></code>要素である。</p>
      <pre>&lt;map id=wallmap&gt;&lt;area alt="Enter Door" coords="10,10,100,200" href="door.html"&gt;&lt;/map&gt;
...
&lt;img src="images/innerwall.jpeg" alt="There is a white wall here, with a door." usemap="#wallmap"&gt;
...
&lt;img src="images/outerwall.jpeg" alt="There is a red wall here, with a door." usemap="#wallmap"&gt;</pre>
     </div>

   <tbody></td></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-3">
     要素のサブウィジェットを提供されるユーザーエージェントは、<a href="rendering.html#being-rendered">描画されている</a>かつ<a data-anolis-xref="concept-element-disabled" href="disabled-elements.html#concept-element-disabled">実際に無効</a>または<a data-anolis-xref="expressly
     inert control" href="#expressly-inert-control">明確に不活性</a>でない。
     <td headers="td-fa-3 th-fa-dom-rep">
     <i><a href="#focusable-area">フォーカス可能領域</a></i>がサブウィジェットとなる要素。
    </td></th></tr><tr><td colspan="2" headers="td-fa-3 th-fa-examples">
     <p class="example"><code><a href="embedded-content.html#the-video-element">video</a></code>要素に対する<a data-anolis-xref="expose a user interface to the user" href="embedded-content.html#expose-a-user-interface-to-the-user">ユーザーに公開されるユーザーインターフェースにおけるコントロール</a>、<code data-anolis-xref="attr-input-type-number"><a href="forms.html#number-state-(type=number)">&lt;input type=number&gt;</a></code>のスピンコントロールバージョンにおけるアップ・ダウンボタン、<code data-anolis-xref="attr-input-type-range"><a href="forms.html#range-state-(type=range)">&lt;input type=range multiple&gt;</a></code>における2つの範囲コントロールウィジェット、キーボード入力を用いた開くまたは閉じるために要素を有効にした<code><a href="interactive-elements.html#the-details-element">details</a></code>要素のレンダリングの一部。</p>

   <tbody></td></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-4">
     <a href="rendering.html#being-rendered">描画されている</a>かつ<a data-anolis-xref="expressly inert control" href="#expressly-inert-control">明確に不活性</a>でない要素のスクロール可能な領域。 <!-- the being rendered part is kinda
     redundant, a scrollable region is a box generated for the element so by definition if the
     element has a scrollable region it is being rendered -->
     <td headers="td-fa-4 th-fa-dom-rep">
     スクロール可能な領域のスクロールが作成されたボックスに対する要素
    </td></th></tr><tr><td colspan="2" headers="td-fa-4 th-fa-examples">
     <p class="example">CSS 'overflow'プロパティーの'scroll'値が典型的にスクロール可能領域を作成する。</p>

   <tbody></td></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-5">
     <a href="browsers.html#browsing-context">ブラウジングコンテキスト</a>にあるおよび<a href="#inert">不活性</a>でない<code><a href="dom.html#document">Document</a></code>のビューポート。
     <td headers="td-fa-5 th-fa-dom-rep">
     ビューポートが作成された<code><a href="dom.html#document">Document</a></code>。
    </td></th></tr><tr><td colspan="2" headers="td-fa-5 th-fa-examples">
     <p class="example"><code><a href="embedded-content.html#the-iframe-element">iframe</a></code>のコンテンツ。</p>

   <tbody></td></tr><tr><th class="data-header" headers="th-fa-area" id="td-fa-6">
     特にアクセシビリティーを支援する、またはよりプラットフォーム慣習にマッチする、任意の他の要素または要素の一部。
     <td headers="td-fa-6 th-fa-dom-rep">
     要素。
    </td></th></tr><tr><td colspan="2" headers="td-fa-6 th-fa-examples">
     <p class="example">ユーザーエージェントがリスト項目弾丸をフォーカス可能にすることができ、その結果ユーザーはより簡単にリストをそうさすることができる。</p>
     <p class="example">同様に、ユーザーエージェントが<code data-anolis-xref="attr-title"><a href="dom.html#attr-title">title</a></code>属性をもつすべての要素をフォーカス可能にすることができ、その結果要素の助言情報はアクセスされることができる。</p>

  </td></tr></table><p class="note" id="bc-focus-ergo-bcc-focus"><a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>（たとえば<code><a href="embedded-content.html#the-iframe-element">iframe</a></code>）は、<i><a href="#focusable-area">フォーカス可能領域</a></i>であるが、<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>に送られるキーイベントは、<a href="browsers.html#nested-browsing-context">ネストされたブラウジングコンテキスト</a>の<a href="browsers.html#active-document">アクティブ文書</a>に送られる。同様に、逐次的フォーカスナビゲーションにおいて<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>は本質的にその<a href="browsers.html#nested-browsing-context">ネストされるブラウジングコンテキスト</a>の<a href="browsers.html#active-document">アクティブ文書</a>に対するプレースホルダとして単に動作する。</p>

  <p>各<i><a href="#focusable-area">フォーカス可能領域</a></i>は、<dfn id="control-group">コントロールグループ</dfn>に属する。各<i><a href="#control-group">コントロールグループ</a></i>は、<dfn data-anolis-xref="control group owner" id="control-group-owner">所有者</dfn>を持つ。<a data-anolis-xref="control group owner" href="#control-group-owner">コントロールグループ所有者</a>は、<dfn data-anolis-xref="control group owner object" id="control-group-owner-object">コントロールグループ所有者オブジェクト</dfn>である。以下は、<a data-anolis-xref="control group owner object" href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>である：</p>

  <ul class="brief"><li><a data-anolis-xref="browsing context" href="browsers.html#browsing-context">ブラウジングコンテキスト</a>における<code><a href="dom.html#document">Document</a></code>オブジェクト。</li>

   <li>指定された<code data-anolis-xref="attr-dialog-open"><a href="interactive-elements.html#attr-dialog-open">open</a></code>属性を持ちかつ<a href="rendering.html#being-rendered">描画されている</a><code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>要素</li>

  </ul><p>各<a href="#control-group-owner-object">コントロールグループ種勇者オブジェクト</a>は、（そのグループが空かもしれないが）1つの<i><a href="#control-group">コントロールグループ</a></i>を所有する。</p>

  <p><i><a href="#focusable-area">フォーカス可能領域</a></i>の<i><a href="#dom-anchor">DOMアンカー</a></i>が<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>である場合、その<i><a href="#focusable-area">フォーカス可能領域</a></i>は、その<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>の<i><a href="#control-group">コントロールグループ</a></i>に所属する。そうでなければ、<i><a href="#focusable-area">フォーカス可能領域</a></i>は、その<i><a href="#dom-anchor">DOMアンカー</a></i>の最も近い祖先<a href="#control-group-owner-object">&gt;コントロールグループ所有者オブジェクト</a>に所属する。</p>

  <div class="example">

   <p>このように、ビューポートは常にビューポートが作成された<code><a href="dom.html#document">Document</a></code>の<i><a href="#control-group">コントロールグループ</a></i>に属し、<code><a href="forms.html#the-input-element">input</a></code>コントロールはその最も近い祖先<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>または<code><a href="dom.html#document">Document</a></code>の<i><a href="#control-group">コントロールグループ</a></i>に属し、イメージマップの形状は<code><a href="embedded-content.html#the-img-element">img</a></code>要素（<code><a href="embedded-content.html#the-area-element">area</a></code>要素でない―これは1つの<code><a href="embedded-content.html#the-area-element">area</a></code>要素が異なる<i data-anolis-xref="control
   group"><a href="#control-group">コントロールグループ</a></i>で複数の形状を作るかもしれないことを意味する）の最も近い祖先<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>または<code><a href="dom.html#document">Document</a></code> に属する。</p>

  </div>

  <p>要素は、要素が<a href="#inert">不活性</a>だが、要素が<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>でなく、かつ要素の最も近い祖先<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>が<a href="#inert">不活性</a>でない場合、<dfn data-anolis-xref="expressly inert control" id="expressly-inert-control">明示的に不活性</dfn>である。</p>

  <p>各空でない<i><a href="#control-group">コントロールグループ</a></i>における1つの<i><a href="#focusable-area">フォーカス可能領域</a></i>は、<dfn id="focused-area-of-the-control-group">コントロールグループの被フォーカス可能領域</dfn>と呼ばれる。どのコントロールがそのように呼ばれるかは時間とともに変化し、この仕様におけるアルゴリズムに基づく。<i><a href="#control-group">コントロールグループ</a></i>が空である場合、コントロールグループは<i data-anolis-xref="focused area of the control group"><a href="#focused-area-of-the-control-group">被フォーカス領域</a></i>を持たない。</p>

  <p>各<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>はまた、<dfn id="dialog-group">ダイアロググループ</dfn>の<dfn data-anolis-xref="dialog group
  manager" id="dialog-group-manager">管理者</dfn>として動作することができる。</p>

  <p><code data-anolis-xref="attr-dialog-open"><a href="interactive-elements.html#attr-dialog-open">open</a></code>属性を指定されかつ<a href="rendering.html#being-rendered">描画されている</a>（すなわち、<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>である）かつ<a data-anolis-xref="expressly inert dialog" href="#expressly-inert-dialog">明示的に不活性</a>でない各<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>要素は、<a data-anolis-xref="dialog group manager" href="#dialog-group-manager">所有者</a>が<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>要素の最も近い祖先<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>である <i><a href="#dialog-group">ダイアロググループ</a></i>に属する。</p>

  <p><code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>は、それが<a href="#inert">不活性</a>だがその最も近い祖先<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>が不活性でない場合、<dfn data-anolis-xref="expressly inert dialog" id="expressly-inert-dialog">明示的に不活性</dfn>である。</p>

  <p>その最も近い祖先<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>として<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>要素が特定の<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>を持たない場合、その<a href="#control-group-owner-object">コントロールグループ所有者オブジェクト</a>は一切の<i><a href="#dialog-group">ダイアロググループ</a></i>を持たない。</p>

  <p>各<i><a href="#dialog-group">ダイアロググループ</a></i>は、<dfn id="focused-dialog-of-the-dialog-group">ダイアロググループのフォーカスされたダイアログ</dfn>と呼ばれる<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>を持つことができる。どの<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>がそのように呼ばれるかは時間とともに変化し、この仕様におけるアルゴリズムに基づく。</p>

  <hr><p><i data-anolis-xref="control group"><a href="#control-group">コントロールグループ</a></i>における<i data-anolis-xref="focusable area"><a href="#focusable-area">フォーカス可能領域</a></i>は、その領域の<i data-anolis-xref="DOM anchor"><a href="#dom-anchor">DOMアンカー</a></i>の<a href="infrastructure.html#tree-order">ツリー順</a>に関連して並べられる。<i><a href="#control-group">コントロールグループ</a></i>で同じ<i><a href="#dom-anchor">DOMアンカー</a></i>をもつ<i data-anolis-xref="focusable area"><a href="#focusable-area">フォーカス可能領域</a></i>は、ボックスツリーの深さ優先走査でそのCSSボックスの関連する位置に関連して並べられる。<a href="references.html#refsCSS">[CSS]</a></p>

  <p><i data-anolis-xref="dialog group"><a href="#dialog-group">ダイアロググループ</a></i>における要素は、<a href="infrastructure.html#tree-order">ツリー順</a>で並べられる。</p>

  <hr><p>特定の時間で<dfn id="currently-focused-area-of-a-top-level-browsing-context">トップレベルブラウジングコンテキストの現在の被フォーカス領域</dfn>は、<i><a href="#focusable-area">フォーカス可能領域</a></i>またはこのアルゴリズムによって返される<code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>である。</p>

  <ol><li><p><var data-anolis-xref="">candidate</var>を<a href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>の <code><a href="dom.html#document">Document</a></code>にする。</li>

   <li>

    <p><var data-anolis-xref="">candidate</var>が指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>をともなう<i><a href="#dialog-group">ダイアロググループ</a></i>を持つ場合、<var data-anolis-xref="">candidate</var>を指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>にし、このステップを再実行する。</p>

    <p>そうでなければ、<var data-anolis-xref="">candidate</var>が空でない<i><a href="#control-group">コントロールグループ</a></i>を持ち、かつ指定された<a href="#focused-area-of-the-control-group">コントロールグループの被フォーカス領域</a>が<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>である場合、<var data-anolis-xref="">candidate</var>をその<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>の<a href="browsers.html#nested-browsing-context">ネストされるブラウジングコンテキスト</a>の<a href="browsers.html#active-document">アクティブ文書</a>にし、このステップを再実行する。</p>

    <p>そうでなければ、<var data-anolis-xref="">candidate</var>が空でない<i><a href="#control-group">コントロールグループ</a></i>を持つ場合、<var data-anolis-xref="">candidate</var>を指定された<a href="#focused-area-of-the-control-group">コントロールグループの被フォーカス領域</a>にする。</p>

   </li>

   <li><p><var data-anolis-xref="">candidate</var>を返す。</li>

  </ol><p>An element that is the<i><a href="#focusable-area">フォーカス可能領域</a></i>の<i><a href="#dom-anchor">DOMアンカー</a></i>である要素は、 i5&gt;<a href="#focusable-area">フォーカス可能領域</a></i>が<a href="#currently-focused-area-of-a-top-level-browsing-context">トップレベルブラウジングコンテキストの被フォーカス領域</a>になる場合に<dfn data-anolis-xref="gains focus" id="gains-focus">利得フォーカス</dfn> と呼ばれる。要素が<a href="#currently-focused-area-of-a-top-level-browsing-context">トップレベルブラウジングコンテキストの現在の被フォーカス領域</a>に属する<i><a href="#focusable-area">フォーカス可能領域</a></i>の<i><a href="#dom-anchor">DOMアンカー</a></i>である場合、要素は<dfn id="focused">被フォーカス</dfn>である。</p>

  <div class="impl">

  <p>The <dfn id="focus-chain">focus chain</dfn> of a <i><a href="#focusable-area">focusable area</a></i> or <a href="#control-group-owner-object">control group owner
  object</a> <var data-anolis-xref="">subject</var> is the ordered list constructed as follows:</p>

  <ol><li><p>Let <var data-anolis-xref="">current object</var> be <var data-anolis-xref="">subject</var>.</li>

   <li><p>Let <var data-anolis-xref="">output</var> be an empty list.</li>

   <li><p><i>Loop</i>: Append <var data-anolis-xref="">current object</var> to <var data-anolis-xref="">output</var>.</li>

   <li>

    <p>If <var data-anolis-xref="">current object</var> is an <code><a href="embedded-content.html#the-area-element">area</a></code> element's shape, append
    that <code><a href="embedded-content.html#the-area-element">area</a></code> element to <var data-anolis-xref="">output</var>.</p>

    <p>Otherwise, if <var data-anolis-xref="">current object</var> is a <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM
    anchor</a></i> is an element that is not <var data-anolis-xref="">current object</var> itself, append that
    <i><a href="#dom-anchor">DOM anchor</a></i> element to <var data-anolis-xref="">output</var>.</p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">current object</var> is a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> object in a <i><a href="#dialog-group">dialog
    group</a></i>, let <var data-anolis-xref="">current object</var> be that <i><a href="#dialog-group">dialog group</a></i>'s <a data-anolis-xref="dialog group manager" href="#dialog-group-manager">manager</a>, and return to the step labeled <i>loop</i>.</p>

    <p>Otherwise, if <var data-anolis-xref="">current object</var> is a <i><a href="#focusable-area">focusable area</a></i>, let <var data-anolis-xref="">current object</var> be that <i><a href="#focusable-area">focusable area</a></i>'s <i><a href="#control-group">control group</a></i>'s
    <a data-anolis-xref="control group owner" href="#control-group-owner">owner</a>, and return to the step labeled <i>loop</i>.</p>

    <p>Otherwise, if <var data-anolis-xref="">current object</var> is a <code><a href="dom.html#document">Document</a></code> in a
    <a href="browsers.html#nested-browsing-context">nested browsing context</a>, let <var data-anolis-xref="">current object</var> be its
    <a href="browsers.html#browsing-context-container">browsing context container</a>, and return to the step labeled <i>loop</i>.</p>

   </li>

   <li>

    <p>Return <var data-anolis-xref="">output</var>.</p>

    <p class="note">The chain starts with <var data-anolis-xref="">subject</var> and (if <var data-anolis-xref="">subject</var> is or can be the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing
    context</a>) continues up the focus hierarchy up to the <code><a href="dom.html#document">Document</a></code> of the
    <a href="browsers.html#top-level-browsing-context">top-level browsing context</a>.</p>

   </li>

  </ol></div>


  <h4 id="the-tabindex-attribute"><span class="secno">5.4.3</span> <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code>属性</h4>

  <p><dfn data-anolis-xref="attr-tabindex" id="attr-tabindex"><code>tabindex</code></dfn>コンテンツ属性は、著者が、要素がフォーカスできることを仮定するかどうか、それが順次フォーカスナビゲーションを使用して到達することを仮定するかどうか、何がシーケンシャルフォーカスナビゲーションのための要素の相対的な順序になるかを指示できる。名前"tab index"は、フォーカス可能な要素を通してナビゲートする"tab"キーの一般的な使用方法から来ている。用語"tabbing"は、順次フォーカスナビゲーションを使用して到達することができるフォーカス可能な要素を前方に移動することを指す。</p>

  <p>属性が省略される場合、ユーザーエージェントはデフォルトを適用する。（<a href="rendering.html#being-rendered">描画されている</a>要素を<a data-anolis-xref="concept-element-disabled" href="disabled-elements.html#concept-element-disabled">利用不能にする</a>ことなしにまたは<a href="#inert">不活性に</a>することなしにフォーカス可能にさせる方法は存在しない。）</p>

  <p><code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code>属性が指定される場合、<a href="infrastructure.html#valid-integer">妥当な整数</a>である値を持たなければならない。正の数は<a href="#sequential-focus-navigation-order">シーケンシャルフォーカスナビゲーション順</a>で要素の<a data-anolis-xref="focusable area" href="#focusable-area">フォーカス可能領域</a>の関連位置を指定し、負の数は<a href="#sequential-focus-navigation">シーケンシャルフォーカスナビゲーショ</a>によって到達不能となるコントロールを示す。</p>

  <div class="impl">

  <p>Each element can have a <dfn id="specially-focusable">tabindex focus flag</dfn> set, as defined
  below. This flag is a factor that contributes towards determining whether an element is a
  <i><a href="#focusable-area">focusable area</a></i>, as described in the previous section.</p>

  <p>If the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute is specified on an element, it
  must be parsed using the <a href="infrastructure.html#rules-for-parsing-integers">rules for parsing integers</a>. The attribute's values, or lack
  thereof, must be interpreted as follows:</p>

  <dl><dt>If the attribute is omitted or parsing the value returns an error</dt>

   <dd>

    <p>The user agent should follow platform conventions to determine if the element's
    <a href="#specially-focusable">tabindex focus flag</a> is set and, if so, whether the element and any <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> that have the element as their <i><a href="#dom-anchor">DOM anchor</a></i> can
    be reached using <a href="#sequential-focus-navigation">sequential focus navigation</a>, and if so, what their relative
    position in the <a href="#sequential-focus-navigation-order">sequential focus navigation order</a> is to be.</p>

    <p>Modulo platform conventions, it is suggested that for the following elements, the
    <a href="#specially-focusable">tabindex focus flag</a> be set:</p>

    <ul><li><code><a href="text-level-semantics.html#the-a-element">a</a></code> elements that have an <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code>
     attribute</li>

     <li><code><a href="document-metadata.html#the-link-element">link</a></code> elements that have an <code data-anolis-xref="attr-link-href"><a href="document-metadata.html#attr-link-href">href</a></code> attribute</li>

     <li><code><a href="forms.html#the-button-element">button</a></code> elements</li>

     <li><code><a href="forms.html#the-input-element">input</a></code> elements whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute are
     not in the <a data-anolis-xref="attr-input-type-hidden" href="forms.html#hidden-state-(type=hidden)">Hidden</a> state</li>

     <li><code><a href="forms.html#the-select-element">select</a></code>要素</li>

     <li><code><a href="forms.html#the-textarea-element">textarea</a></code>要素</li>

     <li><code><a href="interactive-elements.html#the-menuitem-element">menuitem</a></code> elements</li>

     <li>Elements with a <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> attribute set, if that would
     enable the user agent to allow the user to begin a drag operations for those elements without
     the use of a pointing device</li>

     <li><a data-anolis-xref="editing host" href="#editing-host">Editing hosts</a></li>

     <li><a data-anolis-xref="browsing context container" href="browsers.html#browsing-context-container">Browsing context containers</a></li><!-- like
     <iframe>s --> 

     <li><a data-anolis-xref="sorting interface th element" href="tabular-data.html#sorting-interface-th-element">Sorting interface <code>th</code>
     elements</a></li>

    </ul><p class="note">One valid reason to ignore the platform conventions and always allow an element
    to be focused (by setting its <a href="#specially-focusable">tabindex focus flag</a>) would be if the user's only
    mechanism for activating an element is through a keyboard action that triggers the focused
    element.</p>

   </dd>

   <dt id="negative-tabindex">If the value is a negative integer</dt>

   <dd>

    <p>The user agent must set the element's <a href="#specially-focusable">tabindex focus flag</a>, but should omit the
    element from the <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>.</p>

    <p class="note">One valid reason to ignore the requirement that sequential focus navigation not
    allow the author to lead to the element would be if the user's only mechanism for moving the
    focus is sequential focus navigation. For instance, a keyboard-only user would be unable to
    click on a text field with a negative <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code>, so that
    user's user agent would be well justified in allowing the user to tab to the control
    regardless.</p>

   </dd>

   <dt>If the value is a zero</dt>

   <dd>

    <p>The user agent must set the element's <a href="#specially-focusable">tabindex focus flag</a>, should allow the
    element and any <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> that have the element as their
    <i><a href="#dom-anchor">DOM anchor</a></i> to be reached using <a href="#sequential-focus-navigation">sequential focus navigation</a>, following
    platform conventions to determine the element's relative position in the <a href="#sequential-focus-navigation-order">sequential focus
    navigation order</a>.</p>

   </dd>

   <dt>If the value is greater than zero</dt>

   <dd>

    <p>The user agent must set the element's <a href="#specially-focusable">tabindex focus flag</a>, should allow the
    element and any <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> that have the element as their
    <i><a href="#dom-anchor">DOM anchor</a></i> to be reached using sequential focus navigation, and should place the element
    — referenced as <var data-anolis-xref="">candidate</var> below — and the aforementioned <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> in the <a href="#sequential-focus-navigation">sequential focus navigation</a>
    order so that, relative to other <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> in the
    <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>, they are:</p>

    <ul><li>before any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has been omitted or whose value, when parsed,
     returns an error,</li>

     <li>before any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has a value equal to or less than zero,</li>

     <li>after any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has a value greater than zero but less than
     the value of the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute on <var data-anolis-xref="">candidate</var>,</li>

     <li>after any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has a value equal to the value of the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute on <var data-anolis-xref="">candidate</var> but that is
     earlier in the document in <a href="infrastructure.html#tree-order">tree order</a> than <var data-anolis-xref="">candidate</var>,</li>

     <li>before any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has a value equal to the value of the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute on <var data-anolis-xref="">candidate</var> but that is
     later in the document in <a href="infrastructure.html#tree-order">tree order</a> than <var data-anolis-xref="">candidate</var>, and</li>

     <li>before any <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM anchor</a></i> is an element whose <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute has a value greater than the value of the
     <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute on <var data-anolis-xref="">candidate</var>.</li>

    </ul></dd>

  </dl><p>An element that has its <a href="#specially-focusable">tabindex focus flag</a> set but does not otherwise have an
  <a href="#activation-behavior">activation behavior</a> defined has an <a href="#activation-behavior">activation behavior</a> that does
  nothing.</p>

  <p class="note">This means that an element that is only focusable because of its <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute will fire a <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event in response to a non-mouse activation (e.g. hitting the
  "enter" key while the element is <a href="#focused">focused</a>).</p>

  <p>An element with the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute specified is
  <a href="dom.html#interactive-content-0">interactive content</a>.</p>

  <p>The <dfn data-anolis-xref="dom-tabIndex" id="dom-tabindex"><code>tabIndex</code></dfn> IDL attribute must
  <a href="infrastructure.html#reflect">reflect</a> the value of the <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> content
  attribute. Its default value is 0 for elements that are focusable and −1 for elements that
  are not focusable.</p>

  </div>


  <div class="impl">

  <h4 id="processing-model-4"><span class="secno">5.4.4 </span>Processing model</h4>

  <p>The <dfn id="focusing-steps">focusing steps</dfn> for an object <var data-anolis-xref="">new focus target</var> that is
  either a <i><a href="#focusable-area">focusable area</a></i>, or an element that is not a <i><a href="#focusable-area">focusable area</a></i>, or a
  <a href="browsers.html#browsing-context">browsing context</a>, are as follows:</p>

  <ol><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2816 div.focus() when it's got a scroll region --><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2817 img.focus() when it's got an image map --><li>

    <p>If <var data-anolis-xref="">new focus target</var> is neither a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> element that has an
    <code data-anolis-xref="attr-dialog-open"><a href="interactive-elements.html#attr-dialog-open">open</a></code> attribute specified and that is <a href="rendering.html#being-rendered">being
    rendered</a> (i.e. that is a <a href="#control-group-owner-object">control group owner object</a>), nor a <i><a href="#focusable-area">focusable
    area</a></i>, then run the first matching set of steps from the following list:</p>

    <dl class="switch"><dt>If <var data-anolis-xref="">new focus target</var> is an <code><a href="embedded-content.html#the-area-element">area</a></code> element with one or more
     shapes that are <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i></dt>

     <dd>

      <p>Let <var data-anolis-xref="">new focus target</var> be the shape corresponding to the first
      <code><a href="embedded-content.html#the-img-element">img</a></code> element in tree order that uses the image map to which the <code><a href="embedded-content.html#the-area-element">area</a></code>
      element belongs.</p>

     </dd>


     <dt>If <var data-anolis-xref="">new focus target</var> is an element with one or more scrollable regions
     that are <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i></dt>

     <dd>

      <p>Let <var data-anolis-xref="">new focus target</var> be the element's first scrollable region,
      according to a pre-order, depth-first traversal of the box tree. <a href="references.html#refsCSS">[CSS]</a></p>

     </dd>


     <dt>If <var data-anolis-xref="">new focus target</var> is <a href="dom.html#the-body-element-0">the body element</a> of its
     <code><a href="dom.html#document">Document</a></code></dt>
     <dt>If <var data-anolis-xref="">new focus target</var> is the <a href="infrastructure.html#root-element">root element</a> of its
     <code><a href="dom.html#document">Document</a></code> and that <code><a href="dom.html#document">Document</a></code> has no <a data-anolis-xref="the body
     element" href="dom.html#the-body-element-0">body element</a></dt>

     <dd>

      <p>Let <var data-anolis-xref="">new focus target</var> be the <code><a href="dom.html#document">Document</a></code>'s viewport.</p>

     </dd>


     <dt>If <var data-anolis-xref="">new focus target</var> is a <a href="browsers.html#browsing-context">browsing context</a></dt>

     <dd>

      <p>Let <var data-anolis-xref="">new focus target</var> be the <a href="browsers.html#browsing-context">browsing context</a>'s
      <a href="browsers.html#active-document">active document</a>.</p>

     </dd>

     <dt>そうでなければ</dt>

     <dd>

      <p>Abort the <a href="#focusing-steps">focusing steps</a>.</p>

     </dd>

    </dl></li>

   <li>

    <p>If <var data-anolis-xref="">new focus target</var> is a <a href="#control-group-owner-object">control group owner object</a> that is
    not a <i><a href="#focusable-area">focusable area</a></i>, but does have a <i><a href="#dialog-group">dialog group</a></i>, and that <i><a href="#dialog-group">dialog group</a></i>
    has a designated <a data-anolis-xref="focused dialog of the dialog group" href="#focused-dialog-of-the-dialog-group">focused dialog</a>, then
    let <var data-anolis-xref="">new focus target</var> be the <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog
    group</a>, and redo this step.</p>

    <p>Otherwise, if <var data-anolis-xref="">new focus target</var> is a <a href="#control-group-owner-object">control group owner
    object</a> that is not a <i><a href="#focusable-area">focusable area</a></i>, and its <i><a href="#control-group">control group</a></i> is not empty,
    then designate <var data-anolis-xref="">new focus target</var> as the <a href="#focused-area-of-the-control-group">focused area of the control
    group</a>, and redo this step.</p><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2818 -->

    
    <p>Otherwise, if <var data-anolis-xref="">new focus target</var> is a <a href="browsers.html#browsing-context-container">browsing context
    container</a>, then let <var data-anolis-xref="">new focus target</var> be the <a href="browsers.html#nested-browsing-context">nested browsing
    context</a>'s <a href="browsers.html#active-document">active document</a>, and redo this step.</p>

    <p class="note">A <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> element can be both a <a href="#control-group-owner-object">control group owner
    object</a> and a <i><a href="#focusable-area">focusable area</a></i>, if it has both an <code data-anolis-xref="attr-dialog-open"><a href="interactive-elements.html#attr-dialog-open">open</a></code> attribute specified and a <code data-anolis-xref="attr-tabindex"><a href="#attr-tabindex">tabindex</a></code> attribute specified and is <a href="rendering.html#being-rendered">being
    rendered</a>.</p>

   </li>

   <li><p>If <var data-anolis-xref="">new focus target</var> is a <i><a href="#focusable-area">focusable area</a></i> and its <i><a href="#dom-anchor">DOM
   anchor</a></i> is <a href="#inert">inert</a>, then abort these steps.</li>

   <li><p>If <var data-anolis-xref="">new focus target</var> is the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a
   top-level browsing context</a>, then abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">old chain</var> be the <a href="#focus-chain">focus chain</a> of the <a data-anolis-xref="currently focused area of a top-level browsing context" href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of the
   top-level browsing context</a> in which <var data-anolis-xref="">new focus target</var> finds
   itself.</li>

   <li><p>Let <var data-anolis-xref="">new chain</var> be the <a href="#focus-chain">focus chain</a> of <var data-anolis-xref="">new
   focus target</var>.</li>

   <li><p>Run the <a href="#focus-update-steps">focus update steps</a> with <var data-anolis-xref="">old chain</var>, <var data-anolis-xref="">new chain</var>, and <var data-anolis-xref="">new focus target</var> respectively.</li>

  </ol><p>User agents must synchronously run the <a href="#focusing-steps">focusing steps</a> for a <i><a href="#focusable-area">focusable area</a></i>,
  <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>, or <a href="browsers.html#browsing-context">browsing context</a> <var data-anolis-xref="">candidate</var> whenever the
  user attempts to move the focus to <var data-anolis-xref="">candidate</var>.</p>

  <p>The <dfn id="unfocusing-steps">unfocusing steps</dfn> for an object <var data-anolis-xref="">old focus target</var> that is
  either a <i><a href="#focusable-area">focusable area</a></i> or an element that is not a <i><a href="#focusable-area">focusable area</a></i> are as
  follows:</p>

  <ol><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2819 --><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2822 --><li><p>If <var data-anolis-xref="">old focus target</var> is <a href="#inert">inert</a>, then abort these
   steps.</li>

   <li>

    <p>If <var data-anolis-xref="">old focus target</var> is an <code><a href="embedded-content.html#the-area-element">area</a></code> element and one of its
    shapes is the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a>, or, if <var data-anolis-xref="">old focus target</var> is an element with one or more scrollable regions, and one of
    them is the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a>, then let <var data-anolis-xref="">old focus target</var> be that <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing
    context</a>.</p>

   </li>

   <li><p>Let <var data-anolis-xref="">old chain</var> be the <a href="#focus-chain">focus chain</a> of the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently
   focused area of a top-level browsing context</a>.</li>

   <li><p>If <var data-anolis-xref="">old focus target</var> is not one of the entries in <var data-anolis-xref="">old
   chain</var>, then abort these steps.</li>

   <li>

    <p>If <var data-anolis-xref="">old focus target</var> is a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in a <i><a href="#dialog-group">dialog group</a></i>,
    and the <a href="#dialog-group-manager">dialog group manager</a> has a non-empty <i><a href="#control-group">control group</a></i>, then let <var data-anolis-xref="">new focus target</var> be the designated <a data-anolis-xref="focused area of the control
    group" href="#focused-area-of-the-control-group">focused area of that focus group</a>.</p>

    <p>Otherwise, if <var data-anolis-xref="">old focus target</var> is a <i><a href="#focusable-area">focusable area</a></i>, then let <var data-anolis-xref="">new focus target</var> be the first <i><a href="#focusable-area">focusable area</a></i> of its <i><a href="#control-group">control
    group</a></i> (if the <a href="#control-group-owner">control group owner</a> is a <code><a href="dom.html#document">Document</a></code>, this will
    always be a viewport).</p>

    <p>Otherwise, let <var data-anolis-xref="">new focus target</var> be null.</p>

   </li>

   <li><p>If <var data-anolis-xref="">new focus target</var> is not null, then run the <a href="#focusing-steps">focusing
   steps</a> for <var data-anolis-xref="">new focus target</var>.</li>

  </ol><p>When the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a> is somehow
  unfocused without another element being explicitly focused in its stead, the user agent must
  synchronously run the <a href="#unfocusing-steps">unfocusing steps</a> for that object.</p>

  <p class="note">The <a href="#unfocusing-steps">unfocusing steps</a> do not always result in the focus changing, even
  when applied to the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a>. For
  example, if the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a> is a viewport,
  then it will usually keep its focus regardless until another <i><a href="#focusable-area">focusable area</a></i> is explicitly
  focused with the <a href="#focusing-steps">focusing steps</a>.</p>

  <hr><p>When a <i><a href="#focusable-area">focusable area</a></i> is added to an empty <i><a href="#control-group">control group</a></i>, it must be designated
  the <i><a href="#focused-area-of-the-control-group">focused area of the control group</a></i>.</p>

  <p>When a <i><a href="#dialog-group">dialog group</a></i> is formed, if the <a href="#dialog-group-manager">dialog group manager</a> has an empty
  <i><a href="#control-group">control group</a></i>, the first non-<a href="#inert">inert</a> <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in the <i><a href="#dialog-group">dialog
  group</a></i>, if any, or else the first <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in the <i><a href="#dialog-group">dialog group</a></i> regardless of
  <a data-anolis-xref="inert" href="#inert">inertness</a>, must be designated the <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog
  group</a>.</p>

  <p><dfn id="focus-fixup-rule-one">Focus fixup rule one</dfn>: When the designated <a data-anolis-xref="focused area of the control
  group" href="#focused-area-of-the-control-group">focused area of a control group</a> is removed from that <i><a href="#control-group">control group</a></i> in some
  way (e.g. it stops being a <i><a href="#focusable-area">focusable area</a></i>, it is removed from the DOM, it becomes <a data-anolis-xref="expressly inert control" href="#expressly-inert-control">expressly inert</a>, etc), and the <i><a href="#control-group">control group</a></i> is
  still not empty: designate the first non-<a href="#inert">inert</a> <i>focused area</i> in that <i><a href="#control-group">control
  group</a></i> to be the new <a href="#focused-area-of-the-control-group">focused area of the control group</a>, if any; if they are all
  <a href="#inert">inert</a>, then designate the first <i>focused area</i> in that <i><a href="#control-group">control group</a></i> to
  be the new <a href="#focused-area-of-the-control-group">focused area of the control group</a> regardless of <a data-anolis-xref="inert" href="#inert">inertness</a>. If such a removal instead results in the <i><a href="#control-group">control group</a></i>
  being empty, then there is simply no longer a <a href="#focused-area-of-the-control-group">focused area of the control group</a>.</p>

  <p class="example">For example, this might happen because an element is removed from its
  <code><a href="dom.html#document">Document</a></code>, or has a <code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code> attribute added. It might
  also happen to an <code><a href="forms.html#the-input-element">input</a></code> element when the element gets <a data-anolis-xref="concept-fe-disabled" href="forms.html#concept-fe-disabled">disabled</a>.</p>

  <p><dfn id="focus-fixup-rule-two">Focus fixup rule two</dfn>: When a <i><a href="#dialog-group">dialog group</a></i> has no designed <a href="#focused-dialog-of-the-dialog-group">focused
  dialog of the dialog group</a>, and its <a href="#dialog-group-manager">dialog group manager</a>'s <i><a href="#control-group">control
  group</a></i> changes from being non-empty to being empty, the first non-<a href="#inert">inert</a>
  <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in the <i><a href="#dialog-group">dialog group</a></i>, if any, or else the first <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in
  the <i><a href="#dialog-group">dialog group</a></i> regardless of <a data-anolis-xref="inert" href="#inert">inertness</a>, must be designated
  the <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog group</a>.</p>

  <p><dfn id="focus-fixup-rule-three">Focus fixup rule three</dfn>: When the designated <a data-anolis-xref="focused dialog of the
  dialog group" href="#focused-dialog-of-the-dialog-group">focused dialog of a dialog group</a> is removed from that <i><a href="#dialog-group">dialog group</a></i> in
  some way (e.g. it stops <a href="rendering.html#being-rendered">being rendered</a>, it loses its <code data-anolis-xref="attr-dialog-open"><a href="interactive-elements.html#attr-dialog-open">open</a></code> attribute, it becomes <a data-anolis-xref="expressly inert
  dialog" href="#expressly-inert-dialog">expressly inert</a>, etc), and there is still a <i><a href="#dialog-group">dialog group</a></i> (because the
  <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in question was not the last <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in that <i><a href="#dialog-group">dialog group</a></i>):
  if the <i><a href="#dialog-group">dialog group</a></i>'s <a data-anolis-xref="dialog group manager" href="#dialog-group-manager">manager</a>'s <i><a href="#control-group">control
  group</a></i> is non-empty, let there be no designated <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog group</a>
  any more; otherwise (in the case that the <i><a href="#control-group">control group</a></i> is empty), designate the first
  non-<a href="#inert">inert</a> <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in the <i><a href="#dialog-group">dialog group</a></i> to be the <a href="#focused-dialog-of-the-dialog-group">focused
  dialog of the dialog group</a>, or, if they are all <a href="#inert">inert</a>, designate the first
  <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in the <i><a href="#dialog-group">dialog group</a></i> to be the <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog
  group</a> regardless of <a data-anolis-xref="inert" href="#inert">inertness</a>.</p>

  <p>When the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a> was a <i><a href="#focusable-area">focusable
  area</a></i> but stops being a <i><a href="#focusable-area">focusable area</a></i>, or when it was a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> in a
  <a href="#dialog-group">dialog group</a> and stops being part of that <a href="#dialog-group">dialog group</a>, or when it
  starts being <a href="#inert">inert</a>, the user agent must run the following steps:</p>

  <ol><!-- this is basically a special-cased version of the focusing steps --><li><p>Let <var data-anolis-xref="">old focus target</var> be whatever the <a data-anolis-xref="currently focused
   area of a top-level browsing context" href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of the top-level browsing
   context</a> was immediately before this algorithm became applicable (e.g. before the element
   was disabled, or the dialog was closed, or whatever caused this algorithm to run).</li>

   <li><p>Let <var data-anolis-xref="">old chain</var> be the <a href="#focus-chain">focus chain</a> of the <a data-anolis-xref="currently focused area of a top-level browsing context" href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of the
   top-level browsing context</a> at the same time.</li>

   <li><p>Make sure that the changes implied by the focus fixup rules <a data-anolis-xref="focus fixup rule
   one" href="#focus-fixup-rule-one">one</a>, <a data-anolis-xref="focus fixup rule two" href="#focus-fixup-rule-two">two</a>, and <a data-anolis-xref="focus fixup
   rule three" href="#focus-fixup-rule-three">three</a> above are applied.</li>

   <li><p>Let <var data-anolis-xref="">new focus target</var> be the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a
   top-level browsing context</a>.</li>

   <li><p>If <var data-anolis-xref="">old focus target</var> and <var data-anolis-xref="">new focus target</var> are the
   same, abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">new chain</var> be the <a href="#focus-chain">focus chain</a> of <var data-anolis-xref="">new
   focus target</var>.</li>

   <li><p>Run the <a href="#focus-update-steps">focus update steps</a> with <var data-anolis-xref="">old chain</var>, <var data-anolis-xref="">new chain</var>, and <var data-anolis-xref="">new focus target</var> respectively.</li>

  </ol><hr><p>The <dfn id="focus-update-steps">focus update steps</dfn>, given an <var data-anolis-xref="">old chain</var>, a <var data-anolis-xref="">new chain</var>, and a <var data-anolis-xref="">new focus target</var> respectively, are as
  follows:</p>

  <ol><!-- focusin/focusout?: http://software.hixie.ch/utilities/js/live-dom-viewer/saved/723 --><li><p>If the last entry in <var data-anolis-xref="">old chain</var> and the last entry in <var data-anolis-xref="">new chain</var> are the same, pop the last entry from <var data-anolis-xref="">old chain</var>
   and the last entry from <var data-anolis-xref="">new chain</var> and redo this step.</li>

   <li>

    <p>For each entry <var data-anolis-xref="">entry</var> in <var data-anolis-xref="">old chain</var>, in order, run
    these substeps:</p>

    <ol><li id="unfocus-causes-change-event"><p>If <var data-anolis-xref="">entry</var> is an <code><a href="forms.html#the-input-element">input</a></code>
     element, and the <code data-anolis-xref="event-input-change"><a href="forms.html#event-input-change">change</a></code> event <a data-anolis-xref="concept-input-apply" href="forms.html#concept-input-apply">applies</a> to the element, and the element does not have a
     defined <a href="#activation-behavior">activation behavior</a>, and the user has changed the element's <a data-anolis-xref="concept-fe-value" href="forms.html#concept-fe-value">value</a> or its list of <a data-anolis-xref="concept-input-type-file-selected" href="forms.html#concept-input-type-file-selected">selected files</a> while the control was focused
     without committing that change, then <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> that bubbles named <code data-anolis-xref="event-change"><a href="index.html#event-change">change</a></code> at the element.</p>

     </li><li>

      <p>If <var data-anolis-xref="">entry</var> is an element, let <var data-anolis-xref="">blur event target</var> be
      <var data-anolis-xref="">entry</var>.</p>

      <p>If <var data-anolis-xref="">entry</var> is a <code><a href="dom.html#document">Document</a></code> object, let <var data-anolis-xref="">blur
      event target</var> be that <code><a href="dom.html#document">Document</a></code> object's <code><a href="browsers.html#window">Window</a></code> object.</p>

      <p>Otherwise, let <var data-anolis-xref="">blur event target</var> be null.</p>

     </li>

     <li><p>If <var data-anolis-xref="">entry</var> is the last entry in <var data-anolis-xref="">old chain</var>, and
     <var data-anolis-xref="">entry</var> is an <code><a href="infrastructure.html#element">Element</a></code>, and the last entry in <var data-anolis-xref="">new
     chain</var> is also an <code><a href="infrastructure.html#element">Element</a></code>, then let <var data-anolis-xref="">related blur target</var>
     be the last entry in <var data-anolis-xref="">new chain</var>. Otherwise, let <var data-anolis-xref="">related blur
     target</var> be null.</li>

     <li>

      <p>If <var data-anolis-xref="">blur event target</var> is not null, <a href="#fire-a-focus-event">fire a focus event</a>
      named <code data-anolis-xref="event-blur"><a href="index.html#event-blur">blur</a></code> at <var data-anolis-xref="">blur event target</var>, with
      <var data-anolis-xref="">related blur target</var> as the related target.</p>

      <p class="note">In some cases, e.g. if <var data-anolis-xref="">entry</var> is an <code><a href="embedded-content.html#the-area-element">area</a></code>
      element's shape, a scrollable region, or a viewport, no event is fired.</p>

     </li>

    </ol></li>

   <li><p>Apply any relevant platform-specific conventions for focusing <var data-anolis-xref="">new focus
   target</var>. (For example, some platforms select the contents of a text field when that field is
   focused.)</li>

   <li>

    <p>For each entry <var data-anolis-xref="">entry</var> in <var data-anolis-xref="">new chain</var>, in reverse
    order, run these substeps:</p>

    <ol><li><p>If <var data-anolis-xref="">entry</var> is a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code> element: Let <var data-anolis-xref="">entry</var> be the designated <a data-anolis-xref="focused dialog of the dialog
     group" href="#focused-dialog-of-the-dialog-group">focused dialog of its dialog group</a>.</li>

     <li>

      <p>If <var data-anolis-xref="">entry</var> is a <i><a href="#focusable-area">focusable area</a></i>: Designate <var data-anolis-xref="">entry</var> as the <a href="#focused-area-of-the-control-group">focused area of the control group</a>. If its <i><a href="#control-group">control
      group</a></i>'s <a data-anolis-xref="control group owner" href="#control-group-owner">owner</a> is also a <a href="#dialog-group-manager">dialog group
      manager</a>, then let there be no designated <a data-anolis-xref="focused dialog of the dialog
      group" href="#focused-dialog-of-the-dialog-group">focused dialog</a> in that <i><a href="#dialog-group">dialog group</a></i>.</p>

      <p class="note">It is possible for <var data-anolis-xref="">entry</var> to be both a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>
      element and a <i><a href="#focusable-area">focusable area</a></i>, in which case it is its own <a href="#control-group-owner">control group
      owner</a>.</p>

     </li>

     <li>

      <p>If <var data-anolis-xref="">entry</var> is an element, let <var data-anolis-xref="">focus event target</var> be
      <var data-anolis-xref="">entry</var>.</p>

      <p>If <var data-anolis-xref="">entry</var> is a <code><a href="dom.html#document">Document</a></code> object, let <var data-anolis-xref="">focus
      event target</var> be that <code><a href="dom.html#document">Document</a></code> object's <code><a href="browsers.html#window">Window</a></code> object.</p>

      <p>Otherwise, let <var data-anolis-xref="">focus event target</var> be null.</p>

     </li>

     <li><p>If <var data-anolis-xref="">entry</var> is the last entry in <var data-anolis-xref="">new chain</var>, and
     <var data-anolis-xref="">entry</var> is an <code><a href="infrastructure.html#element">Element</a></code>, and the last entry in <var data-anolis-xref="">old
     chain</var> is also an <code><a href="infrastructure.html#element">Element</a></code>, then let <var data-anolis-xref="">related focus target</var>
     be the last entry in <var data-anolis-xref="">old chain</var>. Otherwise, let <var data-anolis-xref="">related
     focus target</var> be null.</li>

     <li>

      <p>If <var data-anolis-xref="">focus event target</var> is not null, <a href="#fire-a-focus-event">fire a focus event</a>
      named <code data-anolis-xref="event-focus"><a href="index.html#event-focus">focus</a></code> at <var data-anolis-xref="">focus event target</var>, with
      <var data-anolis-xref="">related focus target</var> as the related target.</p>

      <p class="note">In some cases, e.g. if <var data-anolis-xref="">entry</var> is an <code><a href="embedded-content.html#the-area-element">area</a></code>
      element's shape, a scrollable region, or a viewport, no event is fired.</p>

     </li>
   
    </ol></li>

  </ol><p>When a user agent is required to <dfn id="fire-a-focus-event">fire a focus event</dfn> named <var data-anolis-xref="">e</var> at
  an element <var data-anolis-xref="">t</var> and with a given related target <var data-anolis-xref="">r</var>, the user
  agent must create a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> <code><a href="infrastructure.html#focusevent">FocusEvent</a></code>
  object, initialise it to have the given name <var data-anolis-xref="">e</var>, to not bubble, to not be
  cancelable, and to have the <code data-anolis-xref="dom-FocusEvent-relatedTarget"><a href="infrastructure.html#dom-focusevent-relatedtarget">relatedTarget</a></code>
  attribute initialised to <var data-anolis-xref="">r</var>, and must then <a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">dispatch</a> the newly created <code><a href="infrastructure.html#focusevent">FocusEvent</a></code> object
  at the specified target element <var data-anolis-xref="">t</var>.</p>

  <hr><p>When a key event is to be routed in a <a href="browsers.html#top-level-browsing-context">top-level browsing context</a>, the user agent
  must run the following steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">target area</var> be the <a data-anolis-xref="currently focused area of a
   top-level browsing context" href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of the top-level browsing
   context</a>.</li>

   <li><p>If <var data-anolis-xref="">target area</var> is a <i><a href="#focusable-area">focusable area</a></i>, let <var data-anolis-xref="">target
   node</var> be <var data-anolis-xref="">target area</var>'s <i><a href="#dom-anchor">DOM anchor</a></i>. Otherwise, <var data-anolis-xref="">target area</var> is a <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>; let <var data-anolis-xref="">target node</var> be
   <var data-anolis-xref="">target area</var>.</li>

   <li>

    <p>If <var data-anolis-xref="">target node</var> is a <code><a href="dom.html#document">Document</a></code> that has a <a data-anolis-xref="the
    body element" href="dom.html#the-body-element-0">body element</a>, then let <var data-anolis-xref="">target node</var> be <a href="dom.html#the-body-element-0">the body
    element</a> of that <code><a href="dom.html#document">Document</a></code>.</p>

    <p>Otherwise, if <var data-anolis-xref="">target node</var> is a <code><a href="dom.html#document">Document</a></code> that has a
    <a href="infrastructure.html#root-element">root element</a>, then let <var data-anolis-xref="">target node</var> be the <a href="infrastructure.html#root-element">root
    element</a> of that <code><a href="dom.html#document">Document</a></code>.</p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">target node</var> is not <a href="#inert">inert</a>, fire the event at <var data-anolis-xref="">target node</var>.</p>

    <p class="note">It is possible for the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing
    context</a> to be <a href="#inert">inert</a>, for example if a <a data-anolis-xref="dom-dialog-showModal" href="interactive-elements.html#dom-dialog-showmodal">modal dialog is shown</a>, and then that <code><a href="interactive-elements.html#the-dialog-element">dialog</a></code>
    element is made <a href="#inert">inert</a>. It is likely to be the result of a logic error in the
    application, though.</p>

   </li>

   <li><p>If the event was not canceled, then let <var data-anolis-xref="">target area</var> handle the key
   event. This might include <a data-anolis-xref="run synthetic click activation steps" href="#run-synthetic-click-activation-steps">running synthetic
   click activation steps</a> for <var data-anolis-xref="">target node</var>.</li>

  </ol><h4 id="sequential-focus-navigation"><span class="secno">5.4.5 </span><dfn>Sequential focus navigation</dfn></h4>

  <p>Each <i><a href="#control-group">control group</a></i> has a <dfn id="sequential-focus-navigation-order">sequential focus navigation order</dfn>, which orders some
  or all of the <i data-anolis-xref="focusable area"><a href="#focusable-area">focusable areas</a></i> in the <a href="#control-group">control group</a>
  relative to each other. The order in the <a href="#sequential-focus-navigation-order">sequential focus navigation order</a> does not
  have to be related to the order in the <i><a href="#control-group">control group</a></i> itself. If a <i><a href="#focusable-area">focusable area</a></i> is
  omitted from the <a href="#sequential-focus-navigation-order">sequential focus navigation order</a> of its <i><a href="#control-group">control group</a></i>, then
  it is unreachable via <a href="#sequential-focus-navigation">sequential focus navigation</a>.</p>

  <p>When the user requests that focus move from the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level
  browsing context</a> to the next or previous <i><a href="#focusable-area">focusable area</a></i> (e.g. as the default action
  of pressing the <kbd>tab</kbd> key), or when the user requests that focus sequentially move to a
  <a href="browsers.html#top-level-browsing-context">top-level browsing context</a> in the first place (e.g. from the browser's location bar),
  the user agent must use the following algorithm:</p>

  <ol><li><p>Let <var data-anolis-xref="">starting point</var> be the <a href="#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level
   browsing context</a>, if the user requested to move focus sequentially from there, or else the
   <a href="browsers.html#top-level-browsing-context">top-level browsing context</a> itself, if the user instead requested to move focus from
   outside the <a href="browsers.html#top-level-browsing-context">top-level browsing context</a>.</li>

   <li>

    <p>Let <var data-anolis-xref="">direction</var> be <i>forward</i> if the user requested the <em>next</em>
    control, and <i>backward</i> if the user requested the previous control.</p>

    <p class="note">Typically, pressing <kbd>tab</kbd> requests the next control, and pressing
    <kbd><kbd>shift</kbd>+<kbd>tab</kbd></kbd> requests the previous control.</p>

   </li>

   <li>

    <p><i>Loop</i>: Let <var data-anolis-xref="">selection mechanism</var> be <i>sequential</i> if the <var data-anolis-xref="">starting point</var> is a <a href="browsers.html#browsing-context">browsing context</a> or if <var data-anolis-xref="">starting
    point</var> is in its <i><a href="#control-group">control group</a></i>'s <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>.</p>

    <p>Otherwise, <var data-anolis-xref="">starting point</var> is not in its <i><a href="#control-group">control group</a></i>'s
    <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>; let <var data-anolis-xref="">selection mechanism</var> be
    <i>DOM</i>.</p>

   </li>

   <li><p>Let <var data-anolis-xref="">candidate</var> be the result of running the <a href="#sequential-navigation-search-algorithm">sequential
   navigation search algorithm</a> with <var data-anolis-xref="">starting point</var>, <var data-anolis-xref="">direction</var>, and <var data-anolis-xref="">selection mechanism</var> as the
   arguments.</li>

   <li><p>If <var data-anolis-xref="">candidate</var> is not null, then run the <a href="#focusing-steps">focusing steps</a>
   for <var data-anolis-xref="">candidate</var> and abort these steps.</li>

   <li>

    <p>Otherwise, if <var data-anolis-xref="">starting point</var> is the <a href="browsers.html#top-level-browsing-context">top-level browsing
    context</a>, or a <i><a href="#focusable-area">focusable area</a></i> in the <a href="browsers.html#top-level-browsing-context">top-level browsing context</a>, the
    user agent should transfer focus to its own controls appropriately (if any), honouring <var data-anolis-xref="">direction</var>, and then abort these steps.</p>

    <p class="example">For example, if <var data-anolis-xref="">direction</var> is <i>backward</i>, then the
    last focusable control before the browser's rendering area would be the control to focus.</p>

    <p>If the user agent has no focusable controls — a kiosk-mode browser, for instance
    —  <!--and <var data-x="">starting point</var> is not the <span>top-level browsing
    context</span>,-->  then the user agent may instead restart these steps with the <var data-anolis-xref="">starting point</var> being the <a href="browsers.html#top-level-browsing-context">top-level browsing context</a> itself.</p><!-- in theory, the top-level browsing context _always_ has at least one focusable area: the
    viewport. Even a "blocked by a modal dialog" doesn't disable the viewport (since the Document is
    its DOM anchor, and the Document isn't made inert by "blocked by a modal dialog"). Note that
    nested browsing contexts can have inert viewports, though (if the browsing context container
    itself is inert, for example) -->

    

   </li>

   <li><p>Otherwise, <var data-anolis-xref="">starting point</var> is a <i><a href="#focusable-area">focusable area</a></i> in a
   <a href="browsers.html#nested-browsing-context">nested browsing context</a>. Let <var data-anolis-xref="">starting point</var> be that
   <a href="browsers.html#nested-browsing-context">nested browsing context</a>'s <a href="browsers.html#browsing-context-container">browsing context container</a>, and return to the
   step labeled <i>loop</i>.</p><!--
     http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2856
     http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2857
    -->
    
   </li>

  </ol><p>The <dfn id="sequential-navigation-search-algorithm">sequential navigation search algorithm</dfn> consists of the following steps. This
  algorithm takes three arguments: <var data-anolis-xref="">starting point</var>, <var data-anolis-xref="">direction</var>,
  and <var data-anolis-xref="">selection mechanism</var>.</p>

  <ol><li>

    <p>Pick the appropriate cell from the following table, and follow the instructions in that
    cell.</p>

    <p>The appropriate cell is the one that is from the column whose header describes <var data-anolis-xref="">direction</var> and from the first row whose header describes <var data-anolis-xref="">starting point</var> and <var data-anolis-xref="">selection mechanism</var>.</p>

    <table><thead><tr><th>
       </th><th> <var data-anolis-xref="">direction</var> is <i>forward</i>
       </th><th> <var data-anolis-xref="">direction</var> is <i>backward</i>
     <tbody></th></tr><tr><th><var data-anolis-xref="">starting point</var> is a <a href="browsers.html#browsing-context">browsing context</a>
       <td>Let <var data-anolis-xref="">candidate</var> be the first <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in <var data-anolis-xref="">starting point</var>'s <a href="browsers.html#active-document">active document</a>'s <a href="#primary-control-group">primary control group</a>, if any; or else null
       
       </td><td>Let <var data-anolis-xref="">candidate</var> be the last <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in <var data-anolis-xref="">starting point</var>'s <a href="browsers.html#active-document">active document</a>'s <a href="#primary-control-group">primary control group</a>, if any; or else null
      
      </td></th></tr><tr><th><var data-anolis-xref="">selection mechanism</var> is <i>DOM</i>
       <td>Let <var data-anolis-xref="">candidate</var> be the first <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in the <a href="#home-control-group">home control group</a> following <var data-anolis-xref="">starting point</var>, if any; or else null
       
       </td><td>Let <var data-anolis-xref="">candidate</var> be the last <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in the <a href="#home-control-group">home control group</a> preceding <var data-anolis-xref="">starting point</var>, if any; or else null
      
      </td></th></tr><tr><th><var data-anolis-xref="">selection mechanism</var> is <i>sequential</i>
       <td>Let <var data-anolis-xref="">candidate</var> be the first <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in the <a href="#home-sequential-focus-navigation-order">home sequential focus navigation order</a> following <var data-anolis-xref="">starting point</var>, if any; or else null
       
       </td><td>Let <var data-anolis-xref="">candidate</var> be the last <a href="#suitable-sequentially-focusable-area">suitable sequentially focusable area</a> in the <a href="#home-sequential-focus-navigation-order">home sequential focus navigation order</a> preceding <var data-anolis-xref="">starting point</var>, if any; or else null

    

    </td></th></tr></table><p>A <dfn id="suitable-sequentially-focusable-area">suitable sequentially focusable area</dfn> is a <i><a href="#focusable-area">focusable area</a></i> whose <i><a href="#dom-anchor">DOM
    anchor</a></i> is not <a href="#inert">inert</a> and that is in its <i><a href="#control-group">control group</a></i>'s <a href="#sequential-focus-navigation-order">sequential
    focus navigation order</a>.</p>

    <p>The <dfn id="primary-control-group">primary control group</dfn> of a <a href="#control-group-owner-object">control group owner object</a> <var data-anolis-xref="">X</var> is the <i><a href="#control-group">control group</a></i> of <var data-anolis-xref="">X</var> if <var data-anolis-xref="">X</var> has no <a href="#dialog-group">dialog group</a> or if its <a href="#dialog-group">dialog group</a> has no
    designated <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog group</a>, otherwise, it is the <a href="#primary-control-group">primary
    control group</a> of <var data-anolis-xref="">X</var>'s <a href="#dialog-group">dialog group</a>'s designated
    <a href="#focused-dialog-of-the-dialog-group">focused dialog of the dialog group</a>.</p>

    <p>The <dfn id="home-control-group">home control group</dfn> is the <i><a href="#control-group">control group</a></i> to which <var data-anolis-xref="">starting point</var> belongs.</p>

    <p>The <dfn id="home-sequential-focus-navigation-order">home sequential focus navigation order</dfn> is the <a href="#sequential-focus-navigation-order">sequential focus
    navigation order</a> to which <var data-anolis-xref="">starting point</var> belongs.</p>

    <p class="note">The <a href="#home-sequential-focus-navigation-order">home sequential focus navigation order</a> is the <a href="#home-control-group">home
    control group</a>'s <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>, but is only used when the
    <var data-anolis-xref="">starting point</var> is in that <a href="#sequential-focus-navigation-order">sequential focus navigation order</a>
    (when it's not, <var data-anolis-xref="">selection mechanism</var> will be <i>DOM</i>).</p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">candidate</var> is a <a href="browsers.html#browsing-context-container">browsing context container</a>, then let <var data-anolis-xref="">new candidate</var> be the result of running the <a href="#sequential-navigation-search-algorithm">sequential navigation search
    algorithm</a> with <var data-anolis-xref="">candidate</var>'s <a href="browsers.html#nested-browsing-context">nested browsing context</a> as
    the first argument, <var data-anolis-xref="">direction</var> as the second, and <i>sequential</i> <!--
    shift-tab from the end in http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2855 -->
    
    as the third.</p>

    <p>If <var data-anolis-xref="">new candidate</var> is null, then let <var data-anolis-xref="">starting point</var>
    be <var data-anolis-xref="">candidate</var>, and return to the top of this algorithm. Otherwise, let <var data-anolis-xref="">candidate</var> be <var data-anolis-xref="">new candidate</var>.</p>

   </li>

   <li><p><var data-anolis-xref="">candidate</var>を返す。</li>

  </ol></div><!--TOPIC:DOM APIs-->



  <h4 id="focus-management-apis"><span class="secno">5.4.6</span> フォーカス管理API</h4>

  <dl class="domintro"><dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-activeElement"><a href="#dom-document-activeelement">activeElement</a></code></dt>

   <dd>

    <p>キーイベントが送られるまたは送る文書における最も深い要素を返す。大まかに言って、これは文書における被フォーカス要素である。</p>

    <p>このAPIのために、<a href="browsers.html#child-browsing-context">子ブラウジングコンテキスト</a>が被フォーカスである場合、その<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>は<a href="browsers.html#parent-browsing-context">親ブラウジングコンテキスト</a>で<a href="#bc-focus-ergo-bcc-focus">被フォーカス</a>である。たとえば、ユーザーが<code><a href="embedded-content.html#the-iframe-element">iframe</a></code>でフォーカスをテキストフィールドに移動する場合、<code><a href="embedded-content.html#the-iframe-element">iframe</a></code>は<code><a href="embedded-content.html#the-iframe-element">iframe</a></code>の<code><a href="dom.html#document">Document</a></code>において<code data-anolis-xref="dom-document-activeElement"><a href="#dom-document-activeelement">activeElement</a></code> API によって返される要素である。</p>

   </dd>

   <dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-hasFocus"><a href="#dom-document-hasfocus">hasFocus</a></code>()</dt>

   <dd>

    <p>キーイベントが文書を通してまたは文書に向かって送られる場合にtrueを返し、そうでなければfalseを返す。大まかに言って、これは要素、この内側でネストされた文書、被フォーカスに対応する。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-focus"><a href="#dom-window-focus">focus</a></code>()</dt>

   <dd><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=2823 -->

    

    <p>可能であれば、フォーカスをウィンドウの<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>に移動する。</p>

   </dd><!--
   <dt><var data-x="">window</var> . <code data-x="dom-window-blur">blur</code>()</dt>

   <dd>

    <p>No effect.</p>

   </dd>
-->



   <dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-focus"><a href="#dom-focus">focus</a></code>()</dt>

   <dd>

    <p>フォーカスを要素に移動する。</p>

    <p>要素が<a href="dom.html#the-body-element-0">body要素</a>である場合、フォーカスを代わりにビューポートに移動する。</p>

   </dd>

   <dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-blur"><a href="#dom-blur">blur</a></code>()</dt>

   <dd>

    <p>Moves the focus to the viewport. このメソッドの使用が妨げられ、ビューポートにフォーカスしたい場合、<a href="dom.html#the-body-element-0">body要素</a>上の<code data-anolis-xref="dom-focus"><a href="#dom-focus">focus()</a></code>メソッドを呼び出す。</p>

    <p>フォーカスリングを非表示にするためにこの方法を使用してはならない。キーボードユーザーからフォーカスリングを隠して他の方法を使用してはならない。特に、'outline'プロパティーを上書きするためにCSS規則を使用してはならない。フォーカスリングの除去は、ナビゲートするおよびキーボードを使用してインタラクティブなコンテンツを操作するユーザーに対して重大なアクセシビリティーの問題をもたらす。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-document-activeElement" id="dom-document-activeelement"><code>activeElement</code></dfn> attribute on
  <code><a href="dom.html#document">Document</a></code> objects must return the value returned by the following steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">candidate</var> be the <code><a href="dom.html#document">Document</a></code> on which the method was
   invoked.</li>

   <li><p><var data-anolis-xref="">candidate</var>が指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>をともなう<i><a href="#dialog-group">ダイアロググループ</a></i>を持つ場合、<var data-anolis-xref="">candidate</var>を指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>にし、このステップを再実行する。</li>

   <li><p>If <var data-anolis-xref="">candidate</var> has a non-empty <i><a href="#control-group">control group</a></i>, let <var data-anolis-xref="">candidate</var> be the designated <a href="#focused-area-of-the-control-group">focused area of the control
   group</a>.</p>

   </li>

   <li><p>If <var data-anolis-xref="">candidate</var> is a <i><a href="#focusable-area">focusable area</a></i>, let <var data-anolis-xref="">candidate</var> be <var data-anolis-xref="">candidate</var>'s <i><a href="#dom-anchor">DOM anchor</a></i>.</li>

   <li>

    <p>If <var data-anolis-xref="">candidate</var> is a <code><a href="dom.html#document">Document</a></code> that has a <a data-anolis-xref="the
    body element" href="dom.html#the-body-element-0">body element</a>, then let <var data-anolis-xref="">candidate</var> be <a href="dom.html#the-body-element-0">the body
    element</a> of that <code><a href="dom.html#document">Document</a></code>.</p>

    <p>Otherwise, if <var data-anolis-xref="">candidate</var> is a <code><a href="dom.html#document">Document</a></code> that has a <a href="infrastructure.html#root-element">root
    element</a>, then let <var data-anolis-xref="">candidate</var> be the <a href="infrastructure.html#root-element">root element</a> of that
    <code><a href="dom.html#document">Document</a></code>.</p>

    <p>Otherwise, if <var data-anolis-xref="">candidate</var> is a <code><a href="dom.html#document">Document</a></code>, then let <var data-anolis-xref="">candidate</var> be null.</p>

   </li>

   <li><p><var data-anolis-xref="">candidate</var>を返す。</li>

  </ol><p>The <dfn data-anolis-xref="dom-document-hasFocus" id="dom-document-hasfocus"><code>hasFocus()</code></dfn> method on
  <code><a href="dom.html#document">Document</a></code> objects must return the value returned by the following steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">target</var> be the <code><a href="dom.html#document">Document</a></code> on which the method was
   invoked.</li>

   <li><p><var data-anolis-xref="">candidate</var>を<a href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>の <code><a href="dom.html#document">Document</a></code>にする。</li>

   <li><p>If <var data-anolis-xref="">candidate</var> is <var data-anolis-xref="">target</var>, return true and abort
   these steps.</li>

   <li>

    <p><var data-anolis-xref="">candidate</var>が指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>をともなう<i><a href="#dialog-group">ダイアロググループ</a></i>を持つ場合、<var data-anolis-xref="">candidate</var>を指定された<a href="#focused-dialog-of-the-dialog-group">ダイアロググループの被フォーカスダイアログ</a>にし、このステップを再実行する。</p>

    <p>Otherwise, if <var data-anolis-xref="">candidate</var> has a non-empty <i><a href="#control-group">control group</a></i>, and the
    designated <a href="#focused-area-of-the-control-group">focused area of the control group</a> is a <a href="browsers.html#browsing-context-container">browsing context
    container</a>, and the <a href="browsers.html#active-document">active document</a> of that <a href="browsers.html#browsing-context-container">browsing context
    container</a>'s <a href="browsers.html#nested-browsing-context">nested browsing context</a> is <var data-anolis-xref="">target</var>, then
    return true and abort these steps.</p>

    <p>そうでなければ、<var data-anolis-xref="">candidate</var>が空でない<i><a href="#control-group">コントロールグループ</a></i>を持ち、かつ指定された<a href="#focused-area-of-the-control-group">コントロールグループの被フォーカス領域</a>が<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>である場合、<var data-anolis-xref="">candidate</var>をその<a href="browsers.html#browsing-context-container">ブラウジングコンテキストコンテナ</a>の<a href="browsers.html#nested-browsing-context">ネストされるブラウジングコンテキスト</a>の<a href="browsers.html#active-document">アクティブ文書</a>にし、このステップを再実行する。</p>

    <p>Otherwise, return false and abort these steps.</p>

   </li>

  </ol><p>The <dfn data-anolis-xref="dom-window-focus" id="dom-window-focus"><code>focus()</code></dfn> method on the <code><a href="browsers.html#window">Window</a></code>
  object, when invoked, must run the <a href="#focusing-steps">focusing steps</a> with the <code><a href="browsers.html#window">Window</a></code>
  object's <a href="browsers.html#browsing-context">browsing context</a>. Additionally, if this <a href="browsers.html#browsing-context">browsing context</a> is a
  <a href="browsers.html#top-level-browsing-context">top-level browsing context</a>, user agents are encouraged to trigger some sort of
  notification to indicate to the user that the page is attempting to gain focus.</p>

  <p>The <dfn data-anolis-xref="dom-window-blur" id="dom-window-blur"><code>blur()</code></dfn> method on the <code><a href="browsers.html#window">Window</a></code>
  object, when invoked, provides a hint to the user agent that the script believes the user probably
  is not currently interested in the contents of the <a href="browsers.html#browsing-context">browsing context</a> of the
  <code><a href="browsers.html#window">Window</a></code> object on which the method was invoked, but that the contents might become
  interesting again in the future.</p>

  <p>User agents are encouraged to ignore calls to this <code data-anolis-xref="dom-window-blur"><a href="#dom-window-blur">blur()</a></code>
  method entirely.</p>

  <p class="note">Historically, the <code data-anolis-xref="dom-window-blur"><a href="#dom-window-blur">focus()</a></code> and <code data-anolis-xref="dom-window-blur"><a href="#dom-window-blur">blur()</a></code> methods actually affected the system-level focus of the
  system widget (e.g. tab or window) that contained the <a href="browsers.html#browsing-context">browsing context</a>, but hostile
  sites widely abuse this behavior to the user's detriment.</p>

  <p>The <dfn data-anolis-xref="dom-focus" id="dom-focus"><code>focus()</code></dfn> method on elements, when invoked, must
  run the following algorithm:</p>

  <ol><li><p>If the element is marked as <i><a href="#locked-for-focus">locked for focus</a></i>, then abort these steps.</li>

   <li><p>Mark the element as <dfn id="locked-for-focus">locked for focus</dfn>.</li>

   <li><p>Run the <a href="#focusing-steps">focusing steps</a> for the element.</li>

   <li><p>Unmark the element as <i><a href="#locked-for-focus">locked for focus</a></i>.</li>

  </ol><p>The <dfn data-anolis-xref="dom-blur" id="dom-blur"><code>blur()</code></dfn> method, when invoked, should run the
  <a href="#unfocusing-steps">unfocusing steps</a> for the element on which the method was called. User agents may
  selectively or uniformly ignore calls to this method for usability reasons.</p>

  <p class="example">For example, if the <code data-anolis-xref="dom-blur"><a href="#dom-blur">blur()</a></code> method is unwisely
  being used to remove the focus ring for aesthetics reasons, the page would become unusable by
  keyboard users. Ignoring calls to this method would thus allow keyboard users to interact with the
  page.</p>

  </div><!--TOPIC:HTML-->





  <h3 id="assigning-keyboard-shortcuts"><span class="secno">5.5</span> キーボードショートカットの割り当て</h3>

  <h4 id="introduction-5"><span class="secno">5.5.1</span> 導入</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>アクティブまたはフォーカスさせることができる各要素は<code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code>属性を使用して、それをアクティブにするための単一のキーの組み合わせを割り当てることができる。</p>

  <p>正確なショートカットは、ユーザーエージェントによって決定され、ユーザーのキーボードに関する情報に基づき、どのキーボードショートカットが既にプラットフォーム上に存在し、他にどのようなショートカットがページ上で指定され、ガイドとして<code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code>属性に提供された情報を使用する。</p>

  <p>関連するキーボードショートカットが多種多様な入力デバイスで利用可能であることを確実にするために、著者は<code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code>属性で多数の選択肢を提供できる。</p>

  <p>各選択肢は、文字または数字のような、単一の文字で構成される。</p>

  <p>ユーザーエージェントは、キーボードショートカットの一覧をユーザーに提供できるが、著者は行うことも推奨される。<code data-anolis-xref="dom-accessKeyLabel"><a href="#dom-accesskeylabel">accessKeyLabel</a></code> IDL属性は、ユーザーエージェントによって割り当てられた実際のキーの組み合わせを表す文字列を返す。</p>

  <div class="example">

   <p>この例において、著者はショートカットキーを使用して呼び出すことができるボタンを提供してきた。フルキーボードをサポートするために、著者は可能なキーとして"C"を提供している。テンキーのみを搭載したデバイスをサポートするために、著者は別の可能なキーとして"1"を提供している。</p>

   <pre>&lt;input type=button value=Collect onclick="collect()"
       <strong>accesskey="C 1"</strong> id=c&gt;</pre>

  </div>

  <div class="example">

   <p>ショートカットキーが何であるかをユーザーに伝えるために、著者は明示的にボタンのラベルにキーの組み合わせを追加するために選択しているここでのこのスクリプトを持つ。</p>

   <pre>function addShortcutKeyLabel(button) {
<strong>  if (button.accessKeyLabel != '')
    button.value += ' (' + button.accessKeyLabel + ')';</strong>
}
addShortcutKeyLabel(document.getElementById('c'));</pre>

   <p>異なるプラットフォーム上のブラウザは、たとえ同じキーの組み合わせであっても、そのプラットフォーム上で普及している規則に基づいて異なるラベルを表示する。たとえば、キーの組み合わせが、Controlキー、Shiftキー、および文字Cである場合、Macのブラウザが"<samp>^⇧C</samp>"を表示するかもしれない一方で、Windowsのブラウザは"<samp>Ctrl+Shift+C</samp>"を表示するかもしれない。一方でEmacsのブラウザは単に"<samp>C-C</samp>"を表示するかもしれない。同様に、キーの組み合わせがAltキーとEscキーである場合、Windowsは"<samp>Alt+Esc</samp>"を使用するかもしれず、Macは"<samp>⌥⎋</samp>"を使用するかもしれず、Emacsのブラウザは、"<samp>M-ESC</samp>"または"<samp>ESC ESC</samp>"を使用するかもしれない。</p>

   <p>したがって、一般に、<code data-anolis-xref="dom-accessKeyLabel"><a href="#dom-accesskeylabel">accessKeyLabel</a></code>IDL属性から返された値を解析しようとするのは賢明ではない。</p>

  </div>


  <h4 id="the-accesskey-attribute"><span class="secno">5.5.2</span> <dfn data-anolis-xref="attr-accesskey" id="attr-accesskey"><code>accesskey</code></dfn>属性</h4>

  <p>すべての<a href="infrastructure.html#html-elements">HTML要素</a>は、<code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code>コンテンツ属性の設定を持ってもよい。<code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code>属性値は、要素をアクティブまたはフォーカスするキーボードショートカットを作成するためのガイドとして、ユーザーエージェントによって使用される。</p>

  <p>指定される場合、値は<a href="infrastructure.html#case-sensitive">大文字・小文字区別</a>である<a href="infrastructure.html#ordered-set-of-unique-space-separated-tokens">一意なスペース区切りトークンの順序付き集合</a>でなければならず、その各々が正確に1つのUnicodeコードポイントの長さでなければならない。</p>

  <div class="example">

   <p>次の例において、サイトを熟知するキーボードユーザーがより迅速に関連するページに移動できるよう、さまざまなリンクがアクセスキーとともに与えられる：</p>

   <pre>&lt;nav&gt;
 &lt;p&gt;
  &lt;a title="Consortium Activities" accesskey="A" href="/Consortium/activities"&gt;Activities&lt;/a&gt; |
  &lt;a title="Technical Reports and Recommendations" accesskey="T" href="/TR/"&gt;Technical Reports&lt;/a&gt; |
  &lt;a title="Alphabetical Site Index" accesskey="S" href="/Consortium/siteindex"&gt;Site Index&lt;/a&gt; |
  &lt;a title="About This Site" accesskey="B" href="/Consortium/"&gt;About Consortium&lt;/a&gt; |
  &lt;a title="Contact Consortium" accesskey="C" href="/Consortium/contact"&gt;Contact&lt;/a&gt;
 &lt;/p&gt;
&lt;/nav&gt;</pre>

  </div>

  <div class="example">

   <p>次の例において、検索フィールドは2つの可能なアクセスキー、"s"と"0"（この順番で）が与えられる。テンキー付きの小さなデバイス上のユーザーエージェントは単なる簡素なキー<kbd><kbd>0</kbd></kbd>を選ぶかもしれないが、フルキーボードを搭載したデバイスでのユーザーエージェントは、ショートカットキーとして<kbd data-anolis-xref=""><kbd data-anolis-xref="">Ctrl</kbd>+<kbd data-anolis-xref="">Alt</kbd>+<kbd data-anolis-xref="">S</kbd></kbd>を選ぶかもしれない：</p>

   <pre>&lt;form action="/search"&gt;
 &lt;label&gt;Search: &lt;input type="search" name="q" accesskey="s 0"&gt;&lt;/label&gt;
 &lt;input type="submit"&gt;
&lt;/form&gt;</pre>

  </div>

  <div class="example">

   <p>次の例において、ボタンは説明可能なアクセスキーを持つ。このスクリプトは次に、ユーザーエージェントが選択したキーの組み合わせを通知するためにボタンのラベルの更新を試みる。</p>

   <pre>&lt;input type=submit accesskey="N @ 1" value="Compose"&gt;
...
&lt;script&gt;
 function labelButton(button) {
   if (button.accessKeyLabel)
     button.value += ' (' + button.accessKeyLabel + ')';
 }
 var inputs = document.getElementsByTagName('input');
 for (var i = 0; i &lt; inputs.length; i += 1) {
   if (inputs[i].type == "submit")
     labelButton(inputs[i]);
 }
&lt;/script&gt;</pre>

   <p>あるユーザーエージェントにおいて、ボタンのラベルは"<samp>Compose（⌘N）</samp>"になるかもしれない。別のものにおいて、これは"<samp>Compose（Alt+⇧+1）</samp>"になるかもしれない。ユーザーエージェントがキーを割り当てない場合、単に"<samp>Compose</samp>"になる。正確な文字列は<a href="#assigned-access-key">割り当てられるアクセスキー</a>が何であるか、およびどのようにユーザーエージェントがそのキーの組み合わせを表すかに依存する。</p>

  </div>


  <div class="impl">

  <h4 id="processing-model-5"><span class="secno">5.5.3 </span>Processing model</h4>

  <p>An element's <dfn id="assigned-access-key">assigned access key</dfn> is a key combination derived from the element's
  <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> content attribute. Initially, an element must not
  have an <a href="#assigned-access-key">assigned access key</a>.</p>

  <p>Whenever an element's <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> attribute is set, changed,
  or removed, the user agent must update the element's <a href="#assigned-access-key">assigned access key</a> by running
  the following steps:</p>

  <ol><li><p>If the element has no <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> attribute, then skip
   to the <i>fallback</i> step below.</li>

   <li><p>Otherwise, <a data-anolis-xref="split a string on spaces" href="infrastructure.html#split-a-string-on-spaces">split the attribute's value on
   spaces</a>, and let <var data-anolis-xref="">keys</var> be the resulting tokens.</li>

   <li>

    <p>For each value in <var data-anolis-xref="">keys</var> in turn, in the order the tokens appeared in the
    attribute's value, run the following substeps:</p>

    <ol><li><p>If the value is not a string exactly one Unicode code point in length, then skip the
     remainder of these steps for this value.</li>

     <li><p>If the value does not correspond to a key on the system's keyboard, then skip the
     remainder of these steps for this value.</li>

     <li><p>If the user agent can find a mix of zero or more modifier keys that, combined with the
     key that corresponds to the value given in the attribute, can be used as the access key, then
     the user agent may assign that combination of keys as the element's <a href="#assigned-access-key">assigned access
     key</a> and abort these steps.
     
     <span class="fingerprint" title="fingerprinting vector"><a href="introduction.html#fingerprinting-vector"><img alt="(This is a fingerprinting vector.)" height="21" src="http://www.w3.org/TR/html5/images/fingerprint.png" width="15"></a></span>
     </li>

    </ol></li>

   <li><p><i>Fallback</i>: Optionally, the user agent may assign a key combination of its choosing
   as the element's <a href="#assigned-access-key">assigned access key</a> and then abort these steps.</li>

   <li><p>If this step is reached, the element has no <a href="#assigned-access-key">assigned access key</a>.</li>

  </ol><p>Once a user agent has selected and assigned an access key for an element, the user agent should
  not change the element's <a href="#assigned-access-key">assigned access key</a> unless the <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> content attribute is changed or the element is moved to
  another <code><a href="dom.html#document">Document</a></code>.</p>

  <p>When the user presses the key combination corresponding to the <a href="#assigned-access-key">assigned access key</a>
  for an element, if the element <a data-anolis-xref="concept-command" href="interactive-elements.html#concept-command">defines a command</a>, the
  command's <a data-anolis-xref="command-facet-HiddenState" href="interactive-elements.html#command-facet-hiddenstate">Hidden State</a> facet is false (visible),
  the command's <a data-anolis-xref="command-facet-DisabledState" href="interactive-elements.html#command-facet-disabledstate">Disabled State</a> facet is also false
  (enabled), the element is <a href="infrastructure.html#in-a-document">in a <code>Document</code></a> that has an associated
  <a href="browsers.html#browsing-context">browsing context</a>, and neither the element nor any of its ancestors has a <code data-anolis-xref="attr-hidden"><a href="#the-hidden-attribute">hidden</a></code> attribute specified, then the user agent must trigger the <a data-anolis-xref="command-facet-Action" href="interactive-elements.html#command-facet-action">Action</a> of the command.</p>

  <p class="note">User agents <a href="interactive-elements.html#expose-commands-in-ui">might expose</a> elements that have
  an <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> attribute in other ways as well, e.g. in a menu
  displayed in response to a specific key combination.</p><!-- the actual conformance criteria for
  this is in the section that defines commands --> 

  <hr><p>The <dfn data-anolis-xref="dom-accessKey" id="dom-accesskey"><code>accessKey</code></dfn> IDL attribute must
  <a href="infrastructure.html#reflect">reflect</a> the <code data-anolis-xref="attr-accesskey"><a href="#the-accesskey-attribute">accesskey</a></code> content attribute.</p>

  <p>The <dfn data-anolis-xref="dom-accessKeyLabel" id="dom-accesskeylabel"><code>accessKeyLabel</code></dfn> IDL attribute must return
  a string that represents the element's <a href="#assigned-access-key">assigned access key</a>, if any. If the element
  does not have one, then the IDL attribute must return the empty string.</p>

  </div>



  <h3 id="editing-0"><span class="secno">5.6</span> 編集</h3>

  <h4 id="contenteditable"><span class="secno">5.6.1</span> 編集可能な文書領域を作成する：<code data-anolis-xref="attr-contenteditable"><a href="#attr-contenteditable">contenteditable</a></code>コンテンツ属性</h4>

  <p><dfn data-anolis-xref="attr-contenteditable" id="attr-contenteditable"><code>contenteditable</code></dfn>属性は、キーワードが空文字列、<code data-anolis-xref="">true</code>、おとび<code data-anolis-xref="">false</code>となる<a href="infrastructure.html#enumerated-attribute">列挙属性</a>である。空の文字列および<i>true</i>キーワードは、<code data-anolis-xref="">true</code>状態に対応する。<i>false</i>キーワードは、<code data-anolis-xref="">false</code>状態に対応する。さらに、<i>inherit</i>状態という第3の状態が存在する。これは<i>欠落した値のデフォルト</i>（および<i>妥当でない値のデフォルト</i>）である。</p>

  <p><i>true</i>状態は、要素が編集可能であることを示す。<i>inherit</i>状態は、その親が存在する場合、要素が編集可能であることを示す。<i>false</i>状態は、要素が編集可能でないことを示す。</p>

  <dl class="domintro"><dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-contentEditable"><a href="#dom-contenteditable">contentEditable</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p><code data-anolis-xref="attr-contenteditable"><a href="#attr-contenteditable">contenteditable</a></code>属性の状態に基づいて、"<code data-anolis-xref="">true</code>"、"<code data-anolis-xref="">false</code>"、または"<code data-anolis-xref="">inherit</code>"を返す。</p>

    <p>その状態を変更する設定が可能である。</p>

    <p>新しい値がこれらの文字列のいずれかでない場合、<code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code>例外を投げる。</p>

   </dd>

   <dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-isContentEditable"><a href="#dom-iscontenteditable">isContentEditable</a></code></dt>

   <dd>

    <p>要素が編集可能な場合にtrueを返す。そうでなければfalseを返す。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-contentEditable" id="dom-contenteditable"><code>contentEditable</code></dfn> IDL attribute, on
  getting, must return the string "<code data-anolis-xref="">true</code>" if the content attribute is set to
  the true state, "<code data-anolis-xref="">false</code>" if the content attribute is set to the false state,
  and "<code data-anolis-xref="">inherit</code>" otherwise. On setting, if the new value is an <a href="infrastructure.html#ascii-case-insensitive">ASCII
  case-insensitive</a> match for the string "<code data-anolis-xref="">inherit</code>" then the content
  attribute must be removed, if the new value is an <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> match for
  the string "<code data-anolis-xref="">true</code>" then the content attribute must be set to the string
  "<code data-anolis-xref="">true</code>", if the new value is an <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> match for
  the string "<code data-anolis-xref="">false</code>" then the content attribute must be set to the string
  "<code data-anolis-xref="">false</code>", and otherwise the attribute setter must throw a
  <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception.</p>

  <p>The <dfn data-anolis-xref="dom-isContentEditable" id="dom-iscontenteditable"><code>isContentEditable</code></dfn> IDL attribute, on
  getting, must return true if the element is either an <a href="#editing-host">editing host</a> or
  <a href="#editable">editable</a>, and false otherwise.</p>

  </div>


  <h4 id="making-entire-documents-editable:-the-designmode-idl-attribute"><span class="secno">5.6.2</span> 文書全体を編集可能にする：<code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code>IDL属性</h4>

  <div class="impl">

  <p>Documents have a <dfn data-anolis-xref="dom-document-designMode" id="designMode"><code>designMode</code></dfn>, which can be either enabled or
  disabled.</p>

  </div>

  <dl class="domintro"><dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>文書が編集可能である場合に"<code data-anolis-xref="">on</code>"を返し、ない場合に"<code data-anolis-xref="">off</code>"を返す。</p>

    <p>文書の現在の状態を変更する設定が可能である。これは、文書をフォーカスし、その文書で文書の選択をリセットする。</p>

   </dd>

  </dl><div class="impl">

  <p>The <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> IDL attribute on the
  <code><a href="dom.html#document">Document</a></code> object takes two values, "<code data-anolis-xref="">on</code>" and "<code data-anolis-xref="">off</code>". On setting, the new value must be compared in an <a href="infrastructure.html#ascii-case-insensitive">ASCII
  case-insensitive</a> manner to these two values; if it matches the "<code data-anolis-xref="">on</code>"
  value, then <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> must be enabled, and if it
  matches the "<code data-anolis-xref="">off</code>" value, then <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> must be disabled. Other values must be
  ignored.</p>

  <p>On getting, if <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> is enabled, the IDL
  attribute must return the value "<code data-anolis-xref="">on</code>"; otherwise it is disabled, and the
  attribute must return the value "<code data-anolis-xref="">off</code>".</p>

  <p>The last state set must persist until the document is destroyed or the state is changed.
  Initially, documents must have their <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code>
  disabled.</p>

  <p>When the <code data-anolis-xref="dom-document-designMode"><a href="#designMode">designMode</a></code> changes from being disabled to
  being enabled, the user agent must synchronously reset the document's <a href="#active-range">active range</a>'s
  start and end boundary points to be at the start of the <code><a href="dom.html#document">Document</a></code> and then run the
  <a href="#focusing-steps">focusing steps</a> for the root element of the <code><a href="dom.html#document">Document</a></code>, if any.</p>

  </div>


  <h4 id="best-practices-for-in-page-editors"><span class="secno">5.6.3</span> ページ内編集者のためのベストプラクティス</h4>

  <p>著者は、もともと値'pre-wrap'へこれら編集のメカニズムを介して作成された<a data-anolis-xref="editing host" href="#editing-host">ホストを編集</a>およびマークアップ上の'white-space'プロパティーを設定するよう推奨する。デフォルトのHTML空白処理は、あまりWYSIWYG編集に向かず、そして'white-space'がデフォルト値のままである場合、いくつかのコーナーの場合において、行の折り返しは正しく動作しない。</p>

  <div class="example">

   <p>デフォルト'normal'値が代わりに使用される場合に発生する問題の例として、単語の間に2つのスペース（ここでは"␣"によって表される）とともに、"<kbd>yellow␣␣ball</kbd>"と入力したユーザーの場合を考える。'white-space'のデフォルト値（'normal'）のための場所での編集規則ともに、結果のマークアップは、"<samp>yellow&amp;nbsp;&nbsp;ball</samp>"または"<samp>yellow&nbsp;&amp;nbsp;ball</samp>"のいずれかで構成される。すなわち、2つの単語間の非開票スペースに加えて、通常スペースが存在するだろう。'white-space'に対する'normal'値は共に相殺するために隣接する通常スペースを必要とするため、これは必要である。</p>

   <p>前者の場合において、たとえ行の末尾で"<samp>yellow</samp>"単独で一致するとしても、"<samp>yellow⍽</samp>"は次の行（"⍽"は非改行スペースを表すためにここで使用されている）に折り返す。後者の場合において、行の先頭に包まれる場合、"<samp>⍽ball</samp>"は非改行スペース由来の可視インデントを持つだろう。</p>

   <p>しかし、'white-space'が'pre-wrap'に設定される場合、編集規則は、代わりに単に単語間に2つの通常のスペースを置き、2つの単語が行末で分割されるべきであり、スペースはレンダリングから削除されてきれいになる。</p>

  </div>



  <h4 id="editing-apis"><span class="secno">5.6.4</span> 編集API</h4>

  <p>用語<dfn id="active-range">アクティブ範囲</dfn>、<dfn id="editing-host">編集ホスト</dfn>、および<dfn id="editable">編集可能</dfn>の定義、<a data-anolis-xref="editing
  host" href="#editing-host">編集ホスト</a>または<a href="#editable">編集可能</a>である要素のユーザーインターフェース要件、<dfn data-anolis-xref="dom-document-execCommand" id="execCommand"><code>execCommand()</code></dfn>、<dfn data-anolis-xref="dom-document-queryCommandEnabled" id="dom-document-querycommandenabled"><code>queryCommandEnabled()</code></dfn>、<dfn data-anolis-xref="dom-document-queryCommandIndeterm" id="dom-document-querycommandindeterm"><code>queryCommandIndeterm()</code></dfn>、<dfn data-anolis-xref="dom-document-queryCommandState" id="dom-document-querycommandstate"><code>queryCommandState()</code></dfn>、<dfn data-anolis-xref="dom-document-queryCommandSupported" id="dom-document-querycommandsupported"><code>queryCommandSupported()</code></dfn>、および<dfn data-anolis-xref="dom-document-queryCommandValue" id="dom-document-querycommandvalue"><code>queryCommandValue()</code></dfn>メソッド、テキスト選択、および<dfn id="delete-the-selection">選択削除</dfn>アルゴリズムは、HTML Editing API仕様で定義される。編集のインタラクションおよびユーザーエージェントでのアンドゥ/リドゥ機能は、UndoManagerおよびDOM Transaction仕様によって定義される。<a href="references.html#refsEDITING">[EDITING]</a> <a href="references.html#refsUNDO">[UNDO]</a></p><!-- those might get merged in here eventually -->

  



  <h4 id="spelling-and-grammar-checking"><span class="secno">5.6.5</span> スペルと文法チェック</h4>

  <div class="impl">

  <p>User agents can support the checking of spelling and grammar of editable text, either in form
  controls (such as the value of <code><a href="forms.html#the-textarea-element">textarea</a></code> elements), or in elements in an <a href="#editing-host">editing
  host</a> (e.g. using <code data-anolis-xref="attr-contenteditable"><a href="#attr-contenteditable">contenteditable</a></code>).</p>

  <p>For each element, user agents must establish a <dfn data-anolis-xref="concept-spellcheck-default" id="concept-spellcheck-default">default
  behavior</dfn>, either through defaults or through preferences expressed by the user. There are
  three possible default behaviors for each element:</p>

  <dl><dt><dfn data-anolis-xref="concept-spellcheck-default-true" id="concept-spellcheck-default-true">true-by-default</dfn>

   <dd>The element will be checked for spelling and grammar if its contents are editable.

   

   <dt><dfn data-anolis-xref="concept-spellcheck-default-false" id="concept-spellcheck-default-false">false-by-default</dfn>

   <dd>The element will never be checked for spelling and grammar.

   

   <dt><dfn data-anolis-xref="concept-spellcheck-default-inherit" id="concept-spellcheck-default-inherit">inherit-by-default</dfn>

   <dd>The element's default behavior is the same as its parent element's. Elements that have no
   parent element cannot have this as their default behavior.

  

  </dl><hr></div>

  <p><dfn data-anolis-xref="attr-spellcheck" id="attr-spellcheck"><code>spellcheck</code></dfn>属性は、キーワードが空文字列、<code data-anolis-xref="">true</code>および<code data-anolis-xref="">false</code>となる<a href="infrastructure.html#enumerated-attribute">列挙属性</a>である。空の文字列および<i>true</i>キーワードは、<code data-anolis-xref="">true</code>状態に対応する。<i>false</i>キーワードは、<code data-anolis-xref="">false</code>状態に対応する。さらに、<i>default</i>状態という第3の状態が存在する。これは<i>欠落した値のデフォルト</i>（および<i>妥当でない値のデフォルト</i>）である。</p>

  <p class="note"><i>true</i>状態は、要素がそのスペルおよび文法チェックを持つことを示す。<i>default</i>状態は、以下で定義されるように、親要素の独自の<code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code>状態におそらく基づいて、デフォルトの動作に応じて動作する要素であることを示す。<i>false</i>状態は、要素がチェックされないことを示す。</p>

  <div class="impl">

  <hr></div>

  <dl class="domintro"><dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-spellcheck"><a href="#dom-spellcheck">spellcheck</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>要素がスペルや文法チェックを持つ場合はtrueを返す。そうでなければfalseを返す。</p>

    <p>デフォルトを上書きして<code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code>コンテンツ属性を設定するための、設定が可能である。</p>

   </dd>


   <dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-forceSpellCheck"><a href="#dom-forcespellcheck">forceSpellCheck</a></code>()</dt>

   <dd>

    <p>ユーザーが要素にフォーカスを当てたことがない場合でも、（チェックが有効である場合）要素のスペルと文法エラーを報告することをユーザーエージェントに強制する。（メソッドが呼び出されない場合、ユーザーエージェントは、単にユーザーによって入力されなかったテキストのエラーを非表示にできる。）</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-spellcheck" id="dom-spellcheck"><code>spellcheck</code></dfn> IDL attribute, on getting, must
  return true if the element's <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content attribute is
  in the <i>true</i> state, or if the element's <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code>
  content attribute is in the <i>default</i> state and the element's <a data-anolis-xref="concept-spellcheck-default" href="#concept-spellcheck-default">default behavior</a> is <a data-anolis-xref="concept-spellcheck-default-true" href="#concept-spellcheck-default-true">true-by-default</a>, or if the element's <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content attribute is in the <i>default</i> state and the
  element's <a data-anolis-xref="concept-spellcheck-default" href="#concept-spellcheck-default">default behavior</a> is <a data-anolis-xref="concept-spellcheck-default-inherit" href="#concept-spellcheck-default-inherit">inherit-by-default</a> and the element's parent
  element's <code data-anolis-xref="dom-spellcheck"><a href="#dom-spellcheck">spellcheck</a></code> IDL attribute would return true;
  otherwise, if none of those conditions applies, then the attribute must instead return false.</p>

  <p class="note">The <code data-anolis-xref="dom-spellcheck"><a href="#dom-spellcheck">spellcheck</a></code> IDL attribute is not affected
  by user preferences that override the <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content
  attribute, and therefore might not reflect the actual spellchecking state.</p>

  <p>On setting, if the new value is true, then the element's <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content attribute must be set to the literal string
  "<code data-anolis-xref="">true</code>", otherwise it must be set to the literal string "<code data-anolis-xref="">false</code>".

  

  <hr><p>User agents must only consider the following pieces of text as checkable for the purposes of
  this feature:</p>

  <ul><li>The <a data-anolis-xref="concept-fe-value" href="forms.html#concept-fe-value">value</a> of <code><a href="forms.html#the-input-element">input</a></code> elements whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attributes are in the <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a>, <a data-anolis-xref="attr-input-type-search" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Search</a>,
   <a data-anolis-xref="attr-input-type-url" href="forms.html#url-state-(type=url)">URL</a>, or <a data-anolis-xref="attr-input-type-email" href="forms.html#e-mail-state-(type=email)">E-mail</a> states and that are <i data-anolis-xref="concept-fe-mutable"><a href="forms.html#concept-fe-mutable">mutable</a></i> (i.e. that do not have the <code data-anolis-xref="attr-input-readonly"><a href="forms.html#attr-input-readonly">readonly</a></code> attribute specified and that are not <a data-anolis-xref="concept-fe-disabled" href="forms.html#concept-fe-disabled">disabled</a>).</li>

   <li>The <a data-anolis-xref="concept-fe-value" href="forms.html#concept-fe-value">value</a> of <code><a href="forms.html#the-textarea-element">textarea</a></code> elements that do not
   have a <code data-anolis-xref="attr-textarea-readonly"><a href="forms.html#attr-textarea-readonly">readonly</a></code> attribute and that are not <a data-anolis-xref="concept-fe-disabled" href="forms.html#concept-fe-disabled">disabled</a>.</li>

   <li>Text in <code><a href="infrastructure.html#text-0">Text</a></code> nodes that are children of <a data-anolis-xref="editing host" href="#editing-host">editing
   hosts</a> or <a href="#editable">editable</a> elements.</li>

   <li>Text in attributes of <a href="#editable">editable</a> elements.</li>

  </ul><p>For text that is part of a <code><a href="infrastructure.html#text-0">Text</a></code> node, the element with which the text is
  associated is the element that is the immediate parent of the first character of the word,
  sentence, or other piece of text. For text in attributes, it is the attribute's element. For the
  values of <code><a href="forms.html#the-input-element">input</a></code> and <code><a href="forms.html#the-textarea-element">textarea</a></code> elements, it is the element itself.</p>

  <p>To determine if a word, sentence, or other piece of text in an applicable element (as defined
  above) is to have spelling- and grammar-checking enabled, the UA must use the following
  algorithm:</p>

  <ol><!-- user override --><li>If the user has disabled the checking for this text, then the checking is disabled.</li>

   <li>Otherwise, if the user has forced the checking for this text to always be enabled, then the
   checking is enabled.</li><!-- content attribute: on, off -->

   

   <li>Otherwise, if the element with which the text is associated has a <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content attribute, then: if that attribute is in the
   <i>true</i> state, then checking is enabled; otherwise, if that attribute is in the <i>false</i>
   state, then checking is disabled.</li><!-- inherit, if there is one to inherit from -->

   

   <li>Otherwise, if there is an ancestor element with a <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code> content attribute that is not in the <i>default</i>
   state, then: if the nearest such ancestor's <code data-anolis-xref="attr-spellcheck"><a href="#attr-spellcheck">spellcheck</a></code>
   content attribute is in the <i>true</i> state, then checking is enabled; otherwise, checking is
   disabled.</li><!-- default -->

   

   <li>Otherwise, if the element's <a data-anolis-xref="concept-spellcheck-default" href="#concept-spellcheck-default">default behavior</a>
   is <a data-anolis-xref="concept-spellcheck-default-true" href="#concept-spellcheck-default-true">true-by-default</a>, then checking is
   enabled.</li>

   <li>Otherwise, if the element's <a data-anolis-xref="concept-spellcheck-default" href="#concept-spellcheck-default">default behavior</a>
   is <a data-anolis-xref="concept-spellcheck-default-false" href="#concept-spellcheck-default-false">false-by-default</a>, then checking is
   disabled.</li><!-- default inheritance -->

   

   <li>Otherwise, if the element's parent element has <em>its</em> checking enabled, then checking
   is enabled.</li>

   <li>Otherwise, checking is disabled.</li>

  </ol><p>If the checking is enabled for a word/sentence/text, the user agent should indicate spelling
  and grammar errors in that text. User agents should take into account the other semantics given in
  the document when suggesting spelling and grammar corrections. User agents may use the language of
  the element to determine what spelling and grammar rules to use, or may use the user's preferred
  language settings. UAs should use <code><a href="forms.html#the-input-element">input</a></code> element attributes such as <code data-anolis-xref="attr-input-pattern"><a href="forms.html#attr-input-pattern">pattern</a></code> to ensure that the resulting value is valid, where
  possible.</p>

  <p>If checking is disabled, the user agent should not indicate spelling or grammar errors for that
  text.</p>

  <p>Even when checking is enabled, user agents may opt to not report spelling or grammar errors in
  text that the user agent deems the user has no interest in having checked (e.g. text that was
  already present when the page was loaded, or that the user did not type, or text in controls that
  the user has not focused, or in parts of e-mail addresses that the user agent is not confident
  were misspelt). The <dfn data-anolis-xref="dom-forceSpellCheck" id="dom-forcespellcheck"><code>forceSpellCheck()</code></dfn> method,
  when invoked on an element, must override this behavior, forcing the user agent to consider all
  spelling and grammar errors in text in that element for which checking is enabled to be of
  interest to the user.</p>

  <div class="example">

   <p>The element with ID "a" in the following example would be the one used to determine if the
   word "Hello" is checked for spelling errors. In this example, it would not be.</p>

   <pre>&lt;div contenteditable="true"&gt;
 &lt;span spellcheck="false" id="a"&gt;Hell&lt;/span&gt;&lt;em&gt;o!&lt;/em&gt;
&lt;/div&gt;</pre>

   <p>The element with ID "b" in the following example would have checking enabled (the leading
   space character in the attribute's value on the <code><a href="forms.html#the-input-element">input</a></code> element causes the attribute
   to be ignored, so the ancestor's value is used instead, regardless of the default).</p>

   <pre class="bad">&lt;p spellcheck="true"&gt;
 &lt;label&gt;Name: &lt;input spellcheck=" false" id="b"&gt;&lt;/label&gt;
&lt;/p&gt;</pre>

  </div>

  </div>

  <p class="note">この仕様は、スペルや文法チェッカーに対するユーザーインターフェースを定義しない。ユーザーエージェントはオンデマンドチェックを提供するかもしれず、チェックが有効である間に連続的なチェックを実行するかもしれず、または他のインターフェースを使用するかもしれない。</p>


  <h3 id="dnd"><span class="secno">5.7</span> <dfn>ドラッグアンドドロップ</dfn></h3><!-- v2: ideas for drag and drop:

     * being able to animate a drop target:

       > To implement this with simple interface I've proposed, events should be handled either by
       > existing elements (like list items that compare their size and position of dragged element
       > to decide whether element should be dropped before or after) or handled by container that
       > would probably need to calculate positions of it's children and create new element to show
       > drop target. Smooth Mac-like drag'n'drop can be implemented by animating drop target's
       > padding/margin. So that's quite a bit of code that's going to be reinvented each time
       > someone implements reordering.

       <hyatt> :droptarget
       <hyatt> or something
       <hyatt> we don't support a pseudo-class for the drop target but that's a great idea
       <Hixie_> yeah, thinking about that too
       <Hixie_> :drop-target, :drop-target(above), :drop-target(below) and having ondragover be able to say "not on me, but next to me maybe"

       - some way to be able to match an element that is being dragged over.

       - some way to be able to animate an element as it goes into and out of this state (CSS
         transitions?), e.g. to be able to animate something "getting out of the way" to let you
         drop an item between others.

       - as an extension to the previous feature, a way to distinguish being dragged above or to the
         left of the drag target vs below or to the right of the drag target.

     * We should let drop targets communicate back to drag sources if they want to communicate.
       (e.g. expose Window, and thus postMessage(), on the dataTransfer object on drop.) Or maybe
       just use a MessagePort!

       We should let drag sources provide a set of options via a context menu when the drop happens.
       (So that, e.g., the source can know whether a capabilities URI that it is passing along is
       supposed to be read-write access or read-only access to the object being dragged.)

       We should let potential drop targets see the types (but not the contents!) of dragged data so
       they can establish if they care or not. (dataTransfer.hasType())

       Ack: Ben Laurie (@g)

     * Interop with native apps. In particular, we probably want to whitelist the list of types that
       a Web page can see, since otherwise we'll end up exposing things like the username (if a user
       drags a file from their desktop, the path is exposed on some OSes).

     * Alex Velkov suggests that drags to and from the same origin should be able to read the data
       even before the drop.

     Other things listed below:
      DND-v2: more native support: text/html from selections, etc
      DND-v3: add Blob support
      DND-v4: add structured clone support
      DND-v5: add promises (should be able to say "if you accept this
              drop, then I can provide the File object that
              corresponds to it eventually")

         DataTransferPromise.type = 'string' or 'file' or 'blob' or 'data'
                            .onneeddata - can wait until this fires to provide data
                            .setData() - call this once you have data, must be the right type

-->



  <p>このセクションは、イベントベースのドラッグアンドドロップのメカニズムを定義する。</p>

  <p>この仕様は、<em>ドラッグアンドドロップ操作</em>が実際に何であるかを正確に定義しない。</p>

  <p>ポインティングデバイスをもつ視覚メディア上に、ドラッグ操作は一連の<code data-anolis-xref="event-mousemove"><a href="infrastructure.html#event-mousemove">mousemove</a></code>イベントが続く<code data-anolis-xref="event-mousedown"><a href="infrastructure.html#event-mousedown">mousedown</a></code>イベントのデフォルトアクションであるかもしれず、ドロップは解放されているマウスによって引き起こされるかもしれない。</p>

  <p>ポインティングデバイス以外の入力モダリティーを使用する場合、ユーザーはおそらくドラッグアンドドロップ操作を実行するために明示的に意思表示する必要があり、それらがドラッグを望み、ドロップを望む場所を、それぞれ主張する。</p>

  <div class="impl">

  <p>However it is implemented, drag-and-drop operations must have a starting point (e.g. where the
  mouse was clicked, or the start of the selection or element that was selected for the drag), may
  have any number of intermediate steps (elements that the mouse moves over during a drag, or
  elements that the user picks as possible drop points as he cycles through possibilities), and must
  either have an end point (the element above which the mouse button was released, or the element
  that was finally selected), or be canceled. The end point must be the last element selected as a
  possible drop point before the drop occurs (so if the operation is not canceled, there must be at
  least one element in the middle step).</p>

  </div>


  <h4 id="introduction-6"><span class="secno">5.7.1</span> 導入</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>要素をドラッグ可能にすることは簡単である：要素に<code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code>属性を与え、ドラッグされているデータを格納する<code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>ドラッグに対してイベントリスナーを設定する。</p>

  <p>イベントハンドラは典型的に、それがドラッグされているテキスト選択でないことをチェックする必要があり、次に<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトにデータを格納し、許可される効果（コピー、移動、リンク、またはいくつかの組み合わせ）を設定する必要がある。</p>

  <p>たとえば：</p>

  <pre>&lt;p&gt;What fruits do you like?&lt;/p&gt;
&lt;ol ondragstart="dragStartHandler(event)"&gt;
 &lt;li draggable="true" data-value="fruit-apple"&gt;Apples&lt;/li&gt;
 &lt;li draggable="true" data-value="fruit-orange"&gt;Oranges&lt;/li&gt;
 &lt;li draggable="true" data-value="fruit-pear"&gt;Pears&lt;/li&gt;
&lt;/ol&gt;
&lt;script&gt;
  var internalDNDType = 'text/x-example'; // set this to something specific to your site
  function dragStartHandler(event) {
    if (event.target instanceof HTMLLIElement) {
      // use the element's data-value="" attribute as the value to be moving:
      event.dataTransfer.setData(internalDNDType, event.target.dataset.value);
      event.dataTransfer.effectAllowed = 'move'; // only allow moves
    } else {
      event.preventDefault(); // don't allow selection to be dragged
    }
  }
&lt;/script&gt;</pre>

  <hr><p>ドロップを受け入れるために、ドロップターゲットが<code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性を持つ必要があり、<code data-anolis-xref="drop-event">drop</code>イベントをリッスンする必要がある。</p>

  <p><code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性値は、どのデータの種類を受け入れるか（たとえば任意のテキスト文字列を受け入れる"<code data-anolis-xref="">string:text/plain</code>"、またはPNG画像ファイルを受け入れる"<code>file:image/png</code>"など）およびどのフィードバックの種類を与えるかを指定する（たとえばデータが移動されることを示すために"<code>move</code>"など）。</p>

  <p class="note"><code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性を使用する代わりに、ドロップターゲットは、<code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code>イベント（ドロップターゲットがドロップを受け入れるかどうかを報告する）および<code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code>イベント（フィードバックがユーザーに表示されるかを指定する）を処理できる。</p>

  <p><code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code>イベントは実際のドロップを許可する。このイベントは、<code data-anolis-xref="dom-DataTransfer-DropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code>属性値がソースで使用できるので、キャンセルする必要がある（そうでなければリセットである）。</p>

  <p>たとえば：</p>

  <pre>&lt;p&gt;Drop your favorite fruits below:&lt;/p&gt;
&lt;ol dropzone="move string:text/x-example" ondrop="dropHandler(event)"&gt;
 &lt;!-- don't forget to change the "text/x-example" type to something
 specific to your site --&gt;
&lt;/ol&gt;
&lt;script&gt;
  var internalDNDType = 'text/x-example'; // set this to something specific to your site
  function dropHandler(event) {
    var li = document.createElement('li');
    var data = event.dataTransfer.getData(internalDNDType);
    if (data == 'fruit-apple') {
      li.textContent = 'Apples';
    } else if (data == 'fruit-orange') {
      li.textContent = 'Oranges';
    } else if (data == 'fruit-pear') {
      li.textContent = 'Pears';
    } else {
      li.textContent = 'Unknown Fruit';
    }
    event.target.appendChild(li);
  }
&lt;/script&gt;</pre>

  <hr><p>ディスプレイからオリジナルの要素（ドラッグされたもの）を削除するために、<code data-anolis-xref="event-dnd-dragend"><a href="#event-dnd-dragend">dragend</a></code>イベントを使用できる。</p>

  <p>ここで私たちの例のために、それはそのイベントを処理するために元のマークアップを更新することを意味する：</p>

  <pre>&lt;p&gt;What fruits do you like?&lt;/p&gt;
&lt;ol ondragstart="dragStartHandler(event)" ondragend="dragEndHandler(event)"&gt;
 <em>...as before...</em>
&lt;/ol&gt;
&lt;script&gt;
  function dragStartHandler(event) {
    // <em>...as before...</em>
  }
  function dragEndHandler(event) {
    if (event.dataTransfer.dropEffect == 'move') {
      // remove the dragged element
      event.target.parentNode.removeChild(event.target);
    }
  }
&lt;/script&gt;</pre>



  <h4 id="the-drag-data-store"><span class="secno">5.7.2</span> ドラッグデータストア</h4>

  <p><dfn id="drag-data-store">ドラッグデータストア</dfn>として知られる、ドラッグアンドドロップ操作を支えるデータは次の情報で構成される：</p>

  <ul><li><p>ドラッグされたデータを表すアイテムのリストである<dfn id="drag-data-store-item-list">ドラッグデータストアアイテムリスト</dfn>は、次の情報で構成される：</p>

    <dl><dt><dfn id="the-drag-data-item-kind">ドラッグデータアイテムの種類</dfn></dt>

     <dd>

      <p>データの種類：</p>

      <dl><dt><i>プレーンUnicode文字列</i></dt>
       <dd>
        <p>Text.</p>
       </dd><!-- DND-v3:
       <dt><i data-x="">Blob</i></dt>
       <dd>
        <p>Binary data.</p>
       </dd>
-->



       <dt><i data-anolis-xref="">File</i></dt>
       <dd>
        <p>ファイル名をもつバイナリデータ。</p>
       </dd><!-- DND-v4:
       <dt><i>Structured object</i></dt>
       <dd>
        <p>An object that will be cloned using the <span>structured clone</span> algorithm.</p>
       </dd>
-->



      </dl></dd>

     <dt><dfn id="the-drag-data-item-type-string">ドラッグデータ項目型文字列</dfn></dt>

     <dd>

      <p>一般に<a href="infrastructure.html#mime-type">MIMEタイプ</a>で指定される、データ型やフォーマットを与えるユニコード文字列。<a data-anolis-xref="MIME type" href="infrastructure.html#mime-type">MIMEタイプ</a>でない一部の値は、レガシー理由により特別扱いされる。APIは<a data-anolis-xref="MIME
      type" href="infrastructure.html#mime-type">MIMEタイプ</a>の使用を強制しない。他の値も同様に使用できる。しかし、すべての場合において値は、APIによってすべて<a href="infrastructure.html#converted-to-ascii-lowercase">ASCII小文字に変換される</a>。</p>

      <p class="note"><a data-anolis-xref="space character" href="infrastructure.html#space-character">空白文字</a>を含む文字列は、<code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性とともに使用できないので、著者は<a data-anolis-xref="MIME type" href="infrastructure.html#mime-type">MIMEタイプ</a>のみまたは（スペースなしの）カスタム文字列を使用するよう推奨される。</p>

      <p><a data-anolis-xref="The drag data
      item type string" href="#the-drag-data-item-type-string">項目型文字列</a>ごとに1つの<i>プレーンUnicode文字列</i>の制限が存在する。</p><!-- DND-v4: consider limiting the structured
      objects too --> 

     </dd>

     <dt>実際のデータ</dt>

     <dd><p>ファイル名（それ自体Unicode文字列）をもつ一部の場合において、<a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>ごとのように、Unicodeまたはバイナリ文字列。</dd>

    </dl><p><a href="#drag-data-store-item-list">ドラッグデータストア項目リスト</a>は、項目がリストに追加された順序で並べられ、最近では最後に追加された。</p>

   </li>

   <li>

    <p>ドラッグ中のUIフィードバックを生成するために使用される、以下の情報：</p>

    <ul><li><dfn id="drag-data-store-default-feedback">ドラッグデータストアのデフォルトフィードバック</dfn>として知られる、ユーザーエージェント定義のデフォルトフィードバック情報。</li>

     <li>任意で、<dfn id="drag-data-store-bitmap">ドラッグデータストアビットマップ</dfn>および<dfn id="drag-data-store-hot-spot-coordinate">ドラッグデータストアホットスポット座標</dfn>として知られる、そのイメージ内にあるビットマップ画像とポイント座標。</li>

    </ul></li>

   <li>

    <p>次のいずれかである<dfn id="drag-data-store-mode">ドラッグデータストアモード</dfn>：</p>

    <dl><dt><dfn data-anolis-xref="concept-dnd-rw" id="concept-dnd-rw">読み書きモード</dfn></dt>
     <dd>

      <p><code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>イベントに対して。新しいデータは<a href="#drag-data-store">ドラッグデータストア</a>に追加できる。</p>

     </dd>

     <dt><dfn data-anolis-xref="concept-dnd-ro" id="concept-dnd-ro">読み取り専用モード</dfn></dt>
     <dd>

      <p><code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code>イベントに対して。ドラッグされたデータを表す項目のリストは、データも含めて、読み取り可能である。新たなデータは追加できない。</p>

     </dd>

     <dt><dfn data-anolis-xref="concept-dnd-p" id="concept-dnd-p">保護モード</dfn></dt>
     <dd>

      <p>他のすべてのイベントに対して。ドラッグされたデータを表す項目の<a href="#drag-data-store">ドラッグデータストア</a>リストで形式および種類は列挙されるが、データ自体が使用できず、新たなデータは追加できない。</p>

     </dd>

    </dl></li>

   <li>

    <p>文字列である、<dfn id="drag-data-store-allowed-effects-state">ドラッグデータストアの許可された効果の状態</dfn>。</p>

   </li>

  </ul><p><a href="#drag-data-store">ドラッグデータストア</a>が<dfn data-anolis-xref="create a drag data store" id="create-a-drag-data-store">作成</dfn>された場合、それはその<a href="#drag-data-store-item-list">ドラッグデータストアアイテムリスト</a>が空であるように初期化されなければならず、それは<a href="#drag-data-store-default-feedback">ドラッグデータストアのデフォルトフィードバック</a>を持たず、<a href="#drag-data-store-bitmap">ドラッグデータストアのビットマップ</a>および<a href="#drag-data-store-hot-spot-coordinate">ドラッグデータストアのホットスポット座標</a>を持たず、その<a href="#drag-data-store-mode">ドラッグデータストアモード</a>は<a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>であり、その<a href="#drag-data-store-allowed-effects-state">ドラッグデータストアの許可された効果の状態</a>は文字列"<code data-anolis-xref="">uninitialized</code>"である。</p>


  <h4 id="the-datatransfer-interface"><span class="secno">5.7.3</span> <code><a href="#datatransfer">DataTransfer</a></code>インターフェース</h4>

  <p><code><a href="#datatransfer">DataTransfer</a></code>オブジェクトは、ドラッグアンドドロップ操作を支える<a href="#drag-data-store">ドラッグデータストア</a>を公開するために使用される。</p>

  <pre class="idl">interface <dfn id="datatransfer">DataTransfer</dfn> {
           attribute DOMString <a data-anolis-xref="dom-DataTransfer-dropEffect" href="#dom-datatransfer-dropeffect">dropEffect</a>;
           attribute DOMString <a data-anolis-xref="dom-DataTransfer-effectAllowed" href="#dom-datatransfer-effectallowed">effectAllowed</a>;

  readonly attribute <a href="#datatransferitemlist">DataTransferItemList</a> <a data-anolis-xref="dom-DataTransfer-items" href="#dom-datatransfer-items">items</a>;

  void <a data-anolis-xref="dom-DataTransfer-setDragImage" href="#dom-datatransfer-setdragimage">setDragImage</a>(Element image, long x, long y);

  /* old interface */
  readonly attribute DOMString[] <a data-anolis-xref="dom-DataTransfer-types" href="#dom-datatransfer-types">types</a>;
  DOMString <a data-anolis-xref="dom-DataTransfer-getData" href="#dom-datatransfer-getdata">getData</a>(DOMString format);
  void <a data-anolis-xref="dom-DataTransfer-setData" href="#dom-datatransfer-setdata">setData</a>(DOMString format, DOMString data);
  void <a data-anolis-xref="dom-DataTransfer-clearData" href="#dom-datatransfer-cleardata">clearData</a>(optional DOMString format);
  readonly attribute <a href="infrastructure.html#filelist">FileList</a> <a data-anolis-xref="dom-DataTransfer-files" href="#dom-datatransfer-files">files</a>;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>現在選択されている操作の種類を返す。操作の種類が<code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code>属性によって許可されるものの1つでない場合、操作は失敗する。</p>

    <p>選択した操作を変更す設定が可能である。</p>

    <p>可能な値は、"<code data-anolis-xref="">none</code>"、"<code data-anolis-xref="">copy</code>"、"<code data-anolis-xref="">link</code>"、および"<code data-anolis-xref="">move</code>"である。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>許可される操作の種類を返す。</p>

    <p>許可される操作を変更するために、（<code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>イベント中に）設定可能である。</p>

    <p>可能な値は、"<code data-anolis-xref="">none</code>"、"<code data-anolis-xref="">copy</code>"、"<code data-anolis-xref="">copyLink</code>"、"<code data-anolis-xref="">copyMove</code>"、"<code data-anolis-xref="">link</code>"、"<code data-anolis-xref="">linkMove</code>"、"<code data-anolis-xref="">move</code>"、"<code data-anolis-xref="">all</code>"、および"<code data-anolis-xref="">uninitialized</code>"である。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-items"><a href="#dom-datatransfer-items">items</a></code></dt>

   <dd>

    <p>ドラッグデータとともに、<code><a href="#datatransferitemlist">DataTransferItemList</a></code>オブジェクトを返す。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-setDragImage"><a href="#dom-datatransfer-setdragimage">setDragImage</a></code>(<var data-anolis-xref="">element</var>, <var data-anolis-xref="">x</var>, <var data-anolis-xref="">y</var>)</dt>

   <dd>

    <p>以前に指定されたフィードバックを置換し、ドラッグフィードバックを更新するために指定された要素を使用する。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-types"><a href="#dom-datatransfer-types">types</a></code></dt>

   <dd>

    <p><code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>イベントで設定されたフォーマットを列挙する配列を返す。さらに、任意のファイルがドラッグされている場合、型の1つは文字列"<code data-anolis-xref="">Files</code>"となる。</p>

   </dd>


   <dt><var data-anolis-xref="">data</var> = <var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-getData"><a href="#dom-datatransfer-getdata">getData</a></code>(<var data-anolis-xref="">format</var>)</dt>

   <dd>

    <p>指定されたデータを返す。そのようなデータが存在しない場合、空の文字列を返す。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-setData"><a href="#dom-datatransfer-setdata">setData</a></code>(<var data-anolis-xref="">format</var>, <var data-anolis-xref="">data</var>)</dt>

   <dd>

    <p>指定されたデータを追加する。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-clearData"><a href="#dom-datatransfer-cleardata">clearData</a></code>( [ <var data-anolis-xref="">format</var> ] )</dt>

   <dd>

    <p>指定した書式のデータを削除する。引数が省略された場合、すべてのデータを削除する。</p>

   </dd>


   <dt><var data-anolis-xref="">dataTransfer</var> . <code data-anolis-xref="dom-DataTransfer-files"><a href="#dom-datatransfer-files">files</a></code></dt>

   <dd>

    <p>もしあれば、ドラッグされているファイルの<code><a href="infrastructure.html#filelist">FileList</a></code>を返す。</p>

   </dd>

  </dl><p><code><a href="#datatransfer">DataTransfer</a></code>オブジェクトは<a href="#dndevents">ドラッグアンドドロップイベント</a>の間に使用され、それらのイベントが発生している間のみ有効である。</p>

  <div class="impl">

  <p>A <code><a href="#datatransfer">DataTransfer</a></code> object is associated with a <a href="#drag-data-store">drag data store</a> while it
  is valid.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransfer-dropEffect" id="dom-datatransfer-dropeffect"><code>dropEffect</code></dfn> attribute controls
  the drag-and-drop feedback that the user is given during a drag-and-drop operation. When the
  <code><a href="#datatransfer">DataTransfer</a></code> object is created, the <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> attribute is set to a string value. On
  getting, it must return its current value. On setting, if the new value is one of "<code data-anolis-xref="">none</code>", "<code data-anolis-xref="">copy</code>", "<code data-anolis-xref="">link</code>", or "<code data-anolis-xref="">move</code>", then the attribute's current value must be set to the new value. Other
  values must be ignored.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransfer-effectAllowed" id="dom-datatransfer-effectallowed"><code>effectAllowed</code></dfn> attribute is
  used in the drag-and-drop processing model to initialise the <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> attribute during the <code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code> and <code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code> events.
  When the <code><a href="#datatransfer">DataTransfer</a></code> object is created, the <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code> attribute is set to a string value. On
  getting, it must return its current value. On setting, if <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is the <a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">read/write
  mode</a> and the new value is one of "<code data-anolis-xref="">none</code>", "<code data-anolis-xref="">copy</code>", "<code data-anolis-xref="">copyLink</code>", "<code data-anolis-xref="">copyMove</code>", "<code data-anolis-xref="">link</code>", "<code data-anolis-xref="">linkMove</code>", "<code data-anolis-xref="">move</code>", "<code data-anolis-xref="">all</code>", or "<code data-anolis-xref="">uninitialized</code>", then the attribute's current value
  must be set to the new value. Otherwise it must be left unchanged.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransfer-items" id="dom-datatransfer-items"><code>items</code></dfn> attribute must return a
  <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object associated with the <code><a href="#datatransfer">DataTransfer</a></code> object. The
  same object must be returned each time.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransfer-setDragImage" id="dom-datatransfer-setdragimage"><code>setDragImage(<var data-anolis-xref="">element</var>,
  <var data-anolis-xref="">x</var>, <var data-anolis-xref="">y</var>)</code></dfn> method must run the following
  steps:</p>

  <ol><li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, abort these steps. Nothing happens.</li>

   <li><p>If the <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is
   not the <a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">read/write mode</a>, abort these steps. Nothing
   happens.</li>

   <li><p>If the <var data-anolis-xref="">element</var> argument is an <code><a href="embedded-content.html#the-img-element">img</a></code> element, then set the
   <a href="#drag-data-store-bitmap">drag data store bitmap</a> to the element's image (at its intrinsic size); otherwise,
   set the <a href="#drag-data-store-bitmap">drag data store bitmap</a> to an image generated from the given element (the
   exact mechanism for doing so is not currently specified).</li>

   <li><p>Set the <a href="#drag-data-store-hot-spot-coordinate">drag data store hot spot coordinate</a> to the given <var data-anolis-xref="">x</var>, <var data-anolis-xref="">y</var> coordinate.</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransfer-types" id="dom-datatransfer-types"><code>types</code></dfn> attribute must return a
  <a href="infrastructure.html#live">live</a> <a data-anolis-xref="dfn-read-only-array" href="infrastructure.html#dfn-read-only-array">read only</a> array giving the strings that
  the following steps would produce. The same object must be returned each time.</p>

  <ol><li><p>Start with an empty list <var data-anolis-xref="">L</var>.</li>

   <li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, the array is empty. Abort these steps; return the empty list <var data-anolis-xref="">L</var>.</li>

   <li><p>For each item in the <a href="#drag-data-store-item-list">drag data store item list</a> <!-- in some order...? -->
   
   whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i>, add an
   entry to the list <var data-anolis-xref="">L</var> consisting of the item's <a data-anolis-xref="the drag data item
   type string" href="#the-drag-data-item-type-string">type string</a>.</li>

   <li><p>If there are any items in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i><a href="infrastructure.html#file">File</a></i>, then add an entry to the list <var data-anolis-xref="">L</var> consisting of the string "<code data-anolis-xref="">Files</code>". (This value can be
   distinguished from the other values because it is not lowercase.)</li><!-- <li><p>Sort the list...?</p></li> -->

   

   <li><p>The strings produced by these steps are those in the list <var data-anolis-xref="">L</var>.</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransfer-getData" id="dom-datatransfer-getdata"><code>getData(<var data-anolis-xref="">format</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, return the empty string and abort these steps.</li>

   <li><p>If the <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is
   the <a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">protected mode</a>, return the empty string and abort these
   steps.</li>

   <li><p>Let <var data-anolis-xref="">format</var> be the first argument, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII
   lowercase</a>.</li>

   <li><p>Let <var data-anolis-xref="">convert-to-URL</var> be false.</li>

   <li><p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">text</code>", change it to "<code data-anolis-xref="">text/plain</code>".</li>

   <li><p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">url</code>", change it to "<code data-anolis-xref="">text/uri-list</code>" and set <var data-anolis-xref="">convert-to-URL</var> to true.</li>

   <li><p>If there is no item in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the
   drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i> and whose <a data-anolis-xref="the drag
   data item type string" href="#the-drag-data-item-type-string">type string</a> is equal to <var data-anolis-xref="">format</var>, return the
   empty string and abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">result</var> be the data of the item in the <a href="#drag-data-store-item-list">drag data store item
   list</a> whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode
   string</i> and whose <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">type string</a> is equal to
   <var data-anolis-xref="">format</var>.</li>

   <li><p>If <var data-anolis-xref="">convert-to-URL</var> is true, then parse <var data-anolis-xref="">result</var> as
   appropriate for <code data-anolis-xref="">text/uri-list</code> data, and then set <var data-anolis-xref="">result</var>
   to the first URL from the list, if any, or the empty string otherwise. <a href="references.html#refsRFC2483">[RFC2483]</a></li>

   <li><p>Return <var data-anolis-xref="">result</var>.</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransfer-setData" id="dom-datatransfer-setdata"><code>setData(<var data-anolis-xref="">format</var>, <var data-anolis-xref="">data</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, abort these steps. Nothing happens.</li>

   <li><p>If the <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is
   not the <a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">read/write mode</a>, abort these steps. Nothing
   happens.</li>

   <li><p>Let <var data-anolis-xref="">format</var> be the first argument, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII
   lowercase</a>.</li>

   <li>

    <p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">text</code>", change it to "<code data-anolis-xref="">text/plain</code>".</p>

    <p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">url</code>", change it to "<code data-anolis-xref="">text/uri-list</code>".</p>

   </li>

   <li><p>Remove the item in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag
   data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i> and whose <a data-anolis-xref="the drag data
   item type string" href="#the-drag-data-item-type-string">type string</a> is equal to <var data-anolis-xref="">format</var>, if there is
   one.</li>

   <li><p>Add an item to the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag data
   item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i>, whose <a data-anolis-xref="the drag data item type
   string" href="#the-drag-data-item-type-string">type string</a> is equal to <var data-anolis-xref="">format</var>, and whose data is the string
   given by the method's second argument.</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransfer-clearData" id="dom-datatransfer-cleardata"><code>clearData()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, abort these steps. Nothing happens.</li>

   <li><p>If the <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is
   not the <a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">read/write mode</a>, abort these steps. Nothing
   happens.</li>

   <li><p>If the method was called with no arguments, remove each item in the <a href="#drag-data-store-item-list">drag data store
   item list</a> whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode
   string</i>, and abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">format</var> be the first argument, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII
   lowercase</a>.</li>

   <li>

    <p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">text</code>", change it to "<code data-anolis-xref="">text/plain</code>".</p>

    <p>If <var data-anolis-xref="">format</var> equals "<code data-anolis-xref="">url</code>", change it to "<code data-anolis-xref="">text/uri-list</code>".</p>

   </li>

   <li><p>Remove the item in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag
   data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i> and whose <a data-anolis-xref="the drag data
   item type string" href="#the-drag-data-item-type-string">type string</a> is equal to <var data-anolis-xref="">format</var>, if there is
   one.</li>

  </ol><p class="note">The <code data-anolis-xref="dom-DataTransfer-clearData"><a href="#dom-datatransfer-cleardata">clearData()</a></code> method does not
  affect whether any files were included in the drag, so the <code data-anolis-xref="dom-DataTransfer-types"><a href="#dom-datatransfer-types">types</a></code> attribute's list might still not be empty after
  calling <code data-anolis-xref="dom-DataTransfer-clearData"><a href="#dom-datatransfer-cleardata">clearData()</a></code> (it would still contain the
  "<code data-anolis-xref="">Files</code>" string if any files were included in the drag).</p>

  <p>The <dfn data-anolis-xref="dom-DataTransfer-files" id="dom-datatransfer-files"><code>files</code></dfn> attribute must return a
  <a href="infrastructure.html#live">live</a> <code><a href="infrastructure.html#filelist">FileList</a></code> sequence consisting of <code><a href="infrastructure.html#file">File</a></code> objects
  representing the files found by the following steps. The same object must be returned each time.
  Furthermore, for a given <code><a href="infrastructure.html#filelist">FileList</a></code> object and a given underlying file, the same
  <code><a href="infrastructure.html#file">File</a></code> object must be used each time.</p>

  <ol><li><p>Start with an empty list <var data-anolis-xref="">L</var>.</li>

   <li><p>If the <code><a href="#datatransfer">DataTransfer</a></code> object is no longer associated with a <a href="#drag-data-store">drag data
   store</a>, the <code><a href="infrastructure.html#filelist">FileList</a></code> is empty. Abort these steps; return the empty list <var data-anolis-xref="">L</var>.</li>

   <li><p>If the <a href="#drag-data-store">drag data store</a>'s <a data-anolis-xref="drag data store mode" href="#drag-data-store-mode">mode</a> is
   the <a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">protected mode</a>, abort these steps; return the empty list
   <var data-anolis-xref="">L</var>.</li>

   <li><p>For each item in the <a href="#drag-data-store-item-list">drag data store item list</a> <!-- in some order...? -->
   
   whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i><a href="infrastructure.html#file">File</a></i> <!-- DND-v3: (not
   <i>Blob</i>) -->, add the item's data (the file, in particular its name and contents, as well as
   its <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">type</a>) to the list <var data-anolis-xref="">L</var>.</li><!-- <li><p>Sort the list...?</p></li> -->

   

   <li><p>The files found by these steps are those in the list <var data-anolis-xref="">L</var>.</li>

  </ol><p class="note">This version of the API does not expose the types of the files during the
  drag.</p>

  </div>


  <h5 id="the-datatransferitemlist-interface"><span class="secno">5.7.3.1</span> <code><a href="#datatransferitemlist">DataTransferItemList</a></code>インターフェース</h5>

  <p>各<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトは<code><a href="#datatransferitemlist">DataTransferItemList</a></code>オブジェクトに関連付けられる。</p>

  <pre class="idl">interface <dfn id="datatransferitemlist">DataTransferItemList</dfn> {
  readonly attribute unsigned long <a data-anolis-xref="dom-DataTransferItemList-length" href="#dom-datatransferitemlist-length">length</a>;
  <a data-anolis-xref="dom-DataTransferItemList-item" href="#dom-datatransferitemlist-item">getter</a> <a href="#datatransferitem">DataTransferItem</a> (unsigned long index);
  <a href="#datatransferitem">DataTransferItem</a>? <a data-anolis-xref="dom-DataTransferItemList-add" href="#dom-datatransferitemlist-add">add</a>(DOMString data, DOMString type);<!--
DND-v3:  <span>DataTransferItem</span>? <span data-x="dom-DataTransferItemList-add">add</span>(<span>Blob</span> data);-->
  <a href="#datatransferitem">DataTransferItem</a>? <a data-anolis-xref="dom-DataTransferItemList-add" href="#dom-datatransferitemlist-add">add</a>(<a href="infrastructure.html#file">File</a> data);<!--
DND-v4:  <span>DataTransferItem</span>? <span data-x="dom-DataTransferItemList-add">add</span>(any data, DOMString type);--><!--
DND-v5:  <span>DataTransferItem</span>? <span data-x="dom-DataTransferItemList-add">add</span>(<span>DataTransferPromise</span> data);-->
  void <a data-anolis-xref="dom-DataTransferItemList-remove" href="#dom-datatransferitemlist-remove">remove</a>(unsigned long index);
  void <a data-anolis-xref="dom-DataTransferItemList-clear" href="#dom-datatransferitemlist-clear">clear</a>();
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">items</var> . <code data-anolis-xref="dom-DataTransferItemList-length"><a href="#dom-datatransferitemlist-length">length</a></code></dt>

   <dd><p><a href="#drag-data-store">ドラッグデータストア</a>内のアイテムの数を返す。</dd>


   <dt><var data-anolis-xref="">items</var>[<var data-anolis-xref="">index</var>]</dt>

   <dd>

    <p><a href="#drag-data-store">ドラッグデータストア</a>内の<var data-anolis-xref="">index</var>番目のエントリを表す<code><a href="#datatransferitem">DataTransferItem</a></code>オブジェクトを返す。</p>

   </dd>


   <dt><var data-anolis-xref="">items</var> . <code data-anolis-xref="dom-DataTransferItemList-remove"><a href="#dom-datatransferitemlist-remove">remove</a></code>(<var data-anolis-xref="">index</var>)</dt>

   <dd>

    <p><a href="#drag-data-store">ドラッグデータストア</a>内の<var data-anolis-xref="">index</var>番目のエントリを削除する。</p>

   </dd>


   <dt><var data-anolis-xref="">items</var> . <code data-anolis-xref="dom-DataTransferItemList-clear"><a href="#dom-datatransferitemlist-clear">clear</a></code>()</dt>

   <dd>

    <p><a href="#drag-data-store">ドラッグデータストア</a>内のすべてのエントリを削除する。</p>

   </dd>


   <dt><var data-anolis-xref="">items</var> . <code data-anolis-xref="dom-DataTransferItemList-add"><a href="#dom-datatransferitemlist-add">add</a></code>(<var data-anolis-xref="">data</var>)</dt>
   <dt><var data-anolis-xref="">items</var> . <code data-anolis-xref="dom-DataTransferItemList-add"><a href="#dom-datatransferitemlist-add">add</a></code>(<var data-anolis-xref="">data</var>, <var data-anolis-xref="">type</var>)</dt>

   <dd>

    <p><a href="#drag-data-store">ドラッグデータストア</a>に指定されたデータに対する新しいエントリを追加する。データはプレーンテキストの場合、 <!-- DND-v4: or an object --> <var data-anolis-xref="">type</var>文字列でも提供されなければならない。</p>

   </dd>

  </dl><div class="impl">

  <p>While the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code> object is
  associated with a <a href="#drag-data-store">drag data store</a>, the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object's
  <i>mode</i> is the same as the <a href="#drag-data-store-mode">drag data store mode</a>. When the
  <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code> object is <em>not</em>
  associated with a <a href="#drag-data-store">drag data store</a>, the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object's
  <i>mode</i> is the <i>disabled mode</i>. The <a href="#drag-data-store">drag data store</a> referenced in this
  section (which is used only when the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object is not in the
  <i>disabled mode</i>) is the <a href="#drag-data-store">drag data store</a> with which the
  <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code> object is associated.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransferItemList-length" id="dom-datatransferitemlist-length"><code>length</code></dfn> attribute must
  return zero if the object is in the <i>disabled mode</i>; otherwise it must return the number of
  items in the <a href="#drag-data-store-item-list">drag data store item list</a>.</p>

  <p>When a <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object is not in the <i>disabled mode</i>, its
  <a href="infrastructure.html#supported-property-indices">supported property indices</a> are the numbers in the range

    <span data-anolis-xref="">0 .. <var data-anolis-xref="">n</var>-1</span>,

  where <var data-anolis-xref="">n</var> is the number of items in the <a href="#drag-data-store-item-list">drag data store item
  list</a>.</p>

  <p>To <dfn data-anolis-xref="dom-DataTransferItemList-item" id="dom-datatransferitemlist-item">determine the value of an indexed property</dfn>
  <var data-anolis-xref="">i</var> of a <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object, the user agent must return a
  <code><a href="#datatransferitem">DataTransferItem</a></code> object representing the <var data-anolis-xref="">i</var>th item in the
  <a href="#drag-data-store">drag data store</a>. The same object must be returned each time a particular item is
  obtained from this <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object. The <code><a href="#datatransferitem">DataTransferItem</a></code>
  object must be associated with the same <code><a href="#datatransfer">DataTransfer</a></code> object as the
  <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object when it is first created.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransferItemList-add" id="dom-datatransferitemlist-add"><code>add()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object is not in the <i data-anolis-xref="concept-dnd-rw"><a href="#concept-dnd-rw">read/write mode</a></i>, return null and abort these steps.</li>

   <li>

    <p>Jump to the appropriate set of steps from the following list:</p>

    <dl class="switch"><dt>If the first argument to the method is a string</dt>

     <dd>

      <p>If there is already an item in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i> and whose <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">type string</a> is equal to the value of the
      method's second argument, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>, then throw a
      <code><a href="infrastructure.html#notsupportederror">NotSupportedError</a></code> exception and abort these steps.</p>

      <p>Otherwise, add an item to the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the
      drag data item kind" href="#the-drag-data-item-kind">kind</a> is <i>Plain Unicode string</i>, whose <a data-anolis-xref="the drag
      data item type string" href="#the-drag-data-item-type-string">type string</a> is equal to the value of the method's second
      argument, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>, and whose data is the string given by the
      method's first argument.</p>

     </dd><!--DND-v3:
     <dt>If the first argument to the method is a <code>Blob</code></dt>

     <dd>

      <p>Add an item to the <span>drag data store item list</span> whose <span data-x="the drag data
      item kind">kind</span> is <i>Blob</i>, whose <span data-x="the drag data item type string">type
      string</span> is the <code data-x="dom-Blob-type">type</code> of the <code>Blob</code>,
      <span>converted to ASCII lowercase</span>, and whose data is the same as the
      <code>Blob</code>'s data.</p>

     </dd>
-->



     <dt>If the first argument to the method is a <code><a href="infrastructure.html#file">File</a></code></dt>

     <dd>

      <p>Add an item to the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag data
      item kind" href="#the-drag-data-item-kind">kind</a> is <i><a href="infrastructure.html#file">File</a></i>, whose <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">type
      string</a> is the <code data-anolis-xref="dom-Blob-type"><a href="infrastructure.html#dom-blob-type">type</a></code> of the <code><a href="infrastructure.html#file">File</a></code>,
      <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>, and whose data is the same as the
      <code><a href="infrastructure.html#file">File</a></code>'s data.</p>

     </dd><!--DND-v4: (might want to prevent duplicates like for strings; see above)
[make sure that the cloning happens before any side-effects can happen]
     <dt>Otherwise

     <dd>

      <p>Add an item to the <span>drag data store item list</span> whose <span data-x="the drag data
      item kind">kind</span> is <i>Object</i>, whose <span data-x="the drag data item type
      string">type string</span> is equal to the value of the method's second argument,
      <span>converted to ASCII lowercase</span>, and whose data is a <span>structured clone</span>
      of the method's first argument. If creating the clone throws an exception, then throw that
      exception and abort these steps.</p>

     </dd>
-->



    </dl></li>

   <li><p><a data-anolis-xref="dom-DataTransferItemList-item" href="#dom-datatransferitemlist-item">Determine the value of the indexed
   property</a> corresponding to the newly added item, and return that value (a newly created
   <code><a href="#datatransferitem">DataTransferItem</a></code> object).</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransferItemList-remove" id="dom-datatransferitemlist-remove"><code>remove()</code></dfn> method, when
  invoked with the argument <var data-anolis-xref="">i</var>, must run these steps:</p>

  <ol><li><p>If the <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object is not in the <i data-anolis-xref="concept-dnd-rw"><a href="#concept-dnd-rw">read/write mode</a></i>, throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and
   abort these steps.</li>

   <li><p>Remove the <var data-anolis-xref="">i</var>th item from the <a href="#drag-data-store">drag data store</a>.</li>

  </ol><p>The <dfn data-anolis-xref="dom-DataTransferItemList-clear" id="dom-datatransferitemlist-clear"><code>clear</code></dfn> method, if the
  <code><a href="#datatransferitemlist">DataTransferItemList</a></code> object is in the <i data-anolis-xref="concept-dnd-rw"><a href="#concept-dnd-rw">read/write mode</a></i>,
  must remove all the items from the <a href="#drag-data-store">drag data store</a>. Otherwise, it must do
  nothing.</p>

  </div>


  <h5 id="the-datatransferitem-interface"><span class="secno">5.7.3.2</span> <code><a href="#datatransferitem">DataTransferItem</a></code>インターフェース</h5>

  <p>各<code><a href="#datatransferitem">DataTransferItem</a></code>オブジェクトは<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトに関連付けられる。</p>

  <pre class="idl">interface <dfn id="datatransferitem">DataTransferItem</dfn> {
  readonly attribute DOMString <a data-anolis-xref="dom-DataTransferItem-kind" href="#dom-datatransferitem-kind">kind</a>;
  readonly attribute DOMString <a data-anolis-xref="dom-DataTransferItem-type" href="#dom-datatransferitem-type">type</a>;
  void <a data-anolis-xref="dom-DataTransferItem-getAsString" href="#dom-datatransferitem-getasstring">getAsString</a>(<a href="#functionstringcallback">FunctionStringCallback</a>? _callback);<!--
DND-v3:  <span>Blob</span> <span data-x="dom-DataTransferItem-getAsBlob">getAsBlob</span>();-->
  <a href="infrastructure.html#file">File</a>? <a data-anolis-xref="dom-DataTransferItem-getAsFile" href="#dom-datatransferitem-getasfile">getAsFile</a>();<!--
DND-v4:  void <span data-x="dom-DataTransferItem-getAsObject">getAsObject</span>(<span>FunctionObjectCallback</span> _callback);-->
};

callback <dfn id="functionstringcallback">FunctionStringCallback</dfn> = void (DOMString data);<!--

// DND-v4:
callback <dfn>FunctionObjectCallback</dfn> = void (any data);--></pre>

  <dl class="domintro"><dt><var data-anolis-xref="">item</var> . <code data-anolis-xref="dom-DataTransferItem-kind"><a href="#dom-datatransferitem-kind">kind</a></code></dt>
   <dd>

    <p>Returns <a href="#the-drag-data-item-kind">the drag data item kind</a>, one of: "string",
    
    <!-- DND-v3: "blob", -->  "file"<!-- DND-v4: , "object" --></p>

   </dd>

   <dt><var data-anolis-xref="">item</var> . <code data-anolis-xref="dom-DataTransferItem-type"><a href="#dom-datatransferitem-type">type</a></code></dt>
   <dd>

    <p><a href="#the-drag-data-item-type-string">ドラッグデータ項目型文字列</a>を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">item</var> . <code data-anolis-xref="dom-DataTransferItem-getAsString"><a href="#dom-datatransferitem-getasstring">getAsString</a></code>(<var data-anolis-xref="">callback</var>)</dt>
   <dd>

    <p><a href="#the-drag-data-item-kind">ドラッグデータ項目の種類</a>が<i>プレーンUnicode文字列</i>である場合、引数として文字列データをもつコールバックを呼び出す。</p>

   </dd><!-- DND-v3:
   <dt><var data-x="">file</var> = <var data-x="">item</var> . <code data-x="dom-DataTransferItem-getAsBlob">getAsBlob</code>()</dt>
   <dd>

    <p>Returns a <code>Blob</code> object, if <span>the drag data item kind</span> is <i>Blob</i> or <i>File</i>.</p>

   </dd>
-->



   <dt><var data-anolis-xref="">file</var> = <var data-anolis-xref="">item</var> . <code data-anolis-xref="dom-DataTransferItem-getAsFile"><a href="#dom-datatransferitem-getasfile">getAsFile</a></code>()</dt>
   <dd>

    <p><a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>が<i><a href="infrastructure.html#file">File</a></i>の場合、<code><a href="infrastructure.html#file">File</a></code>オブジェクトを返す。</p>

   </dd><!-- DND-v4:
   <dt><var data-x="">file</var> = <var data-x="">item</var> . <code data-x="dom-DataTransferItem-getAsObject">getAsObject</code>()</dt>
   <dd>

    <p>Invokes the callback with the cloned object data as the argument, if <span>the drag data item
    kind</span> is <i>Plain Unicode string</i> or <i>Object</i>.</p>

   </dd>
-->



  </dl><div class="impl">

  <p>While the <code><a href="#datatransferitem">DataTransferItem</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code> object is associated
  with a <a href="#drag-data-store">drag data store</a> and that <a href="#drag-data-store">drag data store</a>'s <a href="#drag-data-store-item-list">drag data store
  item list</a> still contains the item that the <code><a href="#datatransferitem">DataTransferItem</a></code> object represents,
  the <code><a href="#datatransferitem">DataTransferItem</a></code> object's <i>mode</i> is the same as the <a href="#drag-data-store-mode">drag data store
  mode</a>. When the <code><a href="#datatransferitem">DataTransferItem</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code> object is
  <em>not</em> associated with a <a href="#drag-data-store">drag data store</a>, or if the item that the
  <code><a href="#datatransferitem">DataTransferItem</a></code> object represents has been removed from the relevant <a href="#drag-data-store-item-list">drag data
  store item list</a>, the <code><a href="#datatransferitem">DataTransferItem</a></code> object's <i>mode</i> is the <i>disabled
  mode</i>. The <a href="#drag-data-store">drag data store</a> referenced in this section (which is used only when the
  <code><a href="#datatransferitem">DataTransferItem</a></code> object is not in the <i>disabled mode</i>) is the <a href="#drag-data-store">drag data
  store</a> with which the <code><a href="#datatransferitem">DataTransferItem</a></code> object's <code><a href="#datatransfer">DataTransfer</a></code>
  object is associated.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransferItem-kind" id="dom-datatransferitem-kind"><code>kind</code></dfn> attribute must return the
  empty string if the <code><a href="#datatransferitem">DataTransferItem</a></code> object is in the <i>disabled mode</i>; otherwise
  it must return the string given in the cell from the second column of the following table from the
  row whose cell in the first column contains <a href="#the-drag-data-item-kind">the drag data item kind</a> of the item
  represented by the <code><a href="#datatransferitem">DataTransferItem</a></code> object:</p>

  <table><thead><tr><th>  Kind  </th><th>  String
   
   <tbody></th></tr><tr><td> <i>プレーンUnicode文字列</i> </td><td>  "<code data-anolis-xref="">string</code>"

<!-- DND-v3:    <tr> <td> <i>Blob</i> <td> "<code data-x="">blob</code>"-->
    </td></tr><tr><td> <i><a href="infrastructure.html#file">File</a></i> </td><td>  "<code data-anolis-xref="">file</code>"

<!-- DND-v4:    <tr> <td> <i>Object</i> <td> "<code data-x="">object</code>"-->
  </td></tr></table><p>The <dfn data-anolis-xref="dom-DataTransferItem-type" id="dom-datatransferitem-type"><code>type</code></dfn> attribute must return the
  empty string if the <code><a href="#datatransferitem">DataTransferItem</a></code> object is in the <i>disabled mode</i>; otherwise
  it must return <a href="#the-drag-data-item-type-string">the drag data item type string</a> of the item represented by the
  <code><a href="#datatransferitem">DataTransferItem</a></code> object.</p>

  <p>The <dfn data-anolis-xref="dom-DataTransferItem-getAsString" id="dom-datatransferitem-getasstring"><code>getAsString(<var data-anolis-xref="">callback</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <var data-anolis-xref="">callback</var> is null, abort these steps.</li>

   <li><p>If the <code><a href="#datatransferitem">DataTransferItem</a></code> object is not in the <i data-anolis-xref="concept-dnd-rw"><a href="#concept-dnd-rw">read/write mode</a></i> or the <i data-anolis-xref="concept-dnd-ro"><a href="#concept-dnd-ro">read-only mode</a></i>,
   abort these steps. The callback is never invoked.</li>

   <li><p>If <a href="#the-drag-data-item-kind">the drag data item kind</a> is not <i>Plain Unicode string</i>, abort these
   steps. The callback is never invoked.</li>

   <li><p>Otherwise, <a href="webappapis.html#queue-a-task">queue a task</a> to invoke <var data-anolis-xref="">callback</var>, passing the
   actual data of the item represented by the <code><a href="#datatransferitem">DataTransferItem</a></code> object as the
   argument.</li>

  </ol><!--DND-v3:
  <p>The <dfn data-x="dom-DataTransferItem-getAsBlob"><code>getAsBlob()</code></dfn> method must run
  the following steps:</p>

  <ol>

   <li><p>If the <code>DataTransferItem</code> object is not in the <i
   data-x="concept-dnd-rw">read/write mode</i> or the <i data-x="concept-dnd-ro">read-only mode</i>,
   return null and abort these steps.</p></li>

   <li>

--><!--DND-v4:
    <p>If <span>the drag data item kind</span> is <i>Object</i>, return null.</p></li>
--><!--DND-v3:

    <p>If <span>the drag data item kind</span> is <i>File</i>, then return a new <code>File</code>
    object representing the actual data of the item represented by the <code>DataTransferItem</code>
    object.</p>

    <p>If <span>the drag data item kind</span> is <i>Unicode Data string</i>, then return a new
    <code>Blob</code> object representing the actual data of the item represented by the
    <code>DataTransferItem</code> object, with the <code data-x="dom-Blob-type">type</code> of the
    <code>Blob</code> being <span>the drag data item type string</span> and with the binary data of
    the <code>Blob</code> object being the Unicode string encoded as UTF-8. <a
    href="#refsENCODING">[ENCODING]</a></p>

    <p>Otherwise, <span>the drag data item kind</span> is <i>Blob</i>; return a new
    <code>Blob</code> object representing the actual data of the item represented by the
    <code>DataTransferItem</code> object.</p>

   </li>

  </ol>
--><p>The <dfn data-anolis-xref="dom-DataTransferItem-getAsFile" id="dom-datatransferitem-getasfile"><code>getAsFile()</code></dfn>
  method must run the following steps:</p>

  <ol><li><p>If the <code><a href="#datatransferitem">DataTransferItem</a></code> object is not in the <i data-anolis-xref="concept-dnd-rw"><a href="#concept-dnd-rw">read/write mode</a></i> or the <i data-anolis-xref="concept-dnd-ro"><a href="#concept-dnd-ro">read-only mode</a></i>,
   return null and abort these steps.</li>

   <li><p>If <a href="#the-drag-data-item-kind">the drag data item kind</a> is not <i><a href="infrastructure.html#file">File</a></i>, then return null and abort
   these steps.</li>

   <li><p>Return a new <code><a href="infrastructure.html#file">File</a></code> object representing the actual data of the item represented
   by the <code><a href="#datatransferitem">DataTransferItem</a></code> object.</p>

  </li></ol><!--DND-v4:
  <p>The <dfn data-x="dom-DataTransferItem-getAsObject"><code>getAsObject(<var
  data-x="">callback</var>)</code></dfn> method must run the following steps:</p>

  <ol>

   <li><p>If the <code>DataTransferItem</code> object is not in the <i
   data-x="concept-dnd-rw">read/write mode</i> or the <i data-x="concept-dnd-ro">read-only mode</i>,
   return null and abort these steps.</p></li>

   <li>

    <p>Let <var data-x="">data</var> be the actual data of the item represented by the
    <code>DataTransferItem</code> object.</p>

    <p>If <span>the drag data item kind</span> is <i>Unicode Data string</i>, then <var
    data-x="">data</var> is a <code data-x="">DOMString</code> containing the actual data.</p>

    <p>If <span>the drag data item kind</span> is <i>Blob</i>, then <var data-x="">data</var> is a
    <code>Blob</code> representing the actual data.</p>

    <p>If <span>the drag data item kind</span> is <i>File</i>, then <var data-x="">data</var> is a
    <code>File</code> representing the actual data.</p>

    <p>If <span>the drag data item kind</span> is <i>Object</i>, then <var data-x="">data</var> is
    the object that is the actual data.</p>

   </li>

   <li><span>Queue a task</span> to invoke <var data-x="">callback</var>, passing a <span>structured
   clone</span> of <var data-x="">data</var> as the argument.</p></li>

  </ol>
--></div>



  <h4 id="the-dragevent-interface"><span class="secno">5.7.4</span> <code><a href="#dragevent">DragEvent</a></code>インターフェース</h4>

  <p>ドラッグアンドドロップ処理モデルは、複数のイベントを含む。これらはすべて<code><a href="#dragevent">DragEvent</a></code>インターフェースを使用する。</p>

  <pre class="idl">[Constructor(DOMString type, optional <a href="#drageventinit">DragEventInit</a> eventInitDict)]
interface <dfn id="dragevent">DragEvent</dfn> : <a href="infrastructure.html#mouseevent">MouseEvent</a> {
  readonly attribute <a href="#datatransfer">DataTransfer</a>? <a data-anolis-xref="dom-DragEvent-dataTransfer" href="#dom-dragevent-datatransfer">dataTransfer</a>;
};

dictionary <dfn id="drageventinit">DragEventInit</dfn> : <a href="infrastructure.html#mouseeventinit">MouseEventInit</a> {
  <a href="#datatransfer">DataTransfer</a>? dataTransfer;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-DragEvent-dataTransfer"><a href="#dom-dragevent-datatransfer">dataTransfer</a></code></dt>

   <dd>

    <p>イベントの<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトを返す。</p>

   </dd>

  </dl><p class="note">他のイベントインターフェースとの整合性を保つため、<code><a href="#dragevent">DragEvent</a></code>インターフェースはコンストラクタを持つけれども、特に有用ではない。<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトは、ドラッグアンドドロップの間にブラウザによって調整される処理およびセキュリティーモデルを持つので、特に、スクリプトから有用な<code><a href="#datatransfer">DataTransfer</a></code>オブジェクトを作成する方法はない。</p>

  <div class="impl">

  <p>The <dfn data-anolis-xref="dom-DragEvent-dataTransfer" id="dom-dragevent-datatransfer"><code>dataTransfer</code></dfn> attribute of the <code><a href="#dragevent">DragEvent</a></code> interface must return the value it was initialised to. オブジェクトが作成される際、この属性はnullに初期化しなければならない。It represents the context information for the event.</p>

  </div>

  <div class="impl">

  <p>When a user agent is required to <dfn id="fire-a-dnd-event">fire a DND event</dfn> named <var data-anolis-xref="">e</var> at an
  element, using a particular <a href="#drag-data-store">drag data store</a>, and optionally with a specific <var data-anolis-xref="">related target</var>, the user agent must run the following steps:</p>

  <ol><li><p>If no specific <var data-anolis-xref="">related target</var> was provided, set <var data-anolis-xref="">related target</var> to null.</li>

   <li>

    <p>If <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>, set the
    <a href="#drag-data-store-mode">drag data store mode</a> to the <a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">read/write
    mode</a>.</p>

    <p>If <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code>, set the <a href="#drag-data-store-mode">drag
    data store mode</a> to the <a data-anolis-xref="concept-dnd-ro" href="#concept-dnd-ro">read-only mode</a>.</p>

   </li>

   <li><p>Let <var data-anolis-xref="">dataTransfer</var> be a newly created <code><a href="#datatransfer">DataTransfer</a></code> object
   associated with the given <a href="#drag-data-store">drag data store</a>.</li>

   <li><p id="effectAllowed-initialization">Set the <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code> attribute to the <a href="#drag-data-store">drag data
   store</a>'s <a href="#drag-data-store-allowed-effects-state">drag data store allowed effects state</a>.</li>

   <li>

    <p id="dropEffect-initialization">Set the <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> attribute to "<code data-anolis-xref="">none</code>" if <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>, <code data-anolis-xref="event-dnd-drag"><a href="#event-dnd-drag">drag</a></code>, <code data-anolis-xref="event-dnd-dragexit"><a href="#event-dnd-dragexit">dragexit</a></code>, or <code data-anolis-xref="event-dnd-dragleave"><a href="#event-dnd-dragleave">dragleave</a></code>; to the value corresponding to the <a href="#current-drag-operation">current
    drag operation</a> if <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code> or
    <code data-anolis-xref="event-dnd-dragend"><a href="#event-dnd-dragend">dragend</a></code>; and to a value based on the <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code> attribute's value and the
    drag-and-drop source, as given by the following table, otherwise (i.e. if <var data-anolis-xref="">e</var>
    is <code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code> or <code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code>):</p>

    <table><thead><tr><th><code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code></th>
       <th><code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code></th>
      <tbody></tr><tr><td>"<code data-anolis-xref="">none</code>"</td>
      <td>"<code data-anolis-xref="">none</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">copy</code>"</td>
      <td>"<code data-anolis-xref="">copy</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">copyLink</code>"</td>
      <td>"<code data-anolis-xref="">copy</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, "<code data-anolis-xref="">link</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">copyMove</code>"</td>
      <td>"<code data-anolis-xref="">copy</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, "<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">all</code>"</td>
      <td>"<code data-anolis-xref="">copy</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, either "<code data-anolis-xref="">link</code>" or "<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">link</code>"</td>
      <td>"<code data-anolis-xref="">link</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">linkMove</code>"</td>
      <td>"<code data-anolis-xref="">link</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, "<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">move</code>"</td>
      <td>"<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">uninitialized</code>" when what is being dragged is a selection from a text field</td>
      <td>"<code data-anolis-xref="">move</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, either "<code data-anolis-xref="">copy</code>" or "<code data-anolis-xref="">link</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">uninitialized</code>" when what is being dragged is a selection</td>
      <td>"<code data-anolis-xref="">copy</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, either "<code data-anolis-xref="">link</code>" or "<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>"<code data-anolis-xref="">uninitialized</code>" when what is being dragged is an <code><a href="text-level-semantics.html#the-a-element">a</a></code> element with an <code>href</code> attribute</td>
      <td>"<code data-anolis-xref="">link</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, either "<code data-anolis-xref="">copy</code>" or "<code data-anolis-xref="">move</code>"</td>
     </tr><tr><td>Any other case</td>
      <td>"<code data-anolis-xref="">copy</code>", or, <a data-anolis-xref="concept-platform-dropEffect-override" href="#concept-platform-dropeffect-override">if appropriate</a>, either "<code data-anolis-xref="">link</code>" or "<code data-anolis-xref="">move</code>"</td>
     </tr></table><p>Where the table above provides <dfn data-anolis-xref="concept-platform-dropEffect-override" id="concept-platform-dropeffect-override">possibly
    appropriate alternatives</dfn>, user agents may instead use the listed alternative values if
    platform conventions dictate that the user has requested those alternate effects.</p>

    <p class="example">For example, Windows platform conventions are such that dragging while
    holding the "alt" key indicates a preference for linking the data, rather than moving or copying
    it. Therefore, on a Windows system, if "<code data-anolis-xref="">link</code>" is an option according to
    the table above while the "alt" key is depressed, the user agent could select that instead of
    "<code data-anolis-xref="">copy</code>" or "<code data-anolis-xref="">move</code>".</p>

   </li>

   <li>

    <p>Create a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> <code><a href="#dragevent">DragEvent</a></code> object
    and initialise it to have the given name <var data-anolis-xref="">e</var>, to bubble, to be cancelable
    unless <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-dragexit"><a href="#event-dnd-dragexit">dragexit</a></code>, <code data-anolis-xref="event-dnd-dragleave"><a href="#event-dnd-dragleave">dragleave</a></code>, or <code data-anolis-xref="event-dnd-dragend"><a href="#event-dnd-dragend">dragend</a></code>, and to have the <code data-anolis-xref="dom-UIEvent-detail"><a href="infrastructure.html#dom-uievent-detail">detail</a></code> attribute initialised to zero, the mouse and key
    attributes initialised according to the state of the input devices as they would be for user
    interaction events, the <code data-anolis-xref="dom-MouseEvent-relatedTarget">relatedTarget</code>
    attribute initialised to <var data-anolis-xref="">related target</var>, and the <code data-anolis-xref="dom-DragEvent-dataTransfer"><a href="#dom-dragevent-datatransfer">dataTransfer</a></code> attribute initialised to <var data-anolis-xref="">dataTransfer</var>, the <code><a href="#datatransfer">DataTransfer</a></code> object created above.</p><!-- interaction event spec point -->

    

    <p>If there is no relevant pointing device, the object must have its <code data-anolis-xref="">screenX</code>, <code data-anolis-xref="">screenY</code>, <code data-anolis-xref="">clientX</code>, <code data-anolis-xref="">clientY</code>, and <code data-anolis-xref="">button</code> attributes set to 0.</p>

   </li>

   <li><p><a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">Dispatch</a> the newly created
   <code><a href="#dragevent">DragEvent</a></code> object at the specified target element.</li>

   <li><p>Set the <a href="#drag-data-store-allowed-effects-state">drag data store allowed effects state</a> to the current value of <var data-anolis-xref="">dataTransfer</var>'s <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code>
   attribute. (It can only have changed value if <var data-anolis-xref="">e</var> is <code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>.)</li>

   <li><p>Set the <a href="#drag-data-store-mode">drag data store mode</a> back to the <a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">protected mode</a> if it was changed in the first step.</li>

   <li><p>Break the association between <var data-anolis-xref="">dataTransfer</var> and the <a href="#drag-data-store">drag data
   store</a>.</li>

  </ol></div>


  <div class="impl">

  <h4 id="drag-and-drop-processing-model"><span class="secno">5.7.5 </span>Drag-and-drop processing model</h4>

  <p>When the user attempts to begin a drag operation, the user agent must run the following steps.
  User agents must act as if these steps were run even if the drag actually started in another
  document or application and the user agent was not aware that the drag was occurring until it
  intersected with a document under the user agent's purview.</p>

  <ol><li>

    <p>Determine what is being dragged, as follows:</p>

    <p>If the drag operation was invoked on a selection, then it is the selection that is being
    dragged.</p>

    <p>Otherwise, if the drag operation was invoked on a <code><a href="dom.html#document">Document</a></code>, it is the first
    element, going up the ancestor chain, starting at the node that the user tried to drag, that has
    the IDL attribute <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> set to true. If there is no such
    element, then nothing is being dragged; abort these steps, the drag-and-drop operation is never
    started.</p>

    <p>Otherwise, the drag operation was invoked outside the user agent's purview. What is being
    dragged is defined by the document or application where the drag was started.</p>

    <p class="note"><code><a href="embedded-content.html#the-img-element">img</a></code> elements and <code><a href="text-level-semantics.html#the-a-element">a</a></code> elements with an <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> attribute have their <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> attribute set to true by default.</p>

   </li>

   <li><p><a href="#create-a-drag-data-store">Create a drag data store</a>. All the DND events fired subsequently by the steps
   in this section must use this <a href="#drag-data-store">drag data store</a>.</li>

   <li>

    <p>Establish which DOM node is the <dfn id="source-node">source node</dfn>, as follows:</p>

    <p>If it is a selection that is being dragged, then the <a href="#source-node">source node</a> is the
    <code><a href="infrastructure.html#text-0">Text</a></code> node that the user started the drag on (typically the <code><a href="infrastructure.html#text-0">Text</a></code> node
    that the user originally clicked). If the user did not specify a particular node, for example if
    the user just told the user agent to begin a drag of "the selection", then the <a href="#source-node">source
    node</a> is the first <code><a href="infrastructure.html#text-0">Text</a></code> node containing a part of the selection.</p>

    <p>Otherwise, if it is an element that is being dragged, then the <a href="#source-node">source node</a> is
    the element that is being dragged.</p>

    <p>Otherwise, the <a href="#source-node">source node</a> is part of another document or application. When this
    specification requires that an event be dispatched at the <a href="#source-node">source node</a> in this case,
    the user agent must instead follow the platform-specific conventions relevant to that
    situation.</p>

    <p class="note">Multiple events are fired on the <a href="#source-node">source node</a> during the course of
    the drag-and-drop operation.</p>

   </li>

   <li>

    <p>Determine the <dfn id="list-of-dragged-nodes">list of dragged nodes</dfn>, as follows:</p>

    <p>If it is a selection that is being dragged, then the <a href="#list-of-dragged-nodes">list of dragged nodes</a>
    contains, in <a href="infrastructure.html#tree-order">tree order</a>, every node that is partially or completely included in the
    selection (including all their ancestors).</p>

    <p>Otherwise, the <a href="#list-of-dragged-nodes">list of dragged nodes</a> contains only the <a href="#source-node">source node</a>,
    if any.</p>

   </li>

   <li>

    <p>If it is a selection that is being dragged, then add an item to the <a href="#drag-data-store-item-list">drag data store
    item list</a>, with its properties set as follows:</p>

    <dl><dt><a href="#the-drag-data-item-type-string">ドラッグデータ項目型文字列</a>
     <dd>"<code>text/plain</code>"</dd>

     <dt><a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>
     <dd><i>プレーンUnicode文字列</i></dd>

     <dt>実際のデータ</dt>
     <dd>The text of the selection</dd>

    </dl><p>Otherwise, if any files are being dragged, then add one item per file to the <a href="#drag-data-store-item-list">drag data
    store item list</a>, with their properties set as follows:</p>

    <dl><dt><a href="#the-drag-data-item-type-string">ドラッグデータ項目型文字列</a>
     <dd>The MIME type of the file, if known, or "<code>application/octet-stream</code>" otherwise.</dd>

     <dt><a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>
     <dd><i><a href="infrastructure.html#file">File</a></i></dd>

     <dt>実際のデータ</dt>
     <dd>The file's contents and name.</dd>

    </dl><p class="note">Dragging files can currently only happen from outside a <a href="browsers.html#browsing-context">browsing
    context</a>, for example from a file system manager application.</p>

    <p>If the drag initiated outside of the application, the user agent must add items to the
    <a href="#drag-data-store-item-list">drag data store item list</a> as appropriate for the data being dragged, honoring
    platform conventions where appropriate; however, if the platform conventions do not use <a data-anolis-xref="MIME type" href="infrastructure.html#mime-type">MIME types</a> to label dragged data, the user agent must make a
    best-effort attempt to map the types to MIME types, and, in any case, all the <a data-anolis-xref="the
    drag data item type string" href="#the-drag-data-item-type-string">drag data item type strings</a> must be <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII
    lowercase</a>.</p>

    <p>User agents may also add one or more items representing the selection or dragged element(s)
    in other forms, e.g. as HTML.</p>

   </li><!-- DND-v2: text/html as an export format -->

   

   <li>

    <p>If the <a href="#list-of-dragged-nodes">list of dragged nodes</a> is not empty, then <span data-anolis-xref="extracting
    JSON">extract the microdata from those nodes into a JSON form</span>, and add one item to the
    <a href="#drag-data-store-item-list">drag data store item list</a>, with its properties set as follows:</p>

    <dl><dt><a href="#the-drag-data-item-type-string">ドラッグデータ項目型文字列</a>
     <dd><code>application/microdata+json</code></dd>

     <dt><a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>
     <dd><i>プレーンUnicode文字列</i></dd>

     <dt>実際のデータ</dt>
     <dd>The resulting JSON string.</dd>

    </dl></li>

   <li>

    <p>Run the following substeps:</p>

    <ol><li><p>Let <var data-anolis-xref="">urls</var> be an empty list of <a data-anolis-xref="absolute URL" href="infrastructure.html#absolute-url">absolute
     URLs</a>.</li>

     <li>

      <p>For each <var data-anolis-xref="">node</var> in the <a href="#list-of-dragged-nodes">list of dragged nodes</a>:</p>

      <dl><dt>If the node is an <code><a href="text-level-semantics.html#the-a-element">a</a></code> element with an <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> attribute</dt>

       <dd>Add to <var data-anolis-xref="">urls</var> the result of <a data-anolis-xref="resolve a
       url" href="infrastructure.html#resolve-a-url">resolving</a> the element's <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> content
       attribute relative to the element.</dd>

       <dt>If the node is an <code><a href="embedded-content.html#the-img-element">img</a></code> element with a <code data-anolis-xref="attr-img-src"><a href="embedded-content.html#attr-img-src">src</a></code>
       attribute</dt>

       <dd>Add to <var data-anolis-xref="">urls</var> the result of <a data-anolis-xref="resolve a
       url" href="infrastructure.html#resolve-a-url">resolving</a> the element's <code data-anolis-xref="attr-img-src"><a href="embedded-content.html#attr-img-src">src</a></code> content attribute
       relative to the element.</dd><!-- DND-v2: more -->

       

      </dl></li>

     <li><p>If <var data-anolis-xref="">urls</var> is still empty, abort these substeps.</li>

     <li><p>Let <var data-anolis-xref="">url string</var> be the result of concatenating the strings in <var data-anolis-xref="">urls</var>, in the order they were added, separated by a U+000D CARRIAGE RETURN U+000A
     LINE FEED character pair (CRLF).</li>

     <li><p>Add one item to the <a href="#drag-data-store-item-list">drag data store item list</a>, with its properties set as
     follows:</p>

      <dl><dt><a href="#the-drag-data-item-type-string">ドラッグデータ項目型文字列</a>
       <dd><code>text/uri-list</code></dd>

       <dt><a href="#the-drag-data-item-kind">ドラッグデータアイテムの種類</a>
       <dd><i>プレーンUnicode文字列</i></dd>

       <dt>実際のデータ</dt>
       <dd><var data-anolis-xref="">url string</var></dd>

      </dl></li>

    </ol></li>

   <li>

    <p>Update the <a href="#drag-data-store-default-feedback">drag data store default feedback</a> as appropriate for the user agent
    (if the user is dragging the selection, then the selection would likely be the basis for this
    feedback; if the user is dragging an element, then that element's rendering would be used; if
    the drag began outside the user agent, then the platform conventions for determining the drag
    feedback should be used).</p>

   </li>

   <li>

    <p><a href="#fire-a-dnd-event">Fire a DND event</a> named <code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code> at the
    <a href="#source-node">source node</a>.</p>

    <p>If the event is canceled, then the drag-and-drop operation should not occur; abort these
    steps.</p><!-- only a should because the UA can always allow the user to drag without the page
    knowing --> 

    <p class="note">Since events with no event listeners registered are, almost by definition, never
    canceled, drag-and-drop is always available to the user if the author does not specifically
    prevent it.</p>

   </li>

   <li>

    <p><a href="#initiate-the-drag-and-drop-operation">Initiate the drag-and-drop operation</a> in a manner consistent with platform
    conventions, and as described below.</p>

    <p id="base-dnd-feedback">The drag-and-drop feedback must be generated from the first of the
    following sources that is available:</p>

    <ol><li>The <a href="#drag-data-store-bitmap">drag data store bitmap</a>, if any. In this case, the <a href="#drag-data-store-hot-spot-coordinate">drag data store
     hot spot coordinate</a> should be used as hints for where to put the cursor relative to the
     resulting image. The values are expressed as distances in CSS pixels from the left side and
     from the top side of the image respectively. <a href="references.html#refsCSS">[CSS]</a></li>

     <li>The <a href="#drag-data-store-default-feedback">drag data store default feedback</a>.</li>

    </ol></li>

  </ol><p>From the moment that the user agent is to <dfn id="initiate-the-drag-and-drop-operation">initiate the drag-and-drop operation</dfn>,
  until the end of the drag-and-drop operation, device input events (e.g. mouse and keyboard events)
  must be suppressed.</p>

  <p>During the drag operation, the element directly indicated by the user as the drop target is
  called the <dfn id="immediate-user-selection">immediate user selection</dfn>. (Only elements can be selected by the user; other
  nodes must not be made available as drop targets.) However, the <a href="#immediate-user-selection">immediate user
  selection</a> is not necessarily the <dfn id="current-target-element">current target element</dfn>, which is the element
  currently selected for the drop part of the drag-and-drop operation.</p>

  <p>The <a href="#immediate-user-selection">immediate user selection</a> changes as the user selects different elements
  (either by pointing at them with a pointing device, or by selecting them in some other way). The
  <a href="#current-target-element">current target element</a> changes when the <a href="#immediate-user-selection">immediate user selection</a>
  changes, based on the results of event listeners in the document, as described below.</p>

  <p>Both the <a href="#current-target-element">current target element</a> and the <a href="#immediate-user-selection">immediate user selection</a> can
  be null, which means no target element is selected. They can also both be elements in other
  (DOM-based) documents, or other (non-Web) programs altogether. (For example, a user could drag
  text to a word-processor.) The <a href="#current-target-element">current target element</a> is initially null.</p>

  <p>In addition, there is also a <dfn id="current-drag-operation">current drag operation</dfn>, which can take on the values
  "<code data-anolis-xref="">none</code>", "<code data-anolis-xref="">copy</code>", "<code data-anolis-xref="">link</code>", and
  "<code data-anolis-xref="">move</code>". Initially, it has the value "<code data-anolis-xref="">none</code>". It is
  updated by the user agent as described in the steps below.</p>

  <p>User agents must, as soon as the drag operation is <a data-anolis-xref="initiate the drag-and-drop
  operation" href="#initiate-the-drag-and-drop-operation">initiated</a> and every 350ms (±200ms) thereafter for as long as the drag
  operation is ongoing, <a href="webappapis.html#queue-a-task">queue a task</a> to perform the following steps in sequence:</p>

  <ol><li>

    <p>If the user agent is still performing the previous iteration of the sequence (if any) when
    the next iteration becomes due, abort these steps for this iteration (effectively "skipping
    missed frames" of the drag-and-drop operation).</p>

   </li>

   <li>

    <p><a href="#fire-a-dnd-event">Fire a DND event</a> named <code data-anolis-xref="event-dnd-drag"><a href="#event-dnd-drag">drag</a></code> at the
    <a href="#source-node">source node</a>. If this event is canceled, the user agent must set the <a href="#current-drag-operation">current
    drag operation</a> to "<code data-anolis-xref="">none</code>" (no drag operation).</p>

   </li>

   <li>

    <p>If the <code data-anolis-xref="event-dnd-drag"><a href="#event-dnd-drag">drag</a></code> event was not canceled and the user has not ended
    the drag-and-drop operation, check the state of the drag-and-drop operation, as follows:</p>

    <ol><li>

      <p>If the user is indicating a different <a href="#immediate-user-selection">immediate user selection</a> than during the
      last iteration (or if this is the first iteration), and if this <a href="#immediate-user-selection">immediate user
      selection</a> is not the same as the <a href="#current-target-element">current target element</a>, then <a href="#fire-a-dnd-event">fire a
      DND event</a> named <code data-anolis-xref="event-dnd-dragexit"><a href="#event-dnd-dragexit">dragexit</a></code> at the <a href="#current-target-element">current
      target element</a>, and then update the <a href="#current-target-element">current target element</a> as follows:</p>

      <dl class="switch"><dt>If the new <a href="#immediate-user-selection">immediate user selection</a> is null</dt>

       <dd><p>Set the <a href="#current-target-element">current target element</a> to null also.</dd>

       <dt>If the new <a href="#immediate-user-selection">immediate user selection</a> is in a non-DOM document or
       application</dt>

       <dd><p>Set the <a href="#current-target-element">current target element</a> to the <a href="#immediate-user-selection">immediate user
       selection</a>.</dd>

       <dt>そうでなければ</dt>

       <dd>

        <p><a href="#fire-a-dnd-event">Fire a DND event</a> named <code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code> at the
        <a href="#immediate-user-selection">immediate user selection</a>.</p>

        <p>If the event is canceled, then set the <a href="#current-target-element">current target element</a> to the
        <a href="#immediate-user-selection">immediate user selection</a>.</p>

        <p>Otherwise, run the appropriate step from the following list:</p>

        <dl class="switch"><dt>If the <a href="#immediate-user-selection">immediate user selection</a> is a text field (e.g.
         <code><a href="forms.html#the-textarea-element">textarea</a></code>, or an <code><a href="forms.html#the-input-element">input</a></code> element whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute is in the <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a> state) or an <a href="#editing-host">editing host</a> or
         <a href="#editable">editable</a> element, and the <a href="#drag-data-store-item-list">drag data store item list</a> has an item
         with <a href="#the-drag-data-item-type-string">the drag data item type string</a> "<code>text/plain</code>" and <a href="#the-drag-data-item-kind">the
         drag data item kind</a> <i>Plain Unicode string</i></dt>

         <dd><p>Set the <a href="#current-target-element">current target element</a> to the <a href="#immediate-user-selection">immediate user
         selection</a> anyway.</dd>


         <dt>If the <a href="#immediate-user-selection">immediate user selection</a> is an element with a <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute that <a data-anolis-xref="concept-dropzone-match" href="#concept-dropzone-match">matches</a> the <a href="#drag-data-store">drag data store</a></dt>

         <dd><p>Set the <a href="#current-target-element">current target element</a> to the <a href="#immediate-user-selection">immediate user
         selection</a> anyway.</dd>


         <dt>If the <a href="#immediate-user-selection">immediate user selection</a> is an element that itself has an ancestor
         element with a <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute that <a data-anolis-xref="concept-dropzone-match" href="#concept-dropzone-match">matches</a> the <a href="#drag-data-store">drag data store</a></dt>

         <dd>

          <p>Let <var data-anolis-xref="">new target</var> be the nearest (deepest) such ancestor element.</p>

          <p>If the <a href="#immediate-user-selection">immediate user selection</a> is <var data-anolis-xref="">new target</var>, then
          leave the <a href="#current-target-element">current target element</a> unchanged.</p>

          <p>Otherwise, <a href="#fire-a-dnd-event">fire a DND event</a> named <code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code> at <var data-anolis-xref="">new target</var>, with the
          current <a href="#current-target-element">current target element</a> as the specific <var data-anolis-xref="">related
          target</var>. Then, set the <a href="#current-target-element">current target element</a> to <var data-anolis-xref="">new
          target</var>, regardless of whether that event was canceled or not.</p>

         </dd>


         <dt>If the <a href="#immediate-user-selection">immediate user selection</a> is <a href="dom.html#the-body-element-0">the body element</a></dt>

         <dd><p>Leave the <a href="#current-target-element">current target element</a> unchanged.</dd>


         <dt>そうでなければ</dt>

         <dd>

          <p><a href="#fire-a-dnd-event">Fire a DND event</a> named <code data-anolis-xref="event-dnd-dragenter"><a href="#event-dnd-dragenter">dragenter</a></code>
          at <a href="dom.html#the-body-element-0">the body element</a>, if there is one, or at the <code><a href="dom.html#document">Document</a></code> object,
          if not. Then, set the <a href="#current-target-element">current target element</a> to <a href="dom.html#the-body-element-0">the body
          element</a>, regardless of whether that event was canceled or not.</p>

         </dd>

        </dl></dd>

      </dl></li>

     <li>

      <p>If the previous step caused the <a href="#current-target-element">current target element</a> to change, and if the
      previous target element was not null or a part of a non-DOM document, then <a href="#fire-a-dnd-event">fire a DND
      event</a> named <code data-anolis-xref="event-dnd-dragleave"><a href="#event-dnd-dragleave">dragleave</a></code> at the previous target
      element, with the new <a href="#current-target-element">current target element</a> as the specific <var data-anolis-xref="">related target</var>.</p>

     </li>

     <li>

      <p>If the <a href="#current-target-element">current target element</a> is a DOM element, then <a href="#fire-a-dnd-event">fire a DND
      event</a> named <code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code> at this <a href="#current-target-element">current target
      element</a>.</p>

      <p>If the <code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code> event is not canceled, run the
      appropriate step from the following list:</p>

      <dl class="switch"><dt>If the <a href="#current-target-element">current target element</a> is a text field (e.g. <code><a href="forms.html#the-textarea-element">textarea</a></code>,
       or an <code><a href="forms.html#the-input-element">input</a></code> element whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute is
       in the <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a> state) or an <a href="#editing-host">editing host</a>
       or <a href="#editable">editable</a> element, and the <a href="#drag-data-store-item-list">drag data store item list</a> has an item
       with <a href="#the-drag-data-item-type-string">the drag data item type string</a> "<code>text/plain</code>" and <a href="#the-drag-data-item-kind">the drag
       data item kind</a> <i>Plain Unicode string</i></dt>

       <dd><p>Set the <a href="#current-drag-operation">current drag operation</a> to either "<code data-anolis-xref="">copy</code>" or
       "<code data-anolis-xref="">move</code>", as appropriate given the platform conventions.</dd>


       <dt>If the <a href="#current-target-element">current target element</a> is an element with a <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute that <a data-anolis-xref="concept-dropzone-match" href="#concept-dropzone-match">matches</a> the <a href="#drag-data-store">drag data store</a> and <a data-anolis-xref="concept-dropzone-operation" href="#concept-dropzone-operation">specifies an operation</a></dt>

       <dd><p>Set the <a href="#current-drag-operation">current drag operation</a> to the operation <a data-anolis-xref="concept-dropzone-operation" href="#concept-dropzone-operation">specified</a> by the <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute of the <a href="#current-target-element">current target
       element</a>.</p>


       <dt>If the <a href="#current-target-element">current target element</a> is an element with a <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute that <a data-anolis-xref="concept-dropzone-match" href="#concept-dropzone-match">matches</a> the <a href="#drag-data-store">drag data store</a> and does not
       <a data-anolis-xref="concept-dropzone-operation" href="#concept-dropzone-operation">specify an operation</a></dt>

       <dd><p>Set the <a href="#current-drag-operation">current drag operation</a> to "<code data-anolis-xref="">copy</code>".</p>


       <dt>そうでなければ</dt>

       <dd><p>Reset the <a href="#current-drag-operation">current drag operation</a> to "<code data-anolis-xref="">none</code>".</dd>

      </dl><p>Otherwise (if the <code data-anolis-xref="event-dnd-dragover"><a href="#event-dnd-dragover">dragover</a></code> event <em>is</em> canceled),
      set the <a href="#current-drag-operation">current drag operation</a> based on the values of the <code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code> and <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> attributes of the <code><a href="#dragevent">DragEvent</a></code>
      object's <code data-anolis-xref="dom-DragEvent-dataTransfer"><a href="#dom-dragevent-datatransfer">dataTransfer</a></code> object as they stood
      after the event <a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">dispatch</a> finished, as per the
      following table:</p>

      <table><thead><tr><th><code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code></th>
         <th><code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code></th>
         <th>Drag operation</th>
        <tbody></tr><tr><td>"<code data-anolis-xref="">uninitialized</code>", "<code data-anolis-xref="">copy</code>", "<code data-anolis-xref="">copyLink</code>", "<code data-anolis-xref="">copyMove</code>", or "<code data-anolis-xref="">all</code>"</td>
        <td>"<code data-anolis-xref="">copy</code>"</td>
        <td>"<code data-anolis-xref="">copy</code>"</td>
       </tr><tr><td>"<code data-anolis-xref="">uninitialized</code>", "<code data-anolis-xref="">link</code>", "<code data-anolis-xref="">copyLink</code>", "<code data-anolis-xref="">linkMove</code>", or "<code data-anolis-xref="">all</code>"</td>
        <td>"<code data-anolis-xref="">link</code>"</td>
        <td>"<code data-anolis-xref="">link</code>"</td>
       </tr><tr><td>"<code data-anolis-xref="">uninitialized</code>", "<code data-anolis-xref="">move</code>", "<code data-anolis-xref="">copyMove</code>", "<code data-anolis-xref="">linkMove</code>", or "<code data-anolis-xref="">all</code>"</td>
        <td>"<code data-anolis-xref="">move</code>"</td>
        <td>"<code data-anolis-xref="">move</code>"</td>
       </tr><tr><td colspan="2">Any other case</td>
        <td>"<code data-anolis-xref="">none</code>"</td>
       </tr></table></li>

     <li>

      <p>Otherwise, if the <a href="#current-target-element">current target element</a> is not a DOM element, use
      platform-specific mechanisms to determine what drag operation is being performed (none, copy,
      link, or move), and set the <i><a href="#current-drag-operation">current drag operation</a></i> accordingly.</p>

     </li>

     <li>

      <p>Update the drag feedback (e.g. the mouse cursor) to match the <a href="#current-drag-operation">current drag
      operation</a>, as follows:</p>

      <table><thead><tr><th>Drag operation</th>
         <th>Feedback</th>
        <tbody></tr><tr><td>"<code data-anolis-xref="">copy</code>"</td>
        <td>Data will be copied if dropped here.</td>
       </tr><tr><td>"<code data-anolis-xref="">link</code>"</td>
        <td>Data will be linked if dropped here.</td>
       </tr><tr><td>"<code data-anolis-xref="">move</code>"</td>
        <td>Data will be moved if dropped here.</td>
       </tr><tr><td>"<code data-anolis-xref="">none</code>"</td>
        <td>No operation allowed, dropping here will cancel the drag-and-drop operation.</td>
       </tr></table></li>

    </ol></li>

   <li>

    <p>Otherwise, if the user ended the drag-and-drop operation (e.g. by releasing the mouse button
    in a mouse-driven drag-and-drop interface), or if the <code data-anolis-xref="event-dnd-drag"><a href="#event-dnd-drag">drag</a></code> event
    was canceled, then this will be the last iteration. Run the following steps, then stop the
    drag-and-drop operation:</p>

    <ol><li>

      <p>If the <a href="#current-drag-operation">current drag operation</a> is "<code data-anolis-xref="">none</code>" (no drag
      operation), or, if the user ended the drag-and-drop operation by canceling it (e.g. by hitting
      the <kbd>Escape</kbd> key), or if the <a href="#current-target-element">current target element</a> is null, then the
      drag operation failed. Run these substeps:</p>

      <ol><li><p>Let <var data-anolis-xref="">dropped</var> be false.</li>

       <li><p>If the <a href="#current-target-element">current target element</a> is a DOM element, <a href="#fire-a-dnd-event">fire a DND
       event</a> named <code data-anolis-xref="event-dnd-dragleave"><a href="#event-dnd-dragleave">dragleave</a></code> at it; otherwise, if it is
       not null, use platform-specific conventions for drag cancellation.</li>

       <li><p>Set the <a href="#current-drag-operation">current drag operation</a> to "<code data-anolis-xref="">none</code>".</li>

      </ol><p>Otherwise, the drag operation might be a success; run these substeps:</p>

      <ol><li><p>Let <var data-anolis-xref="">dropped</var> be true.</li>

       <li><p>If the <a href="#current-target-element">current target element</a> is a DOM element, <a href="#fire-a-dnd-event">fire a DND
       event</a> named <code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code> at it; otherwise, use
       platform-specific conventions for indicating a drop.</li>

       <li>

        <p>If the event is canceled, set the <a href="#current-drag-operation">current drag operation</a> to the value of the
        <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> attribute of the
        <code><a href="#dragevent">DragEvent</a></code> object's <code data-anolis-xref="dom-DragEvent-dataTransfer"><a href="#dom-dragevent-datatransfer">dataTransfer</a></code>
        object as it stood after the event <a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">dispatch</a>
        finished.</p>

        <p>Otherwise, the event is not canceled; perform the event's default action, which depends
        on the exact target as follows:</p>

        <dl class="switch"><dt>If the <a href="#current-target-element">current target element</a> is a text field (e.g. <code><a href="forms.html#the-textarea-element">textarea</a></code>,
         or an <code><a href="forms.html#the-input-element">input</a></code> element whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute
         is in the <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a> state) or an <a href="#editing-host">editing
         host</a> or <a href="#editable">editable</a> element, and the <a href="#drag-data-store-item-list">drag data store item
         list</a> has an item with <a href="#the-drag-data-item-type-string">the drag data item type string</a>
         "<code>text/plain</code>" and <a href="#the-drag-data-item-kind">the drag data item kind</a> <i>Plain Unicode
         string</i></dt>

         <dd><p>Insert the actual data of the first item in the <a href="#drag-data-store-item-list">drag data store item
         list</a> to have <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">a drag data item type
         string</a> of "<code>text/plain</code>" and <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">a drag
         data item kind</a> that is <i>Plain Unicode string</i> into the text field or
         <a href="#editing-host">editing host</a> or <a href="#editable">editable</a> element in a manner consistent with
         platform-specific conventions (e.g. inserting it at the current mouse cursor position, or
         inserting it at the end of the field).</dd>

         <dt>そうでなければ</dt>

         <dd><p>Reset the <a href="#current-drag-operation">current drag operation</a> to "<code data-anolis-xref="">none</code>".</dd>

        </dl></li>

      </ol></li>

     <li>

      <p><a href="#fire-a-dnd-event">Fire a DND event</a> named <code data-anolis-xref="event-dnd-dragend"><a href="#event-dnd-dragend">dragend</a></code> at the
      <a href="#source-node">source node</a>.</p>

     </li>

     <li>

      <p>Run the appropriate steps from the following list as the default action of the <code data-anolis-xref="event-dnd-dragend"><a href="#event-dnd-dragend">dragend</a></code> event:</p>

      <dl class="switch"><dt>If <var data-anolis-xref="">dropped</var> is true, the <a href="#current-target-element">current target element</a> is a
       <i>text field</i> (see below), the <a href="#current-drag-operation">current drag operation</a> is "<code data-anolis-xref="">move</code>", and the source of the drag-and-drop operation is a selection in the
       DOM that is entirely contained within an <a href="#editing-host">editing host</a></dt>

       <dd><p><a href="#delete-the-selection">Delete the selection</a>.</dd>

       <dt>If <var data-anolis-xref="">dropped</var> is true, the <a href="#current-target-element">current target element</a> is a
       <i>text field</i> (see below), the <a href="#current-drag-operation">current drag operation</a> is "<code data-anolis-xref="">move</code>", and the source of the drag-and-drop operation is a selection in a text
       field</dt>

       <dd><p>The user agent should delete the dragged selection from the relevant text
       field.</dd>

       <dt>If <var data-anolis-xref="">dropped</var> is false or if the <a href="#current-drag-operation">current drag operation</a> is
       "<code data-anolis-xref="">none</code>"</dt>

       <dd><p>The drag was canceled. If the platform conventions dictate that this be represented to
       the user (e.g. by animating the dragged selection going back to the source of the
       drag-and-drop operation), then do so.</dd>

       <dt>そうでなければ</dt>

       <dd><p>The event has no default action.</dd>

      </dl><p>For the purposes of this step, a <i>text field</i> is a <code><a href="forms.html#the-textarea-element">textarea</a></code> element or an
      <code><a href="forms.html#the-input-element">input</a></code> element whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute is in one
      of the
      <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a>,
      <a data-anolis-xref="attr-input-type-search" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Search</a>,
      <a data-anolis-xref="attr-input-type-tel" href="forms.html#telephone-state-(type=tel)">Tel</a>,
      <a data-anolis-xref="attr-input-type-url" href="forms.html#url-state-(type=url)">URL</a>,
      <a data-anolis-xref="attr-input-type-email" href="forms.html#e-mail-state-(type=email)">E-mail</a>,
      <a data-anolis-xref="attr-input-type-password" href="forms.html#password-state-(type=password)">Password</a>, or
      <a data-anolis-xref="attr-input-type-number" href="forms.html#number-state-(type=number)">Number</a>
      states.</p>


     </li>

    </ol></li>

  </ol><p class="note">User agents are encouraged to consider how to react to drags near the edge of
  scrollable regions. For example, if a user drags a link to the bottom of the viewport on a long
  page, it might make sense to scroll the page so that the user can drop the link lower on the
  page.</p>

  <p class="note">This model is independent of which <code><a href="dom.html#document">Document</a></code> object the nodes involved
  are from; the events are fired as described above and the rest of the processing model runs as
  described above, irrespective of how many documents are involved in the operation.</p>

  </div>


  <h4 id="dndevents"><span class="secno">5.7.6</span> イベントの概要</h4>

  <p><i>この節は非規範的である。</i></p>

  <p>次のイベントは、ドラッグアンドドロップモデルに関与する。</p>

  <table><thead><tr><th> イベント名 </th>
     <th> ターゲット </th><!-- <th> Bubbles? </th> -->
     
     <th> 取消可能か？ </th>
     <th> <a href="#drag-data-store-mode">ドラッグデータストアモード</a> </th><!-- <th> <code data-x="dom-DataTransfer-effectAllowed">effectAllowed</code> </th> -->
     
     <th> <code data-anolis-xref="dom-DataTransfer-dropEffect"><a href="#dom-datatransfer-dropeffect">dropEffect</a></code> </th>
     <th> デフォルトの動作 </th>
    <tbody></tr><tr><td><dfn data-anolis-xref="event-dnd-dragstart" id="event-dnd-dragstart"><code>dragstart</code></dfn></td>
     <td><a href="#source-node">ソースノード</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>✓取消可能</td>
     <td><a data-anolis-xref="concept-dnd-rw" href="#concept-dnd-rw">読み書きモード</a>
     <!-- <td>"<code data-x="">uninitialized</code>"</td> -->
     </td><td>"<code data-anolis-xref="">none</code>"</td>
     <td>ドラッグアンドドロップ操作を開始する</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-drag" id="event-dnd-drag"><code>drag</code></dfn></td>
     <td><a href="#source-node">ソースノード</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>✓取消可能</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td>"<code data-anolis-xref="">none</code>"</td>
     <td>ドラッグアンドドロップ操作を続行する</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-dragenter" id="event-dnd-dragenter"><code>dragenter</code></dfn></td>
     <td><a href="#immediate-user-selection">イミディエイトユーザーセレクション</a>または<a href="dom.html#the-body-element-0">body要素</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>✓取消可能</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td><a href="#dropEffect-initialization"><code>effectAllowed</code>値をベースにする</a></td>
     <td>潜在的な<a data-anolis-xref="current target element" href="#current-target-element">ターゲット要素</a>として<a href="#immediate-user-selection">即時のユーザーの選択</a>を拒絶する</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-dragexit" id="event-dnd-dragexit"><code>dragexit</code></dfn></td>
     <td><a data-anolis-xref="current target element" href="#current-target-element">前のターゲット要素</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>—</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td>"<code data-anolis-xref="">none</code>"</td>
     <td>なし</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-dragleave" id="event-dnd-dragleave"><code>dragleave</code></dfn></td>
     <td><a data-anolis-xref="current target element" href="#current-target-element">前のターゲット要素</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>—</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td>"<code data-anolis-xref="">none</code>"</td>
     <td>なし</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-dragover" id="event-dnd-dragover"><code>dragover</code></dfn></td>
     <td><a href="#current-target-element">現在のターゲット要素</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>✓取消可能</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td><a href="#dropEffect-initialization"><code>effectAllowed</code>値をベースにする</a></td>
     <td>"none"<a href="#current-drag-operation">現在のドラッグ操作</a>リセットする</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-drop" id="event-dnd-drop"><code>drop</code></dfn></td>
     <td><a href="#current-target-element">現在のターゲット要素</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>✓取消可能</td>
     <td><a data-anolis-xref="concept-dnd-ro" href="#concept-dnd-ro">読み取り専用モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td><a href="#current-drag-operation">現在のドラッグ操作</a></td>
     <td>変化する</td>
    </tr><tr><td><dfn data-anolis-xref="event-dnd-dragend" id="event-dnd-dragend"><code>dragend</code></dfn></td>
     <td><a href="#source-node">ソースノード</a></td><!-- <td>&#x2713; Bubbles</td> -->
     
     <td>—</td>
     <td><a data-anolis-xref="concept-dnd-p" href="#concept-dnd-p">保護モード</a>
     <!-- <td>Same as last event</td> -->
     </td><td><a href="#current-drag-operation">現在のドラッグ操作</a></td>
     <td>変化する</td>
    </tr></table><p>上記の表に示されないもの：すべてのこれらイベントバブル、および<code data-anolis-xref="dom-DataTransfer-effectAllowed"><a href="#dom-datatransfer-effectallowed">effectAllowed</a></code>属性は常に、それが<code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>イベント後に持っていた値を持ち、<code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code>イベントで"<code data-anolis-xref="">uninitialized</code>"をデフォルトとする。</p>



  <h4 id="the-draggable-attribute"><span class="secno">5.7.7</span> <dfn data-anolis-xref="attr-draggable" id="attr-draggable"><code>draggable</code></dfn>属性</h4>

  <p>すべての<a href="infrastructure.html#html-elements">HTML要素</a>は<code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code>コンテンツ属性設定を持ってもよい。<code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code>属性は、<a href="infrastructure.html#enumerated-attribute">列挙属性</a>である。それは3つの状態を持つ。1番目の状態は<i>true</i>であり、それはキーワード<code data-anolis-xref="">true</code>を持つ。2番目の状態は<i>false</i>であり、それはキーワード<code data-anolis-xref="">false</code>を持つ。3番目の状態は<i>auto</i>である。それは、キーワードを持たない、<i>欠損値がデフォルト</i>である。</p>

  <p><i>true</i>状態は要素がドラッグ可能であることを意味し、<i>false</i>状態はそうでないことを意味する。<i>auto</i>状態はユーザーエージェントのデフォルト動作を使用する。</p>

  <p><code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code>属性を持つ要素はまた、非視覚的な相互作用の目的のために要素を名付ける<code data-anolis-xref="attr-title"><a href="dom.html#attr-title">title</a></code>属性を持つべきである。 <!-- "should", not "must", only because this is a relatively new
  attribute and its design implications are not entirely obvious yet. For example, what happens if
  you use an element with text as a drag source? Is that sufficiently clear for ATs? Indeed,
  shouldn't the element generally be distinguishable anyway for it to be useful to drag? See also
  the dropzone attribute. --></p>

  <dl class="domintro"><dt><var data-anolis-xref="">element</var> . <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>要素がドラッグ可能である場合にtrueを返す。そうでなければfalseを返す。</p>

    <p>デフォルトを上書きし<code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code>コンテンツの属性を設定するための、設定が可能である。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-draggable" id="dom-draggable"><code>draggable</code></dfn> IDL attribute, whose value depends
  on the content attribute's in the way described below, controls whether or not the element is
  draggable. Generally, only text selections are draggable, but elements whose <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute is true become draggable as well.</p>

  <p>If an element's <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> content attribute has the state
  <i>true</i>, the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute must return true.</p>

  <p>Otherwise, if the element's <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> content attribute has
  the state <i>false</i>, the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute must return
  false.</p>

  <p>Otherwise, the element's <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> content attribute has
  the state <i>auto</i>. If the element is an <code><a href="embedded-content.html#the-img-element">img</a></code> element, an <code><a href="embedded-content.html#the-object-element">object</a></code>
  element that <a href="dom.html#represents">represents</a> an image, or an <code><a href="text-level-semantics.html#the-a-element">a</a></code> element with an <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> content attribute, the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute must return true; otherwise, the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute must return false.</p>

  <p>If the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL attribute is set to the value false,
  the <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> content attribute must be set to the literal
  value <code data-anolis-xref="">false</code>. If the <code data-anolis-xref="dom-draggable"><a href="#dom-draggable">draggable</a></code> IDL
  attribute is set to the value true, the <code data-anolis-xref="attr-draggable"><a href="#the-draggable-attribute">draggable</a></code> content
  attribute must be set to the literal value <code data-anolis-xref="">true</code>.</p>

  </div>


  <h4 id="the-dropzone-attribute"><span class="secno">5.7.8</span> <dfn data-anolis-xref="attr-dropzone" id="attr-dropzone"><code>dropzone</code></dfn>属性</h4>

  <p>すべての<a href="infrastructure.html#html-elements">HTML要素</a>は、<code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>コンテンツ属性設定をもってもよい。指定された場合、その値は<a href="infrastructure.html#ascii-case-insensitive">ASCII大文字・小文字不区別</a>で<a href="infrastructure.html#unordered-set-of-unique-space-separated-tokens">一意なスペース区切りトークンの順不同の集合</a>でなければならない。許可される値は次のとおり：</p>

  <dl><dt><dfn data-anolis-xref="attr-dropzone-copy" id="attr-dropzone-copy"><code>copy</code></dfn></dt>

   <dd><p>要素で受け入れられるアイテムのドロップが、ドラッグしたデータのコピーになることを示す。</p>


   <dt><dfn data-anolis-xref="attr-dropzone-move" id="attr-dropzone-move"><code>move</code></dfn></dt>

   <dd><p>要素で受け入れられるアイテムのドロップが、新しい場所に移動されてドラッグされたデータになることを示す。</p>


   <dt><dfn data-anolis-xref="attr-dropzone-link" id="attr-dropzone-link"><code>link</code></dfn></dt>

   <dd><p>要素で受け入れられるアイテムのドロップが、元のデータへのリンクになることを示す。</p>


   <dt><a href="infrastructure.html#ascii-case-insensitive">大文字・小文字不区別</a>で文字列"<code data-anolis-xref="">string:</code>"にマッチするもので始まる、8文字以上を持つ任意のキーワード。</dt>

   <dd><p><a href="#the-drag-data-item-kind">ドラッグデータ項目の種類</a><i>プレーンUnicode文字列</i>および<a href="#the-drag-data-item-type-string">ドラッグデータ項目の種類の文字列</a>をもつ項目が受け入れられるキーワードの残りの部分と一致する値に設定することを示す。</dd><!--DND-v3:
   <dt>Any keyword with six characters or more, beginning with an <span>ASCII
   case-insensitive</span> match for the string "<code data-x="">blob:</code>"</dt>

   <dd><p>Indicates that items with <span>the drag data item kind</span> <i>Blob</i>, <i>File</i>,
   or <i>Plain Unicode string</i> and <span>the drag data item type string</span> set to a value
   that matches the remainder of the keyword are accepted.</p></dd>
-->



   <dt><a href="infrastructure.html#ascii-case-insensitive">大文字・小文字不区別</a>で文字列"<code data-anolis-xref="">file:</code>"にマッチするもので始まる、6文字以上を持つ任意のキーワード。</dt>

   <dd><p><a href="#the-drag-data-item-kind">ドラッグデータ項目の種類</a>の<i><a href="infrastructure.html#file">File</a></i>および<a href="#the-drag-data-item-type-string">ドラッグデータ項目の種類の文字列</a>をもつ項目が、受け入れられるキーワードの残りの部分と一致する値に設定することを示す。</dd><!--DND-v4:
   <dt>Any keyword with eight characters or more, beginning with an <span>ASCII
   case-insensitive</span> match for the string "<code data-x="">object:</code>"</dt>

   <dd><p>Indicates that items with <span>the drag data item type string</span> set to a value that
   matches the remainder of the keyword are accepted.</p></dd>
-->



  </dl><p><code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>コンテンツ属性の値は、指定された3つのフィードバック値のいずれか（<code data-anolis-xref="attr-dropzone-copy"><a href="#attr-dropzone-copy">copy</a></code>、<code data-anolis-xref="attr-dropzone-move"><a href="#attr-dropzone-move">move</a></code>、および<code data-anolis-xref="attr-dropzone-link"><a href="#attr-dropzone-link">link</a></code>）より多くを持ってはならない。何も指定されない場合、<code data-anolis-xref="attr-dropzone-copy"><a href="#attr-dropzone-copy">copy</a></code>値が暗黙的に指定される。</p>

  <p><code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性を持つ要素はまた、非視覚的な相互作用の目的のために要素を名付ける<code data-anolis-xref="attr-title"><a href="dom.html#attr-title">title</a></code>属性を持つべきである。 <!-- "should", not "must", only because this is a relatively new
  attribute and its design implications are not entirely obvious yet. For example, what happens if
  you use an element with text as a drop zone? Is that sufficiently clear for ATs? See also the
  draggable attribute. --></p>

  <div class="impl">

  <p>A <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute <dfn data-anolis-xref="concept-dropzone-match" id="concept-dropzone-match">matches a drag data store</dfn> if the <a href="#dropzone-processing-steps"><code data-anolis-xref="attr-dropzone">dropzone</code> processing steps</a> result in a match.</p>

  <p>A <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute <dfn data-anolis-xref="concept-dropzone-operation" id="concept-dropzone-operation">specifies an operation</dfn> if the <a href="#dropzone-processing-steps"><code data-anolis-xref="attr-dropzone">dropzone</code> processing steps</a> result in a specified operation. The
  specified operation is as given by those steps.</p>

  <p>The <dfn id="dropzone-processing-steps"><code data-anolis-xref="attr-dropzone">dropzone</code> processing steps</dfn> are as follows.
  They either result in a match or not, and separate from this result either in a specified
  operation or not, as defined below.</p>

  <ol><li><p>Let <var data-anolis-xref="">value</var> be the value of the <code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code> attribute.</li>

   <li><p>Let <var data-anolis-xref="">keywords</var> be the result of <a data-anolis-xref="split a string on
   spaces" href="infrastructure.html#split-a-string-on-spaces">splitting <var data-anolis-xref="">value</var> on spaces</a>.</li>

   <li><p>Let <var data-anolis-xref="">matched</var> be false.</li>

   <li><p>Let <var data-anolis-xref="">operation</var> be unspecified.</li>

   <li>

    <p>For each value in <var data-anolis-xref="">keywords</var>, if any, in the order that they were found in
    <var data-anolis-xref="">value</var>, run the following steps.</p>

    <ol><li><p>Let <var data-anolis-xref="">keyword</var> be the keyword.</li>

     <li>

      <p>If <var data-anolis-xref="">keyword</var> is one of "<code data-anolis-xref="attr-dropzone-copy"><a href="#attr-dropzone-copy">copy</a></code>",
      "<code data-anolis-xref="attr-dropzone-move"><a href="#attr-dropzone-move">move</a></code>", or "<code data-anolis-xref="attr-dropzone-link"><a href="#attr-dropzone-link">link</a></code>", then: run the following substeps:</p>

      <ol><li><p>If <var data-anolis-xref="">operation</var> is still unspecified, then let <var data-anolis-xref="">operation</var> be the string given by <var data-anolis-xref="">keyword</var>.</li>

       <li><p>Skip to the step labeled <i>end of keyword</i> below.</li>

      </ol></li>

     <li><p>If <var data-anolis-xref="">keyword</var> does not contain a ":" (U+003A) character, or if the
     first such character in <var data-anolis-xref="">keyword</var> is either the first character or the last
     character in the string, then skip to the step labeled <i>end of keyword</i> below.</li>

     <li><p>Let <var data-anolis-xref="">kind code</var> be the substring of <var data-anolis-xref="">keyword</var> from
     the first character in the string to the last character in the string that is before the first
     ":" (U+003A) character in the string, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.</p>

     </li><li>

      <p>Jump to the appropriate step from the list below, based on the value of <var data-anolis-xref="">kind
      code</var>:</p>

      <dl class="switch"><dt>If <var data-anolis-xref="">kind code</var> is the string "<code data-anolis-xref="">string</code>"</dt>
       <dd>

        <p>Let <var data-anolis-xref="">kind<!--DND-v3:/DND-v4: s--></var>  be <i>Plain Unicode string</i>.</p>

       </dd><!--DND-v3:
       <dt>If <var data-x="">kind code</var> is the string "<code data-x="">blob</code>"</dt>
       <dd>

        <p>Let <var data-x="">kinds</var> be <i>Plain Unicode string</i>, <i>Blob</i>, and
        <i>File</i>.</p>

       </dd>
-->



       <dt>If <var data-anolis-xref="">kind code</var> is the string "<code data-anolis-xref="">file</code>"</dt>
       <dd>

        <p>Let <var data-anolis-xref="">kind<!--DND-v3:/DND-v4: s--></var>  be <i><a href="infrastructure.html#file">File</a></i>.</p>

       </dd><!--DND-v4:
       <dt>If <var data-x="">kind code</var> is the string "<code data-x="">object</code>"</dt>
       <dd>

        <p>Let <var data-x="">kinds</var> be <i>Plain Unicode string</i>, <i>Blob</i>, <i>File</i>,
        and <i>Object</i>.</p>

       </dd>
-->



       <dt>そうでなければ</dt>
       <dd>

        <p>Skip to the step labeled <i>end of keyword</i> below.</p>

       </dd>

      </dl></li>

     <li><p>Let <var data-anolis-xref="">type</var> be the substring of <var data-anolis-xref="">keyword</var> from the
     first character after the first ":" (U+003A) character in the string, to the last character
     in the string, <a href="infrastructure.html#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.</li>

     <li><p>If there exist any items in the <a href="#drag-data-store-item-list">drag data store item list</a> whose <a data-anolis-xref="the drag data item kind" href="#the-drag-data-item-kind">drag data item kind</a> is  <!--DND-v3:/DND-v4: one of-->  the
     kind<!--DND-v3:/DND-v4: s-->  given in <var data-anolis-xref="">kind<!--DND-v3:/DND-v4: s--></var>  and
     whose <a data-anolis-xref="the drag data item type string" href="#the-drag-data-item-type-string">drag data item type string</a> is <var data-anolis-xref="">type</var>, then let <var data-anolis-xref="">matched</var> be true.</li>

     <li><p><i>End of keyword</i>: Go on to the next keyword, if any, or the next step in the
     overall algorithm, if there are no more.</li>

    </ol></li>

   <li>

    <p>The algorithm results in a match if <var data-anolis-xref="">matched</var> is true, and does not
    otherwise.</p>

    <p>The algorithm results in a specified operation if <var data-anolis-xref="">operation</var> is not
    unspecified. The specified operation, if one is specified, is the one given by <var data-anolis-xref="">operation</var>.</p>

   </li>

  </ol><p>The <dfn data-anolis-xref="dom-dropzone" id="dom-dropzone"><code>dropzone</code></dfn> IDL attribute must
  <a href="infrastructure.html#reflect">reflect</a> the content attribute of the same name.</p>

  </div>

  <div class="example">

   <p>この例において、<code><a href="grouping-content.html#the-div-element">div</a></code>要素は<code data-anolis-xref="attr-dropzone"><a href="#the-dropzone-attribute">dropzone</a></code>属性を使用する画像ファイルに対してドロップターゲットとなる。ターゲットにドロップされた画像が表示される。</p>

   <pre>&lt;div dropzone="copy file:image/png file:image/gif file:image/jpeg" ondrop="receive(event, this)"&gt;
 &lt;p&gt;Drop an image here to have it displayed.&lt;/p&gt;
&lt;/div&gt;
&lt;script&gt;
 function receive(event, element) {
   var data = event.dataTransfer.items;
   for (var i = 0; i &lt; data.length; i += 1) {
     if ((data[i].kind == 'file') &amp;&amp; (data[i].type.match('^image/'))) {
       var img = new Image();
       img.src = window.createObjectURL(data[i].getAsFile());
       element.appendChild(img);
     }
   }
 }
&lt;/script&gt;</pre>

  </div><!--
  <h4>Copy and paste</h4>

  <p>Copy-and-paste is a form of drag-and-drop: the "copy" part is equivalent to dragging content to
  another application (the "clipboard"), and the "paste" part is equivalent to dragging content
  <em>from</em> another application.</p>

  <p>Select-and-paste (a model used by mouse operations in the X Window System) is equivalent to a
  drag-and-drop operation where the source is the selection.</p>


  <div class="impl">

  <h5>Copy to clipboard</h5>

  <p>When the user invokes a copy operation, the user agent must act as if the user had invoked a
  drag on the current selection. If the drag-and-drop operation initiates, then the user agent must
  act as if the user had indicated (as the <span>immediate user selection</span>) a hypothetical
  application representing the clipboard. Then, the user agent must act as if the user had ended the
  drag-and-drop operation without canceling it. If the drag-and-drop operation didn't get canceled,
  the user agent should then follow the relevant platform-specific conventions for copy operations
  (e.g. updating the clipboard).</p>

  <p>The events involved in this process are the <code data-x="event-dnd-dragstart">dragstart</code>,
  <code data-x="event-dnd-drag">drag</code>, and <code data-x="event-dnd-dragend">dragend</code> events.</p>


  <h5>Cut to clipboard</h5>

  <p>When the user invokes a cut operation, the user agent must act as if the user had invoked a
  copy operation (see the previous section), followed, if the copy was completed successfully, by <a
  href="#contenteditable-delete">a selection delete operation</a>.</p>

  <p>The events involved in this process are the <code data-x="event-dnd-dragstart">dragstart</code>,
  <code data-x="event-dnd-drag">drag</code>, and <code data-x="event-dnd-dragend">dragend</code> events.</p>


  <h5>Paste from clipboard</h5>

  <p>When the user invokes a clipboard paste operation, the user agent must act as if the user had
  invoked a drag on a hypothetical application representing the clipboard, setting the data
  associated with the drag as the content on the clipboard (in whatever formats are available).</p>

  <p>Then, the user agent must act as if the user had indicated (as the <span>immediate user
  selection</span>) the element with the keyboard focus, and then ended the drag-and-drop operation
  without canceling it.</p>

  <p>The events involved in this process are the <code data-x="event-dnd-dragenter">dragenter</code>,
  <code data-x="event-dnd-dragover">dragover</code>, <code data-x="event-dnd-dragexit">dragexit</code>, <code
  data-x="event-dnd-dragleave">dragleave</code>, and <code data-x="event-dnd-drop">drop</code> events.</p>


  <h5>Paste from selection</h5>

  <p>When the user invokes a selection paste operation, the user agent must act as if the user had
  invoked a drag on the current selection, then indicated (as the <span>immediate user
  selection</span>) the element with the keyboard focus, and then ended the drag-and-drop operation
  without canceling it.</p>

  <p>All the drag-and-drop events can be involved in this process.</p>

  </div>
--><!--ADD-TOPIC:Security-->






  <div class="impl">

  <h4 id="security-risks-in-the-drag-and-drop-model"><span class="secno">5.7.9 </span>Security risks in the drag-and-drop model</h4>

  <p>User agents must not make the data added to the <code><a href="#datatransfer">DataTransfer</a></code> object during the
  <code data-anolis-xref="event-dnd-dragstart"><a href="#event-dnd-dragstart">dragstart</a></code> event available to scripts until the <code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code> event, because otherwise, if a user were to drag sensitive
  information from one document to a second document, crossing a hostile third document in the
  process, the hostile document could intercept the data.</p>

  <p>For the same reason, user agents must consider a drop to be successful only if the user
  specifically ended the drag operation — if any scripts end the drag operation, it must be
  considered unsuccessful (canceled) and the <code data-anolis-xref="event-dnd-drop"><a href="#event-dnd-drop">drop</a></code> event must not be
  fired.</p>

  <p>User agents should take care to not start drag-and-drop operations in response to script
  actions. For example, in a mouse-and-window environment, if a script moves a window while the user
  has his mouse button depressed, the UA would not consider that to start a drag. This is important
  because otherwise UAs could cause data to be dragged from sensitive sources and dropped into
  hostile documents without the user's consent.</p>

  <p>User agents should filter potentially active (scripted) content (e.g. HTML) when it is dragged
  and when it is dropped, using a whitelist of known-safe features. Similarly, <a data-anolis-xref="relative
  URL" href="infrastructure.html#relative-url">relative URLs</a> should be turned into absolute URLs to avoid references changing in
  unexpected ways. This specification does not specify how this is performed.</p>

  <div class="example">

   <p>Consider a hostile page providing some content and getting the user to select and drag and
   drop (or indeed, copy and paste) that content to a victim page's <code data-anolis-xref="attr-contenteditable"><a href="#attr-contenteditable">contenteditable</a></code> region. If the browser does not ensure that
   only safe content is dragged, potentially unsafe content such as scripts and event handlers in
   the selection, once dropped (or pasted) into the victim site, get the privileges of the victim
   site. This would thus enable a cross-site scripting attack.</p>

  </div>

  </div><!--REMOVE-TOPIC:Security-->




  </body></html>