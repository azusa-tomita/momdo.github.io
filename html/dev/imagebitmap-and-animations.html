<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Developer's Edition 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><body>
  <script async="" src="search.js"></script>
  
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><h2 id="dev-edition-h2" class="no-num no-toc">Developer's Edition — Last Updated <span class="pubdate">11 March 2020</span></h2></hgroup>
   

   <div id="search"><input placeholder="Search. Press '/'" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="system-state.html">← 8.9 System state and capabilities</a> — <a href="./">Table of Contents</a> — <a href="comms.html">9 Communication →</a></nav><ol class="toc"><li><ol><li><a href="imagebitmap-and-animations.html#images-2"><span class="secno">8.10</span> Images</a><li><a href="imagebitmap-and-animations.html#animation-frames"><span class="secno">8.11</span> Animation frames</a></ol></ol><h3 id="images-2"><span class="secno">8.10</span> Images<a href="#images-2" class="self-link"></a></h3>

  

  <p>An <code>ImageBitmap</code> object represents a bitmap image that can be painted to a canvas without undue latency.</p>

  <p class="note">この過度の待ち時間は何かの正確な判断は実装者に委ねるが、一般にビットマップを活用することは、ネットワークI/O、あるいはローカルディスクI/Oを必要とする場合、その後待ち時間はおそらく過度である。一方それが唯一のGPUやシステムRAMからのブロッキングの読み出しを必要とする場合、待ち時間はおそらく許容できる。</p>

  <aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/createImageBitmap" title="The createImageBitmap() method creates a bitmap from a given source, optionally cropped to contain only a portion of that source. The method exists on the global scope in both windows and workers. It accepts a variety of different image sources, and returns a Promise which resolves to an ImageBitmap.">WindowOrWorkerGlobalScope/createImageBitmap</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>50+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>50+</span></span><span class="edge yes"><span>Edge</span><span>79+</span></span><span class="edge_legacy no"><span>Edge (Legacy)</span><span>No</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>52+</span></span><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>50+</span></span></details></div></aside><aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/close" title="The ImageBitmap.close() method disposes of all graphical resources associated with an ImageBitmap.">ImageBitmap/close</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>52+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>52+</span></span><span class="edge yes"><span>Edge</span><span>79+</span></span><span class="edge_legacy no"><span>Edge (Legacy)</span><span>No</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>46+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>46+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>37+</span></span><span class="opera_android yes"><span>Opera Android</span><span>37+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>52+</span></span></details></div></aside><aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/width" title="The read-only ImageBitmap.width property returns the ImageBitmap object's width in CSS pixels.">ImageBitmap/width</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>50+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>50+</span></span><span class="edge yes"><span>Edge</span><span>79+</span></span><span class="edge_legacy no"><span>Edge (Legacy)</span><span>No</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>42+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>37+</span></span><span class="opera_android yes"><span>Opera Android</span><span>37+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>50+</span></span></details></div></aside><aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/height" title="The read-only ImageBitmap.height property returns the ImageBitmap object's height in CSS pixels.">ImageBitmap/height</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>50+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>50+</span></span><span class="edge yes"><span>Edge</span><span>79+</span></span><span class="edge_legacy no"><span>Edge (Legacy)</span><span>No</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>42+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>37+</span></span><span class="opera_android yes"><span>Opera Android</span><span>37+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>50+</span></span></details></div></aside><dl class="domintro"><dt><var>promise</var> = self . <code id="dom-createimagebitmap">createImageBitmap</code>(<var>image</var> [, <var>options</var> ])<dt><var>promise</var> = self . <code id="images-2:dom-createimagebitmap"><a href="#dom-createimagebitmap">createImageBitmap</a></code>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var> [, <var>options</var> ])<dd><p>Takes <var>image</var>, which can be an <code id="images-2:the-img-element"><a href="embedded-content.html#the-img-element">img</a></code> element, an <a id="images-2:svg-image" href="https://svgwg.org/svg2-draft/embedded.html#ImageElement" data-x-internal="svg-image">SVG <code>image</code></a> element, a <code id="images-2:the-video-element"><a href="media.html#the-video-element">video</a></code> element, a <code id="images-2:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code> element, a <code id="images-2:blob"><a data-x-internal="blob" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a></code> object, an <code>ImageData</code> object, or another <code>ImageBitmap</code> object, and returns a promise that is resolved when a new <code>ImageBitmap</code> is created.</p>

    <p>If no <code>ImageBitmap</code> object can be constructed, for example because the provided <var>image</var> data is not actually an image, then the promise is rejected instead.</p>

    <p>If <var>sx</var>, <var>sy</var>, <var>sw</var>, and <var>sh</var> arguments are provided, the source image is cropped to the given pixels, with any pixels missing in the original replaced by <a id="images-2:transparent-black" href="https://drafts.csswg.org/css-color/#transparent-black" data-x-internal="transparent-black">transparent black</a>. These coordinates are in the source image's pixel coordinate space, <em>not</em> in <a href="https://momdo.github.io/css3-values/#px" id="images-2:'px'" data-x-internal="'px'">CSS pixels</a>.</p>

    <p>If <var>options</var> is provided, the <code>ImageBitmap</code> object's bitmap data is modified according to <var>options</var>. For example, if the <code>premultiplyAlpha</code> option is set to "<code>premultiply</code>", the <span>bitmap data</span>'s color channels are premultiplied by its alpha channel.<p>Rejects the promise with an <a id="images-2:invalidstateerror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if the source image is not in a valid state (e.g., an <code id="images-2:the-img-element-2"><a href="embedded-content.html#the-img-element">img</a></code> element that hasn't loaded successfully, an <code>ImageBitmap</code> object whose <span>[[Detached]]</span> internal slot value is true, an <code>ImageData</code> object whose <code id="images-2:dom-imagedata-data"><a href="canvas.html#dom-imagedata-data">data</a></code> attribute value's [[ViewedArrayBuffer]] internal slot is detached, or a <code id="images-2:blob-2"><a data-x-internal="blob" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a></code> whose data cannot be interpreted as a bitmap image).</p>

    <p>Rejects the promise with a <a id="images-2:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="images-2:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if the script is not allowed to access the image data of the source image (e.g. a <code id="images-2:the-video-element-2"><a href="media.html#the-video-element">video</a></code> that is <span>CORS-cross-origin</span>, or a <code id="images-2:the-canvas-element-2"><a href="canvas.html#the-canvas-element">canvas</a></code> being drawn on by a script in a worker from another <a id="images-2:concept-origin" href="origin.html#concept-origin">origin</a>).</p>

   <dt><var>imageBitmap</var> . <code id="dom-imagebitmap-close">close</code>()<dd><p>Releases <var>imageBitmap</var>'s underlying <span>bitmap data</span>.</p>

   <dt><var>imageBitmap</var> . <code id="dom-imagebitmap-width">width</code><dd><p>Returns the <a id="images-2:intrinsic-width" href="infrastructure.html#intrinsic-width">intrinsic width</a> of the image, in <a href="https://momdo.github.io/css3-values/#px" id="images-2:'px'-2" data-x-internal="'px'">CSS pixels</a>.</p>

   <dt><var>imageBitmap</var> . <code id="dom-imagebitmap-height">height</code><dd><p>Returns the <a id="images-2:intrinsic-height" href="infrastructure.html#intrinsic-height">intrinsic height</a> of the image, in <a href="https://momdo.github.io/css3-values/#px" id="images-2:'px'-3" data-x-internal="'px'">CSS pixels</a>.</p>

   </dl><div class="status"><input onclick="toggleStatus(this)" value="⋰" type="button"><p class="support"><strong>Support:</strong> createimagebitmap<span class="and_chr yes"><span>Chrome for Android</span> <span>80+</span></span><span class="chrome yes"><span>Chrome</span> <span>59+</span></span><span class="ios_saf no"><span>iOS Safari</span> <span>None</span></span><span class="firefox partial"><span>Firefox (limited)</span> <span>42+</span></span><span class="safari no"><span>Safari</span> <span>None</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>6.2+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>12.12+</span></span><span class="edge yes"><span>Edge</span> <span>79+</span></span><span class="ie no"><span>IE</span> <span>None</span></span><span class="opera yes"><span>Opera</span> <span>46+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>80+</span></span><p class="caniuse">Source: <a href="https://caniuse.com/#feat=createimagebitmap">caniuse.com</a></div>

  

  <div class="example"><p>このAPIを使用すると、スプライトシートは、プレカットと調製することができる：</p>

   <pre><code class='js'><c- a>var</c-> sprites <c- o>=</c-> <c- p>{};</c->
<c- a>function</c-> loadMySprites<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> image <c- o>=</c-> <c- k>new</c-> Image<c- p>();</c->
  image<c- p>.</c->src <c- o>=</c-> <c- t>'mysprites.png'</c-><c- p>;</c->
  <c- a>var</c-> resolver<c- p>;</c->
  <c- a>var</c-> promise <c- o>=</c-> <c- k>new</c-> Promise<c- p>(</c-><c- a>function</c-> <c- p>(</c->arg<c- p>)</c-> <c- p>{</c-> resolver <c- o>=</c-> arg <c- p>});</c->
  image<c- p>.</c->onload <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
    resolver<c- p>(</c->Promise<c- p>.</c->all<c- p>([</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mi>0</c-><c- p>,</c->  <c- mi>0</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->person <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mi>40</c-><c- p>,</c->  <c- mi>0</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->grass  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mi>80</c-><c- p>,</c->  <c- mi>0</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->tree   <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mi>0</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->hut    <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->apple  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mi>80</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>,</c-> <c- mi>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->snake  <c- o>=</c-> image <c- p>})</c->
    <c- p>]));</c->
  <c- p>};</c->
  <c- k>return</c-> promise<c- p>;</c->
<c- p>}</c->

<c- a>function</c-> runDemo<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> canvas <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'canvas#demo'</c-><c- p>);</c->
  <c- a>var</c-> context <c- o>=</c-> canvas<c- p>.</c->getContext<c- p>(</c-><c- t>'2d'</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->tree<c- p>,</c-> <c- mi>30</c-><c- p>,</c-> <c- mi>10</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->snake<c- p>,</c-> <c- mi>70</c-><c- p>,</c-> <c- mi>10</c-><c- p>);</c->
<c- p>}</c->

loadMySprites<c- p>().</c->then<c- p>(</c->runDemo<c- p>);</c-></code></pre>

  </div>



  <aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame" title="The window.requestAnimationFrame() method tells the browser that you wish to perform an animation and requests that the browser calls a specified function to update an animation before the next repaint. The method takes a callback as an argument to be invoked before the repaint.">Window/requestAnimationFrame</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>24+</span></span><span class="chrome yes"><span>Chrome</span><span>10+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>25+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="edge yes"><span>Edge</span><span>79+</span></span><span class="edge_legacy yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="opera no"><span>Opera</span><span>No</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span><span class="safari yes"><span>Safari</span><span>6.1+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6.1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.5+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside><h3 id="animation-frames"><span class="secno">8.11</span> Animation frames<a href="#animation-frames" class="self-link"></a></h3><div class="status"><input onclick="toggleStatus(this)" value="⋰" type="button"><p class="support"><strong>Support:</strong> requestanimationframe<span class="and_chr yes"><span>Chrome for Android</span> <span>80+</span></span><span class="chrome yes"><span>Chrome</span> <span>24+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>7.0+</span></span><span class="firefox yes"><span>Firefox</span> <span>23+</span></span><span class="safari yes"><span>Safari</span> <span>6.1+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>12.12+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>4.4+</span></span><p class="caniuse">Source: <a href="https://caniuse.com/#feat=requestanimationframe">caniuse.com</a></div>

  <p>Some objects include the <code>AnimationFrameProvider</code> interface mixin.</p>

  

  <p>Each <code>AnimationFrameProvider</code> object also has a <dfn id="concept-animationframeprovider-target-object">target object</dfn> that stores the provider's internal state. It is defined as follows:</p>

  <dl><dt>If the <code>AnimationFrameProvider</code> is a <code>Window</code><dd>The <code>Window</code>'s <span>associated <code>Document</code></span><dt>If the <code>AnimationFrameProvider</code> is a <code id="animation-frames:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code><dd>The <code id="animation-frames:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code></dl>

  <p>Each <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object">target object</a> has a <dfn id="list-of-animation-frame-callbacks">map of animation frame callbacks</dfn>, which is an <a id="animation-frames:ordered-map" href="https://triple-underscore.github.io/infra-ja.html#ordered-map" data-x-internal="ordered-map">ordered map</a> that must be initially empty, and an <dfn id="animation-frame-callback-identifier">animation frame callback identifier</dfn>, which is a number that must initially be zero.</p>

  <p>An <code>AnimationFrameProvider</code> <var>provider</var> is considered <dfn id="concept-animationframeprovider-supported">supported</dfn> if any of the following hold:</p>

  <ul class="brief"><li><var>provider</var> is a <code>Window</code>.<li><var>provider</var>'s <span>owner set</span> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="animation-frames:list-contains" data-x-internal="list-contains">contains</a> a <code>Document</code> object.<li>Any of the <code id="animation-frames:dedicatedworkerglobalscope-3"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> objects in <var>provider</var>'s <span>owner set</span> are <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported">supported</a>.</ul>

  <hr>

  <p>The <dfn id="dom-animationframeprovider-requestanimationframe"><code>requestAnimationFrame(<var>callback</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If this <code>AnimationFrameProvider</code> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-2">supported</a>, then throw a <a id="animation-frames:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>target</var> be this <code>AnimationFrameProvider</code>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-2">target object</a>.<li><p>Increment <var>target</var>'s <a href="#animation-frame-callback-identifier" id="animation-frames:animation-frame-callback-identifier">animation frame callback identifier</a> by one, and let <var>handle</var> be the result.<li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks">map of animation frame callbacks</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="animation-frames:map-set" data-x-internal="map-set">Set</a> <var>callbacks</var>[<var>handle</var>] to <var>callback</var>.<li><p>Return <var>handle</var>.</ol>

  <aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame" title="The window.cancelAnimationFrame() method cancels an animation frame request previously scheduled through a call to window.requestAnimationFrame().">Window/cancelAnimationFrame</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge yes"><span>Edge</span><span>Yes</span></span><span class="edge_legacy yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span><span class="safari yes"><span>Safari</span><span>6.1+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside><p>The <dfn id="animationframeprovider-cancelanimationframe"><code>cancelAnimationFrame(<var>handle</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If this <code>AnimationFrameProvider</code> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-3">supported</a>, then throw a <a id="animation-frames:notsupportederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>callbacks</var> be this <code>AnimationFrameProvider</code>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-3">target object</a>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-2">map of animation frame callbacks</a>.<li><p><a href="https://infra.spec.whatwg.org/#map-remove" id="animation-frames:map-remove" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].</ol>

  <p>To <dfn id="run-the-animation-frame-callbacks">run the animation frame callbacks</dfn> for a <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-4">target object</a> <var>target</var> with a timestamp <var>now</var>:</p>

  <ol><li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-3">map of animation frame callbacks</a>.<li><p>Let <var>callbackHandles</var> be the result of <a href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="animation-frames:map-get-the-keys" data-x-internal="map-get-the-keys">getting the keys</a> of <var>callbacks</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="animation-frames:list-iterate" data-x-internal="list-iterate">For each</a> <var>handle</var> in <var>callbackHandles</var>, if <var>handle</var> <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="animation-frames:map-exists" data-x-internal="map-exists">exists</a> in <var>callbacks</var>:</p>

    <ol><li><p>Let <var>callback</var> be <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://infra.spec.whatwg.org/#map-remove" id="animation-frames:map-remove-2" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="animation-frames:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>callback</var>, passing <var>now</var> as the only argument, and if an exception is thrown, <span>report the exception</span>.</ol>
   </ol>

  <div class="example"><p>Inside workers, <code id="animation-frames:dom-animationframeprovider-requestanimationframe"><a href="#dom-animationframeprovider-requestanimationframe">requestAnimationFrame()</a></code> can be used together with an <code>OffscreenCanvas</code> transferred from a <code id="animation-frames:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code> element. First, in the document, transfer control to the worker:</p>

   <pre><code class='js'><c- kr>const</c-> offscreenCanvas <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- u>"c"</c-><c- p>).</c->transferControlToOffscreen<c- p>();</c->
worker<c- p>.</c->postMessage<c- p>(</c->offscreenCanvas<c- p>,</c-> <c- p>[</c->offscreenCanvas<c- p>]);</c-></code></pre>

   <p>Then, in the worker, the following code will draw a rectangle moving from left to right:</p>

   <pre><code class='js'><c- a>let</c-> ctx<c- p>,</c-> pos <c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- a>function</c-> draw<c- p>(</c->dt<c- p>)</c-> <c- p>{</c->
  ctx<c- p>.</c->clearRect<c- p>(</c-><c- mi>0</c-><c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>100</c-><c- p>,</c-> <c- mi>100</c-><c- p>);</c->
  ctx<c- p>.</c->fillRect<c- p>(</c->pos<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>10</c-><c- p>,</c-> <c- mi>10</c-><c- p>);</c->
  pos <c- o>+=</c-> <c- mi>10</c-> <c- o>*</c-> dt<c- p>;</c->
  requestAnimationFrame<c- p>(</c->draw<c- p>);</c->
<c- p>}</c->

self<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-><c- p>(</c->ev<c- p>)</c-> <c- p>{</c->
  <c- kr>const</c-> transferredCanvas <c- o>=</c-> ev<c- p>.</c->data<c- p>;</c->
  ctx <c- o>=</c-> transferredCanvas<c- p>.</c->getContext<c- p>(</c-><c- u>"2d"</c-><c- p>);</c->
  draw<c- p>();</c->
<c- p>};</c-></code></pre>
  </div>

  <nav><a href="system-state.html">← 8.9 System state and capabilities</a> — <a href="./">Table of Contents</a> — <a href="comms.html">9 Communication →</a></nav>
