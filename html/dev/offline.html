<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Developer's Edition 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <!--script async="" src=/dev/search.js></script-->
  
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><h2 id="dev-edition-h2" class="no-num no-toc">Developer's Edition — Last Updated <span class="pubdate">12 August 2020</span></h2></hgroup>
   

   <div id="search"><input placeholder="Search. Press '/'" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="browsing-the-web.html">← 7.8 ウェブを閲覧する</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav><ol class="toc"><li><ol><li><a href="offline.html#offline"><span class="secno">7.9</span> オフラインウェブアプリケーション</a><ol><li><a href="offline.html#introduction-10"><span class="secno">7.9.1</span> 導入</a><ol><li><a href="offline.html#supporting-offline-caching-for-legacy-applications"><span class="secno">7.9.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート</a><li><a href="offline.html#appcacheevents"><span class="secno">7.9.1.2</span> イベントの概要</a></ol><li><a href="offline.html#manifests"><span class="secno">7.9.2</span> キャッシュマニフェスト構文</a><ol><li><a href="offline.html#some-sample-manifests"><span class="secno">7.9.2.1</span> サンプルマニフェスト</a><li><a href="offline.html#writing-cache-manifests"><span class="secno">7.9.2.2</span> キャッシュマニフェストの記述</a></ol><li><a href="offline.html#security-concerns-with-offline-applications-caches"><span class="secno">7.9.3</span> Security concerns with offline applications caches</a><li><a href="offline.html#application-cache-api"><span class="secno">7.9.4</span> アプリケーションキャッシュAPI</a><li><a href="offline.html#navigator.online"><span class="secno">7.9.5</span> ブラウザーの状態</a></ol></ol></ol><h3 id="offline"><span class="secno">7.9</span> オフラインウェブアプリケーション<a href="#offline" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache" title="HTML5 provides an application caching mechanism that lets web applications run offline. This Application Cache (AppCache) interface lists resources that browsers should cache to be available offline. Applications that are cached load and work correctly offline, even if users press the Refresh button.">Using_the_application_cache</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>3.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=offline-apps" title="Offline web applications">caniuse.com table</a></span></span></div></div></div> 

  <p class="critical">この機能は、ウェブプラットフォームから削除中である。（これは何年もかかる長いプロセスである。）現時点で、オフラインウェブアプリケーション機能のいずれかを使用することは、極めて勧められない。代わりにサービスワーカーを使用すること。<a href="references.html#refsSW">[SW]</a></p>

  

  <h4 id="introduction-10"><span class="secno">7.9.1</span> 導入<a href="#introduction-10" class="self-link"></a></h4>

  

  <p>ネットワーク接続が利用できない場合―たとえば、ユーザーがISPのカバレッジエリアの外に移動しているため―でも、ユーザーにウェブアプリケーションおよび文書との対話を継続できるようにするために、著者は、オフラインで作業し、オフラインで使用のためにファイルのコピーを保持するためにユーザーのブラウザーになる、ウェブアプリケーション用に必要とされるファイルの一覧を示したマニフェストを提供できる。</p>

  <p>これを説明するために、HTMLページ"<code>clock1.html</code>"、CSSスタイルシート"<code>clock.css</code>"、およびJavaScriptスクリプト"<code>clock.js</code>"から成る単純な時計アプレットを考えてみる。</p>

  <p>マニフェストを追加する前に、これらの3つのファイルは次のようになる：</p>

  <pre><code class='html'><c- c>&lt;!-- clock1.html --></c->
<c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>meta</c-> <c- e>charset</c-><c- o>=</c-><c- s>"utf-8"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Clock<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"clock.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>link</c-> <c- e>rel</c-><c- o>=</c-><c- s>"stylesheet"</c-> <c- e>href</c-><c- o>=</c-><c- s>"clock.css"</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The time is: <c- p>&lt;</c-><c- f>output</c-> <c- e>id</c-><c- o>=</c-><c- s>"clock"</c-><c- p>>&lt;/</c-><c- f>output</c-><c- p>>&lt;/</c-><c- f>p</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c->
</code></pre>
  <pre><code class='css'><c- c>/* clock.css */</c->
<c- f>output </c-><c- p>{</c-> <c- k>font</c-><c- p>:</c-> <c- m>2</c-><c- l>em</c-> sans-serif<c- p>;</c-> <c- p>}</c->
</code></pre>
  <pre><code class='js'><c- d>/* clock.js */</c->
setInterval<c- p>(</c-><c- a>function</c-> <c- p>()</c-> <c- p>{</c->
    document<c- p>.</c->getElementById<c- p>(</c-><c- t>'clock'</c-><c- p>).</c->value <c- o>=</c-> <c- k>new</c-> Date<c- p>();</c->
<c- p>},</c-> <c- mi>1000</c-><c- p>);</c->
</code></pre>

  <p>ユーザーがオフライン時に"<code>clock1.html</code>"ページを開こうとする場合、しかし、（ローカルキャッシュにまだ持つ場合を除いて）ユーザーエージェントはエラーとともに失敗する。</p>

  <p>著者は、代わりに"<code>clock.appcache</code>"という、3つのファイルのマニフェストを提供できる：</p>

  <pre>CACHE MANIFEST
clock2.html
clock.css
clock.js
</pre>

  <p>With a small change to the HTML file, the manifest (served as <code>text/cache-manifest</code>) is linked to the application:</p>

  <pre><code class='html'><c- c>&lt;!-- clock2.html --></c->
<c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-> <c- e>manifest</c-><c- o>=</c-><c- s>"clock.appcache"</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>meta</c-> <c- e>charset</c-><c- o>=</c-><c- s>"utf-8"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Clock<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"clock.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>link</c-> <c- e>rel</c-><c- o>=</c-><c- s>"stylesheet"</c-> <c- e>href</c-><c- o>=</c-><c- s>"clock.css"</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The time is: <c- p>&lt;</c-><c- f>output</c-> <c- e>id</c-><c- o>=</c-><c- s>"clock"</c-><c- p>>&lt;/</c-><c- f>output</c-><c- p>>&lt;/</c-><c- f>p</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c->
</code></pre>

  <p>さて、ユーザーがページに行く場合、ブラウザーはファイルをキャッシュし、ユーザーがオフラインである場合でも、それらを使用できるようにする。</p>

  <p class="note">著者はまた、マニフェストのメインページを含めることを推奨するが、実際にマニフェストを参照されるページは、明示的に言及されない場合でも、自動的にキャッシュされる。</p>

  <p class="note">"no-store"ディレクティブ例外とともに、TLSで供給される（<code id="introduction-10:https-protocol"><a data-x-internal="https-protocol" href="https://triple-underscore.github.io/RFC7230-ja.html#section-2.7.2">https:</a></code>を使用して暗号化される）キャッシュページでのHTTPキャッシュヘッダーと制限は、マニフェストによって上書きされる。したがって、ページは、ユーザーエージェントがそれを更新する前にアプリケーションキャッシュから期限切れにならず、TLS経由で提供されるアプリケーションはオフラインで動作させることができる。</p>

  <p><a href="https://html.spec.whatwg.org/demos/offline/clock/clock2.html">この例をオンラインで見る</a>。</p>



  <h5 id="supporting-offline-caching-for-legacy-applications"><span class="secno">7.9.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート<a href="#supporting-offline-caching-for-legacy-applications" class="self-link"></a></h5>

  

  <p>マニフェストに記載されかつアプリケーションキャッシュに格納されたロジック（マークアップ、スクリプト、スタイルシート、画像など）とともに、アプリケーションに対する有限数の静的HTMLページとともに、およびウェブストレージまたはサーバー側にインデックス付けされたデータベースに格納されたアプリケーションおよびユーザーデーターとともに、アプリケーションロジックがアプリケーションとユーザーデータから別れる場合、アプリケーションキャッシュ機能は最も機能的に動作し、ウェブソケット、<code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>、サーバーに送信されるイベント、または他の同様の機構を使用して動的に更新される。</p>

  <p>このモデルはユーザーに対して高速な経験をもたらす：（おそらく古いデータを示しつつ）アプリケーション即時に読み込み、ネットワークがそれを可能にするように、新鮮なデータを高速に得られる。</p>

  <p>しかし、レガシーアプリケーションは、サーバーから新しいHTMLページで得られた各操作とともに、ユーザーデータおよびロジックがHTMLと一緒に混合されるように設計される傾向にある。</p>

  <div class="example"><p>たとえば、ニュースアプリケーションを考えてみよう。このようなアプリケーションの典型的なアーキテクチャーは、アプリケーションキャッシュ機能を使用しない場合、ユーザーはメインページをフェッチし、サーバーは現在の見出しとユーザーインターフェイスロジックを一緒に混合した動的に生成されるページを返す。</p>

   <p>しかし、アプリケーションキャッシュ機能のために設計されたニュースアプリケーションは、ロジックでのみ構成されるメインページを代わりに持つだろうし、メインページがサーバーとは別にデータをフェッチしているだろう。たとえば、<code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest-2"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>を使用して。</p>

  </div>

  <p>混合コンテンツモデルは、アプリケーションのキャッシュ機能とともにうまく動作しない：コンテンツがキャッシュされているので、常にキャッシュが更新された前回から古いデータを見て、ユーザーにもたらすだろう。</p>

  <p>分離されたモデルと同じ速さで、従来のモデルを動作させる方法がないが、それは少なくとも<span>好ましいオンライン</span><span>アプリケーションキャッシュモード</span>を使用してオフライン利用で使用するために改造<em>できる</em>。これを行うには、<span>アプリケーションキャッシュマニフェスト</span>でオフライン作業をしたいHTMLページによって使用されるすべての静的リソースを一覧表示し、HTMLファイルからそのマニフェストを選択する<code id="supporting-offline-caching-for-legacy-applications:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>属性を使用し、マニフェストの一番下に次の行を追加する：</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>This causes the <span>application cache</span> to only be used for <span>primary entries</span> when the user is offline, and causes the application cache to be used as an atomic HTTP cache (essentially pinning resources listed in the manifest), while allowing all resources not listed in the manifest to be accessed normally when the user is online.</p>



  <h5 id="appcacheevents"><span class="secno">7.9.1.2</span> イベントの概要<a href="#appcacheevents" class="self-link"></a></h5>

  

  <p>ユーザーがマニフェストを宣言するページを訪問するときに、ブラウザーはキャッシュを更新しようとする。これは、ユーザーエージェントが最後にそれを見てからマニフェストが変更された場合、それが言及されているすべてのリソースを再ダウンロードして改めてキャッシュし、マニフェストのコピーをフェッチすることによってこれを行う。</p>

  <p>これが起こっているように、ユーザーに適切な方法で通知できるように、イベントの数は、キャッシュの更新の状態へと更新されたスクリプトを保つために<code>ApplicationCache</code>オブジェクトで発火する。イベントは次のとおり：</p>

  <table><thead><tr><th>イベント名<th>インターフェイス<th>発火条件<th>次のイベント<tbody><tr><td><dfn id="event-appcache-checking"><code>checking</code></dfn><td><code id="appcacheevents:event"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>ユーザーエージェントは、更新をチェックする、または初回のマニフェストをダウンロードしようとしている。<strong>これは、常にシーケンスの最初のイベントである。</strong><td><code id="appcacheevents:event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code>、<code id="appcacheevents:event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code>、<code id="appcacheevents:event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code>、<code id="appcacheevents:event-appcache-error"><a href="#event-appcache-error">error</a></code><tr><td><dfn id="event-appcache-noupdate"><code>noupdate</code></dfn><td><code id="appcacheevents:event-2"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストは変更されなかった。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-downloading"><code>downloading</code></dfn><td><code id="appcacheevents:event-3"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>ユーザーエージェントは更新を発見し、それをフェッチしている、または初回のマニフェストで記載されたリソースをダウンロードしている。<td><code id="appcacheevents:event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>、<code id="appcacheevents:event-appcache-error-2"><a href="#event-appcache-error">error</a></code>、<code id="appcacheevents:event-appcache-cached"><a href="#event-appcache-cached">cached</a></code>、<code id="appcacheevents:event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code><tr><td><dfn id="event-appcache-progress"><code>progress</code></dfn><td><code id="appcacheevents:progressevent"><a data-x-internal="progressevent" href="https://triple-underscore.github.io/XHR-ja.html#interface-progressevent">ProgressEvent</a></code><td>ユーザーエージェントは、マニフェストで記載されたリソースをダウンロードしている。イベントオブジェクトの<code id="appcacheevents:dom-progressevent-total"><a data-x-internal="dom-progressevent-total" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total">total</a></code>属性は、ダウンロードされたファイルの合計数を返す。イベントオブジェクトの<code id="appcacheevents:dom-progressevent-loaded"><a data-x-internal="dom-progressevent-loaded" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded">loaded</a></code>属性は、これまでに処理されたファイルの数を返す。<td><code id="appcacheevents:event-appcache-progress-2"><a href="#event-appcache-progress">progress</a></code>、<code id="appcacheevents:event-appcache-error-3"><a href="#event-appcache-error">error</a></code>、<code id="appcacheevents:event-appcache-cached-2"><a href="#event-appcache-cached">cached</a></code>、<code id="appcacheevents:event-appcache-updateready-2"><a href="#event-appcache-updateready">updateready</a></code><tr><td><dfn id="event-appcache-cached"><code>cached</code></dfn><td><code id="appcacheevents:event-4"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストに記載されたリソースがダウンロードされ、アプリケーションがキャッシュされた。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-updateready"><code>updateready</code></dfn><td><code id="appcacheevents:event-5"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストに記載されたリソースは新しく再ダウンロードされており、スクリプトは新しいキャッシュに切り替えるために<code id="appcacheevents:dom-appcache-swapcache"><a href="#dom-appcache-swapcache">swapCache()</a></code>を使用できる。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-obsolete"><code>obsolete</code></dfn><td><code id="appcacheevents:event-6"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストは404または410ページになっていることが判明し、アプリケーションのキャッシュを削除している。<td>シーケンス内の最後のイベント。<tr><td rowspan="4"><dfn id="event-appcache-error"><code>error</code></dfn><td rowspan="4"><code id="appcacheevents:event-7"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストが404または410ページだったので、アプリケーションをキャッシュする試みが中止された。<td rowspan="3">シーケンス内の最後のイベント。<tr><td>マニフェストは変更されなかったが、マニフェストを参照するページが正しくダウンロードでなかった。<tr><td>マニフェストに記載されたリソースをフェッチするときに致命的なエラーが発生した。<tr><td>更新されている間にマニフェストが変更された。<td>ユーザーエージェントは、再び一時的にファイルをフェッチしようする。</table>

  <p>これらのイベントはキャンセル可能である。それらのデフォルトアクションは、ダウンロードの進捗情報を表示するためのユーザーエージェントに対するものである。ページが独自のアップデートのUIが表示する場合、イベントのキャンセルは、冗長な進捗情報の表示からユーザーエージェントを防ぐだろう。</p>



  



  <h4 id="manifests"><span class="secno">7.9.2</span> キャッシュマニフェスト構文<a href="#manifests" class="self-link"></a></h4>


  <h5 id="some-sample-manifests"><span class="secno">7.9.2.1</span> サンプルマニフェスト<a href="#some-sample-manifests" class="self-link"></a></h5>

  

  <div class="example"><p>This example manifest requires two images and a style sheet to be cached and safelists a CGI script.</p>

   <pre>CACHE MANIFEST
# the above line is required

# this is a comment
# there can be as many of these anywhere in the file
# they are all ignored
  # comments can have spaces before them
  # but must be alone on the line

# blank lines are ignored too

# these are files that need to be cached they can either be listed
# first, or a "CACHE:" header could be put before them, as is done
# lower down.
images/sound-icon.png
images/background.png
# note that each file has to be put on its own line

# here is a file for the online safelist -- it isn't cached, and
# references to this file will bypass the cache, always hitting the
# network (or trying to, if the user is offline).
NETWORK:
comm.cgi

# here is another set of files to cache, this time just the CSS file.
CACHE:
style/default.css</pre>

   <p>同様に次のように記述することができる：</p>

   <pre>CACHE MANIFEST
NETWORK:
comm.cgi
CACHE:
style/default.css
images/sound-icon.png
images/background.png</pre>

  </div>

  <div class="example"><p>オフラインアプリケーションキャッシュマニフェストは、絶対パスまたは絶対URLを使用することができる：</p>

   <pre>CACHE MANIFEST

/main/home
/main/app.js
/settings/home
/settings/app.js
https://img.example.com/logo.png
https://img.example.com/check.png
https://img.example.com/cross.png</pre>

  </div>

  <div class="example"><p>次のマニフェストは、ユーザーがオフラインの間にサイト上の任意のページに表示されている汎用のエラーページを定義する。これはまた、<span>オンラインセーフリストワイルドカードフラグ</span>が<i>open</i>であることを指定し、他のサイト上のリソースにアクセスがブロックされないことを意味する。（汎用フォールバック名前空間なので、同じサイト上のリソースがすでにブロックされない。）</p>

   <p>このマニフェスト上のすべてのページのように、同じページにヒットする後続はキャッシュからすぐに読み込まれるので、それらがフェッチされるようにローカルでキャッシュされるだろう。マニフェストが変更されるまで、これらのページは、再度サーバーからフェッチされることはない。マニフェストが変更されるとき、次にすべてのファイルが再ダウンロードされる。</p>

   <p>スタイルシートや画像などのようなサブリソースは、しかし、通常のHTTPキャッシングセマンティックスを使用してのみキャッシュされる。</p>

   <pre>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</pre>

  </div>



  <h5 id="writing-cache-manifests"><span class="secno">7.9.2.2</span> キャッシュマニフェストの記述<a href="#writing-cache-manifests" class="self-link"></a></h5>

  <p>Manifests must be served using the <code>text/cache-manifest</code> <a id="writing-cache-manifests:mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#mime-type" data-x-internal="mime-type">MIME type</a>. All resources served using the <code>text/cache-manifest</code> <a id="writing-cache-manifests:mime-type-2" href="https://triple-underscore.github.io/mimesniff-ja.html#mime-type" data-x-internal="mime-type">MIME type</a> must follow the syntax of application cache manifests, as described in this section.</p>

  <p>アプリケーションキャッシュマニフェストは、テキストがUTF-8を使用してエンコードされるテキストファイルである。アプリケーションキャッシュマニフェストでのデータは行ベースである。Newlines must be represented by U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, or U+000D CARRIAGE RETURN (CR) U+000A LINE FEED (LF) pairs. <a href="references.html#refsENCODING">[ENCODING]</a></p>

  <p class="note">これは、すべての<code>text/*</code>型が唯一のCRLF改行を許可する必要がある、RFC 2046の<a id="writing-cache-manifests:willful-violation" href="introduction.html#willful-violation">故意の違反</a>である。しかし、この要件は時代遅れである。CR、LFおよびCRLFの改行の使用は一般的に支持されており、実際に時にCRLFはテキストエディターでサポートされ<em>ない</em>。<a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>The first line of an application cache manifest must consist of the string "CACHE", a single U+0020 SPACE character, the string "MANIFEST", and either a U+0020 SPACE character, a U+0009 CHARACTER TABULATION (tab) character, a U+000A LINE FEED (LF) character, or a U+000D CARRIAGE RETURN (CR) character. The first line may optionally be preceded by a U+FEFF BYTE ORDER MARK (BOM) character. 他のテキストが最初の行にある場合、無視される。</p>

  <p>後続の行がもしあれば、すべて次のいずれかでなければならない：</p>

  <dl><dt>空白行<dd><p>Blank lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters only.</p>

   <dt>コメント<dd><p>Comment lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, followed by a single U+0023 NUMBER SIGN character (#), followed by zero or more characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.</p>

    <p class="note">Comments need to be on a line on their own. If they were to be included on a line with a URL, the "#" would be mistaken for part of a <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="writing-cache-manifests:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a>.</p>

   <dt>セクションヘッダー<dd><p>セクションヘッダーは、現在のセクションを変更する。可能な4つのセクションヘッダーが存在する：<dl><dt><code>CACHE:</code><dd><dfn id="concept-appcache-manifest-explicit">明示的なセクション</dfn>に切り替える。<dt><code>FALLBACK:</code><dd><dfn id="concept-appcache-manifest-fallback">代替セクション</dfn>に切り替える。<dt><code>NETWORK:</code><dd>Switches to the <dfn id="concept-appcache-manifest-network">online safelist section</dfn>.<dt><code>SETTINGS:</code><dd><dfn id="concept-appcache-manifest-settings">設定セクション</dfn>に切り替える。</dl>

    <p>Section header lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, followed by one of the names above (including the U+003A COLON character (:)) followed by zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>皮肉なことに、デフォルトでは、現在のセクションは、<a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit">明示的なセクション</a>である。</p>

   <dt>現在のセクションのデータ<dd><p>データ行が取得しなければならない形式は、現在のセクションに依存する。</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-2">explicit section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a id="writing-cache-manifests:valid-url-string" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback">fallback section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a id="writing-cache-manifests:valid-url-string-2" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, one or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, another <a id="writing-cache-manifests:valid-url-string-3" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network">online safelist section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, either a single U+002A ASTERISK character (*) or a <a id="writing-cache-manifests:valid-url-string-4" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings">settings section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a href="#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting">setting</a>, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>現在のところ1つの<dfn id="concept-appcache-manifest-setting">設定</dfn>のみが定義される：</p>

    <dl><dt>キャッシュモード設定<dd>これは、文字列"<code>prefer-online</code>"で構成される。この文字列は、<span>キャッシュモード</span>を<span>優先オンライン</span>に設定する。（<span>キャッシュモード</span>はデフォルトで<span>高速</span>になる。）</dl>

    <p><a href="#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings-2">設定セクション</a>内で、各<a href="#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting-2">設定</a>は1回以上出現してはならない。</p>


  </dl>

  <p>マニフェストは、複数回のセクションを含んでもよい。セクションは空であってもよい。</p>

  <p><span>フォールバック名前空間</span>自体に関連付けられたフォールバックページであるURL、およびそれらの名前空間は、データ行の最初のURLである名前空間、および2番目のURLであるフォールバックページ対応する、<a href="#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback-2">フォールバックセクション</a>で指定されなければならない。キャッシュされる他のすべてのページは、<a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-3">明示的なセクション</a>に記載されなければならない。</p>

  <p><span>フォールバック名前空間</span>および<span>フォールバックエントリー</span>は、マニフェスト自身と<span>同じ生成元</span>を持たなければならない。<span>Fallback namespaces</span> must also be in the same path as the manifest's URL.</p>

  <p><span>フォールバック名前空間</span>は、複数回記載されてはならない。</p>

  <p>ユーザーエージェントが<span>オンラインセーフリスト</span>に入れる名前空間は、すべて<a href="#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network-2">オンラインセーフリストセクション</a>で指定されなければならない。(This is needed for any URL that the page is intending to use to communicate back to the server.) To specify that all URLs are automatically safelisted in this way, a U+002A ASTERISK character (*) may be specified as one of the URLs.</p>

  <p>Authors should not include namespaces in the <span>online safelist</span> for which another namespace in the <span>online safelist</span> is a <a id="writing-cache-manifests:prefix-match" href="infrastructure.html#prefix-match">prefix match</a>.</p>

  <p><a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-relative" id="writing-cache-manifests:relative-url" data-x-internal="relative-url">相対URL</a>はマニフェスト自身のURLを基準に指定されなければならない。マニフェスト内のすべてのURLは、（明示的または暗黙的に、<a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-relative" id="writing-cache-manifests:relative-url-2" data-x-internal="relative-url">相対URL</a>を使用して）マニフェスト自身と同じ<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="writing-cache-manifests:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a>を持たなければならない。<a href="references.html#refsURL">[URL]</a></p>

  <p>URLs in manifests must not have <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="writing-cache-manifests:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragments</a> (i.e. the U+0023 NUMBER SIGN character isn't allowed in URLs in manifests).</p>

  <p><span>Fallback namespaces</span> and namespaces in the <span>online safelist</span> are matched by <a id="writing-cache-manifests:prefix-match-2" href="infrastructure.html#prefix-match">prefix match</a>.</p>


  


  


  



  <h4 id="security-concerns-with-offline-applications-caches"><span class="secno">7.9.3</span> Security concerns with offline applications caches<a href="#security-concerns-with-offline-applications-caches" class="self-link"></a></h4>

  

  <p>The main risk introduced by offline application caches is that an injection attack can be elevated into persistent site-wide page replacement. This attack involves using an injection vulnerability to upload two files to the victim site. The first file is an application cache manifest consisting of just a fallback entry pointing to the second file, which is an HTML page whose manifest is declared as that first file. Once the user has been directed to that second file, all subsequent accesses to any file covered by the given fallback namespace while either the user or the site is offline will instead show that second file. Targeted denial-of-service attacks or cookie bombing attacks (where the client is made to send so many cookies that the server refuses to process the request) can be used to ensure that the site appears offline.</p>

  <p>To mitigate this, manifests can only specify fallbacks that are in the same path as the manifest itself. This means that a content injection upload vulnerability in a particular directory on a server can only be escalated to a take-over of that directory and its subdirectories. If there is no way to inject a file into the root directory, the entire site cannot be taken over.</p>

  <p>If a site has been attacked in this way, simply removing the offending manifest might eventually clear the problem, since the next time the manifest is updated, a 404 error will be seen, and the user agent will clear the cache. "Eventually" is the key word here, however; while the attack on the user or server is ongoing, such that connections from an affected user to the affected site are blocked, the user agent will simply assume that the user is offline and will continue to use the hostile manifest. Unfortunately, if a cookie bombing attack has also been used, merely removing the manifest is insufficient; in addition, the server has to be configured to return a 404 or 410 response instead of the 413 "Request Entity Too Large" response.</p>

  <p>TLS does not inherently protect a site from this attack, since the attack relies on content being served from the server itself. Not using application caches also does not prevent this attack, since the attack relies on an attacker-provided manifest.</p>



  <h4 id="application-cache-api"><span class="secno">7.9.4</span> アプリケーションキャッシュAPI<a href="#application-cache-api" class="self-link"></a></h4>

  

  <dl class="domintro"><dt><var>cache</var> = <var>window</var> . <code id="dom-applicationcache">applicationCache</code><dd><p>Returns the <code>ApplicationCache</code> object that applies to the <a id="application-cache-api:active-document" href="browsers.html#active-document">active document</a> of that <code>Window</code>.</p>
   <dt><var>cache</var> . <code id="dom-appcache-status">status</code><dd><p>以下に定義された定数で与えられるように、アプリケーションキャッシュの現在のステータスを返す。</p>
   <dt><var>cache</var> . <code id="dom-appcache-update">update</code>()<dd><p><span>アプリケーションキャッシュのダウンロードプロセス</span>を起動する。</p>

    <p>Throws an <a id="application-cache-api:invalidstateerror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if there is no application cache to update.</p>

    <p>ユーザーエージェントは通常、自動的に<span>アプリケーションキャッシュ</span>を更新する処理をするので、通常このメソッドを呼び出す必要はない。</p>

    <p>このメソッドは、長期のアプリケーションのような状況で役立つ。For example, a web mail application might stay open in a browser tab for weeks at a time. このようなアプリケーションは、毎日更新をテストできるだろう。</p>
   <dt><var>cache</var> . <code id="dom-appcache-abort">abort</code>()<dd><p><span>アプリケーションキャッシュのダウンロード処理</span>を中止する。</p>

    <p>This method is intended to be used by web application showing their own caching progress UI, in case the user wants to stop the update (e.g. because bandwidth is limited).</p>
   <dt><var>cache</var> . <code id="dom-appcache-swapcache">swapCache</code>()<dd><p>新しいものが存在する場合、最新のアプリケーションキャッシュに切り替わる。If there isn't, throws an <a id="application-cache-api:invalidstateerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.</p>

    <p>これは、以前にロードされたリソースが再読み込みされることはない。たとえば、画像が急にリロードされないと、スタイルシートやスクリプトが再解析または再評価されない。唯一の変更点は、キャッシュされたリソースに対する後続の要求が新しいコピーを取得することである。</p>

    <p>このメソッドが呼び出される前に<code id="application-cache-api:event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>イベントが発火する。Once it fires, the web application can, at its leisure, call this method to switch the underlying cache to the one with the more recent updates. これを適切に使うためには、アプリケーションは動作に新しい機能をもたらすことができるようにする必要がある。たとえば、新しい機能を有効にするためにスクリプトをリロードするなど。</p>

    <p><code id="application-cache-api:dom-appcache-swapcache"><a href="#dom-appcache-swapcache">swapCache()</a></code>の代替は、<code id="application-cache-api:dom-location-reload"><a href="history.html#dom-location-reload">location.reload()</a></code>を使用して、ユーザーに適した時点で単にページ全体をリロードすることである。</p>
   </dl>

  

  <dl><dt><dfn id="dom-appcache-uncached"><code>UNCACHED</code></dfn>（数値0）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is not associated with an <span>application cache</span> at this time.<dt><dfn id="dom-appcache-idle"><code>IDLE</code></dfn>（数値1）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is associated with an <span>application cache</span> whose <span>application cache group</span>'s <span>update status</span> is <i>idle</i>, and that <span>application cache</span> is the <span>newest</span> cache in its <span>application cache group</span>, and the <span>application cache group</span> is not marked as <span>obsolete</span>.<dt><dfn id="dom-appcache-checking"><code>CHECKING</code></dfn>（数値2）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is associated with an <span>application cache</span> whose <span>application cache group</span>'s <span>update status</span> is <i>checking</i>.<dt><dfn id="dom-appcache-downloading"><code>DOWNLOADING</code></dfn>（数値3）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is associated with an <span>application cache</span> whose <span>application cache group</span>'s <span>update status</span> is <i>downloading</i>.<dt><dfn id="dom-appcache-updateready"><code>UPDATEREADY</code></dfn>（数値4）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is associated with an <span>application cache</span> whose <span>application cache group</span>'s <span>update status</span> is <i>idle</i>, and whose <span>application cache group</span> is not marked as <span>obsolete</span>, but that <span>application cache</span> is <em>not</em> the <span>newest</span> cache in its group.<dt><dfn id="dom-appcache-obsolete"><code>OBSOLETE</code></dfn>（数値5）<dd><p>The <code>ApplicationCache</code> object's <span>cache host</span> is associated with an <span>application cache</span> whose <span>application cache group</span> is marked as <span>obsolete</span>.</dl>

  


  <h4 id="navigator.online"><span class="secno">7.9.5</span> <span id="browser-state">ブラウザーの状態</span><a href="#navigator.online" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine" title="The NavigatorOnLine interface contains methods and properties related to the connectivity status of the browser.">NavigatorOnLine</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>3+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=online-status" title="Online/offline status">caniuse.com table</a></span></span></div></div></div>

  

  <dl class="domintro"><dt><var>self</var> . <code>navigator</code> . <code id="dom-navigator-online">onLine</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine" title="Returns the online status of the browser. The property returns a boolean value, with true meaning online and false meaning offline. The property sends updates whenever the browser's ability to connect to the network changes. The update occurs when the user follows links or when a script requests a remote page. For example, the property should return false when users click links soon after they lose internet connection.">NavigatorOnLine/onLine</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>3+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><dd><p>ユーザーエージェントが正確にオフラインである（ネットワークから切断されている）場合にfalseを返すユーザーエージェントがオンラインかもしれない場合にtrueを返す。</p>

    <p>この属性値が変更される場合、イベント<code id="navigator.online:event-online"><a href="indices.html#event-online">online</a></code>および<code id="navigator.online:event-offline"><a href="indices.html#event-offline">offline</a></code>が発火する。</p>
   </dl>

  

  <p class="note">この属性は、本質的に信頼できない。コンピューターは、インターネット接続がなくてもネットワークに接続できる。</p>

  <div class="example"><p>この例において、ブラウザーがオンラインおよびオフラインになるように、インジケーターが更新される。</p>

   <pre><code class='html'><c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Online status<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-><c- p>></c->
   <c- a>function</c-> updateIndicator<c- p>()</c-> <c- p>{</c->
     document<c- p>.</c->getElementById<c- p>(</c-><c- t>'indicator'</c-><c- p>).</c->textContent <c- o>=</c-> navigator<c- p>.</c->onLine <c- o>?</c-> <c- t>'online'</c-> <c- o>:</c-> <c- t>'offline'</c-><c- p>;</c->
   <c- p>}</c->
  <c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-> <c- e>onload</c-><c- o>=</c-><c- s>"updateIndicator()"</c-> <c- e>ononline</c-><c- o>=</c-><c- s>"updateIndicator()"</c-> <c- e>onoffline</c-><c- o>=</c-><c- s>"updateIndicator()"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The network is: <c- p>&lt;</c-><c- f>span</c-> <c- e>id</c-><c- o>=</c-><c- s>"indicator"</c-><c- p>></c->(state unknown)<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c-></code></pre>

  </div>




  <nav><a href="browsing-the-web.html">← 7.8 ウェブを閲覧する</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav>
