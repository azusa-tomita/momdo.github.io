<!DOCTYPE html><html class=split lang=ja>
<script src=/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport>
<title>HTML Standard 日本語訳</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/spec.css><link rel=stylesheet href=https://resources.whatwg.org/standard.css><link rel=stylesheet href=https://resources.whatwg.org/standard-shared-with-dev.css><link href=https://resources.whatwg.org/logo.svg rel=icon>
<script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script>
<style>
   .bad, .bad *:not(.X\58X) { color: gray; }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   .parse-error-table td > p:first-child { margin-top: 0; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style>
<body>
  
  <script src=/html-dfn.js async=""></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new async="" src=https://resources.whatwg.org/file-issue.js></script>
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>22 February 2019</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href=canvas.html>← 4.12.5 canvas要素</a> – <a href=./>目次</a> – <a href=semantics-other.html>4.14 専用要素なしの一般的語彙 →</a></nav><ol class=toc><li id=toc-semantics><ol><li><a href=custom-elements.html#custom-elements><span class=secno>4.13</span> カスタム要素</a><ol><li><a href=custom-elements.html#custom-elements-intro><span class=secno>4.13.1</span> 導入</a><ol><li><a href=custom-elements.html#custom-elements-autonomous-example><span class=secno>4.13.1.1</span> 自律カスタム要素の作成</a></li><li><a href=custom-elements.html#custom-elements-customized-builtin-example><span class=secno>4.13.1.2</span> カスタマイズされた組み込み要素の作成</a></li><li><a href=custom-elements.html#custom-elements-autonomous-drawbacks><span class=secno>4.13.1.3</span> 自律カスタム要素の欠点</a></li><li><a href=custom-elements.html#custom-elements-upgrades-examples><span class=secno>4.13.1.4</span> Upgrading elements after their creation</a></li></ol></li><li><a href=custom-elements.html#custom-element-conformance><span class=secno>4.13.2</span> Requirements for custom element constructors and
  reactions</a></li><li><a href=custom-elements.html#custom-elements-core-concepts><span class=secno>4.13.3</span> Core concepts</a></li><li><a href=custom-elements.html#custom-elements-api><span class=secno>4.13.4</span> The <code>CustomElementRegistry</code> interface</a></li><li><a href=custom-elements.html#upgrades><span class=secno>4.13.5</span> Upgrades</a></li><li><a href=custom-elements.html#custom-element-reactions><span class=secno>4.13.6</span> Custom element reactions</a></li></ol></li></ol></li></ol><h3 id=custom-elements><span class=secno>4.13</span> カスタム要素<a href=#custom-elements class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> custom-elementsv1<span class="and_chr yes"><span>Chrome for Android</span> <span>71+</span></span><span class="chrome yes"><span>Chrome</span> <span>67+</span></span><span class="ios_saf partial"><span>iOS Safari (limited)</span> <span>10.3+</span></span><span class="firefox yes"><span>Firefox</span> <span>63+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11.8+</span></span><span class="ie no"><span>IE</span> <span>None</span></span><span class="safari partial"><span>Safari (limited)</span> <span>10.1+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="opera partial"><span>Opera (limited)</span> <span>41+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>6.2+</span></span><span class="android yes"><span>Android Browser</span> <span>67+</span></span><p class=caniuse>Source: <a href="https://caniuse.com/#feat=custom-elementsv1">caniuse.com</a></div>

  <h4 id=custom-elements-intro><span class=secno>4.13.1</span> 導入<a href=#custom-elements-intro class=self-link></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p><a href=#custom-element id=custom-elements-intro:custom-element>カスタム要素</a>は、著者に完全に機能するDOM要素を独自に構築する方法を提供する。スクリプティングなどで事後に追加されたアプリケーション固有の動作とともに、著者は文書内で非標準要素を常に使用することができたが、そのような要素は歴史的に不適合であり、あまり機能しなかった。カスタム要素を<a href=#element-definition id=custom-elements-intro:element-definition>定義する</a>ことで、著者はパーサーに要素を正しく構成する方法と、そのクラスの要素が変更にどのように反応するかを通知できる。</p>

  <p>カスタム要素は、（カスタム要素の定義のような）低レベルの著者公開拡張ポイントに関して、（HTMLの要素のような）既存のプラットフォーム機能を説明することによって、"プラットフォームを合理化する"ための大きな努力の一部である。今日、HTMLの既存要素の振る舞いを完全に説明することを妨げるカスタム要素（機能的および意味的な要素）の機能には多くの制限があるが、我々は時間の経過とともにこのギャップを縮小したいと思う。</p>

  <h5 id=custom-elements-autonomous-example><span class=secno>4.13.1.1</span> 自律カスタム要素の作成<a href=#custom-elements-autonomous-example class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href=#autonomous-custom-element id=custom-elements-autonomous-example:autonomous-custom-element>自律カスタム要素</a>を作成する方法を説明するために、国旗の小さなアイコンのレンダリングをカプセル化するカスタム要素を定義してみよう。私たちの目標は、次のように使用できるようにすることである：</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>flag-icon</c-> <c- e>country</c-><c- o>=</c-><c- s>"nl"</c-><c- p>&gt;&lt;/</c-><c- f>flag-icon</c-><c- p>&gt;</c-></code></pre>

  <p>これを行うには、まずカスタム要素のクラスを宣言し、<code id=custom-elements-autonomous-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>を拡張する：</p>

  <pre><code class='js'><c- kr>class</c-> FlagIcon <c- kr>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- kr>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
  <c- p>}</c->

  <c- kr>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- u>"country"</c-><c- p>];</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "country" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> newValue<c- p>;</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->

  get country<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->_countryCode<c- p>;</c->
  <c- p>}</c->
  set country<c- p>(</c->v<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"country"</c-><c- p>,</c-> v<c- p>);</c->
  <c- p>}</c->

  _updateRendering<c- p>()</c-> <c- p>{</c->
    <c- c1>// Left as an exercise for the reader. But, you'll probably want to</c->
    <c- c1>// check this.ownerDocument.defaultView to see if we've been</c->
    <c- c1>// inserted into a document with a browsing context, and avoid</c->
    <c- c1>// doing any work if not.</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>次に、要素を定義するために次のクラスを使用して必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"flag-icon"</c-><c- p>,</c-> FlagIcon<c- p>);</c-></code></pre>

  <p>この時点で、上記のコードは動作する。<code>flag-icon</code>タグを見るたびに、パーサーは<code>FlagIcon</code>クラスの新しいインスタンスを作成し、要素の内部状態を設定し、レンダリングを更新するために使用する（適切な場合）、新しい<code>country</code>属性についてコードに伝える。</p>

  <p>DOM APIを使用して<code>flag-icon</code>要素を作成することもできる：</p>

  <pre><code class='js'><c- kr>const</c-> flagIcon <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"flag-icon"</c-><c- p>)</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <p>最後に、<a href=#custom-element-constructor id=custom-elements-autonomous-example:custom-element-constructor>カスタム要素コンストラクタ</a>自体を使用することもできる。つまり、上記のコードは次のコードと同じである：</p>

  <pre><code class='js'><c- kr>const</c-> flagIcon <c- o>=</c-> <c- k>new</c-> FlagIcon<c- p>()</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <h5 id=custom-elements-customized-builtin-example><span class=secno>4.13.1.2</span> カスタマイズされた組み込み要素の作成<a href=#custom-elements-customized-builtin-example class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element>カスタマイズされた組み込み要素</a>は、<a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element>自律カスタム要素</a>とはわずかに異なる定義があり、そして大きく異なる使われ方をする、独自の種類の<a href=#custom-element id=custom-elements-customized-builtin-example:custom-element>カスタム要素</a>である。この要素は、新しいカスタム機能でHTMLの既存要素を拡張することで、HTMLの既存要素由来の動作の再利用を可能にするために存在する。残念なことに、HTML要素の既存の動作の多くが<a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-2>自律カスタム要素</a>を純粋に使用して複製できないため、これは重要である。代わりに、<a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-2>カスタマイズされた組み込み要素</a>は、既存の要素にカスタム構築動作、ライフサイクルフック、およびプロトタイプチェーンをインストールを可能にし、既存の要素の上にこれらの機能を本質的に"混在"させる。</p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-3>カスタマイズされた組み込み要素</a>は、ユーザーエージェントや他のソフトウェアが要素のセマンティクスおよび動作を識別するために要素のローカル名として扱うので、<a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-3>自律カスタム要素</a>とは異なる構文を必要とする。つまり、既存の動作の上に構築する<a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-4>カスタマイズされた組み込み要素</a>の概念は、元のローカル名を保持する拡張要素に決定的に依存する。</p>

  <p>この例において、<code>plastic-button</code>という<a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-5>カスタマイズされた組み込み要素</a>を作成する。これは通常のボタンのように動作するが、クリックするたびにファンシーなアニメーション効果が追加される。今回は<code id=custom-elements-customized-builtin-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>の代わりに<code id=custom-elements-customized-builtin-example:htmlbuttonelement><a href=form-elements.html#htmlbuttonelement>HTMLButtonElement</a></code>を拡張するが、前と同じようにクラスを定義することから始める：</p>

  <pre><code class='js'><c- kr>class</c-> PlasticButton <c- kr>extends</c-> HTMLButtonElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- kr>super</c-><c- p>();</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>()</c-> <c- p>=&gt;</c-> <c- p>{</c->
      <c- c1>// Draw some fancy animation effects!</c->
    <c- p>});</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>カスタム要素を定義する場合、<code>extends</code>オプションも指定する必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"plastic-button"</c-><c- p>,</c-> PlasticButton<c- p>,</c-> <c- p>{</c-> <c- kr>extends</c-><c- o>:</c-> <c- u>"button"</c-> <c- p>});</c-></code></pre>

  <p>一般に、拡張されている要素の名前は、同じインターフェイスを共有する要素（<code id=custom-elements-customized-builtin-example:htmlquoteelement><a href=grouping-content.html#htmlquoteelement>HTMLQuoteElement</a></code>を共有する<code id=custom-elements-customized-builtin-example:the-q-element><a href=text-level-semantics.html#the-q-element>q</a></code>と<code id=custom-elements-customized-builtin-example:the-blockquote-element><a href=grouping-content.html#the-blockquote-element>blockquote</a></code>の両者など）を共有するため、拡張する要素インターフェイスを単に調べるだけでは判断することができない。</p>

  <p>To construct our <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-6>customized built-in element</a> from parsed HTML source text, we use
  the <code id=custom-elements-customized-builtin-example:attr-is><a href=#attr-is>is</a></code> attribute on a <code id=custom-elements-customized-builtin-example:the-button-element><a href=form-elements.html#the-button-element>button</a></code> element:</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>is</c-><c- o>=</c-><c- s>"plastic-button"</c-><c- p>&gt;</c->Click Me!<c- p>&lt;/</c-><c- f>button</c-><c- p>&gt;</c-></code></pre>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-7>カスタマイズされた組み込み要素</a>を<a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-4>自律カスタム要素</a>として使用しようとするとうまく<em>いかない</em>。つまり、<code>&lt;plastic-button&gt;Click me?&lt;/plastic-button&gt;</code>は特別な動作をしない<code id=custom-elements-customized-builtin-example:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code>を作成するだけである。</p>

  <p>If you need to create a customized built-in element programmatically, you can use the following
  form of <code id=custom-elements-customized-builtin-example:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement()</a></code>:</p>

  <pre><code class='js'><c- kr>const</c-> plasticButton <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"button"</c-><c- p>,</c-> <c- p>{</c-> is<c- o>:</c-> <c- u>"plastic-button"</c-> <c- p>});</c->
plasticButton<c- p>.</c->textContent <c- o>=</c-> <c- u>"Click me!"</c-><c- p>;</c-></code></pre>

  <p>前と同じように、コンストラクタも動作する：</p>

  <pre><code class='js'><c- kr>const</c-> plasticButton2 <c- o>=</c-> <c- k>new</c-> PlasticButton<c- p>();</c->
console<c- p>.</c->log<c- p>(</c->plasticButton2<c- p>.</c->localName<c- p>);</c->  <c- c1>// will output "button"</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> PlasticButton<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> HTMLButtonElement<c- p>);</c-></code></pre>

  <p>Note that when creating a customized built-in element programmatically, the <code id=custom-elements-customized-builtin-example:attr-is-2><a href=#attr-is>is</a></code> attribute will not be present in the DOM, since it was not explicitly
  set. However, <a href=parsing.html#attr-is-during-serialization>it will be added to the output when
  serializing</a>:</p>

  <pre><code class='js'>console<c- p>.</c->assert<c- p>(</c-><c- o>!</c->plasticButton<c- p>.</c->hasAttribute<c- p>(</c-><c- u>"is"</c-><c- p>));</c->
console<c- p>.</c->log<c- p>(</c->plasticButton<c- p>.</c->outerHTML<c- p>);</c-> <c- c1>// will output '&lt;button is="plastic-button"&gt;&lt;/button&gt;'</c-></code></pre>

  <p>Regardless of how it is created, all the of the ways in which <code id=custom-elements-customized-builtin-example:the-button-element-2><a href=form-elements.html#the-button-element>button</a></code> is special
  apply to such "plastic buttons" as well: their focus behavior, ability to participate in <a href=form-control-infrastructure.html#concept-form-submit id=custom-elements-customized-builtin-example:concept-form-submit>form submission</a>, the <code id=custom-elements-customized-builtin-example:attr-fe-disabled><a href=form-control-infrastructure.html#attr-fe-disabled>disabled</a></code> attribute, and so on.</p>

  <p id=customized-built-in-element-restrictions><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-8>カスタマイズされた組み込み要素</a>は、有用なユーザーエージェントが提供する動作またはAPIを持つ既存のHTML要素を拡張を可能にするように設計されている。そのため、この仕様で定義される既存のHTML要素のみを拡張することができ、<a id=custom-elements-customized-builtin-example:element-interface href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface data-x-internal=element-interface>要素インターフェイス</a>として<code id=custom-elements-customized-builtin-example:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code>を使用するように定義された<code id=custom-elements-customized-builtin-example:bgsound><a href=obsolete.html#bgsound>bgsound</a></code>、<code id=custom-elements-customized-builtin-example:blink><a href=obsolete.html#blink>blink</a></code>、<code id=custom-elements-customized-builtin-example:isindex><a href=obsolete.html#isindex>isindex</a></code>、<code id=custom-elements-customized-builtin-example:keygen><a href=obsolete.html#keygen>keygen</a></code>、<code id=custom-elements-customized-builtin-example:multicol><a href=obsolete.html#multicol>multicol</a></code>、<code id=custom-elements-customized-builtin-example:nextid><a href=obsolete.html#nextid>nextid</a></code>、または<code id=custom-elements-customized-builtin-example:spacer><a href=obsolete.html#spacer>spacer</a></code>などのレガシー要素は拡張できない。</p>

  <p>この要件の1つの理由は将来の互換性である。もし<a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-9>カスタマイズされた組み込み要素</a>が、たとえば<code>combobox</code>のような、現在不明の要素を拡張したものが定義されたなら、派生した<a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-10>カスタマイズされた組み込み要素</a>のコンシューマーが、ユーザーエージェント提供の動作に興味を持たない基本要素に依存するようになるため、これはこの仕様が将来<code>combobox</code>要素を定義することを妨げるかもしれない。</p>

  <h5 id=custom-elements-autonomous-drawbacks><span class=secno>4.13.1.3</span> 自律カスタム要素の欠点<a href=#custom-elements-autonomous-drawbacks class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>以下で規定されているように、そして上記で触れたように、単に<code>taco-button</code>という要素を定義して使用しても、そのような要素がボタンを<a href=dom.html#represents id=custom-elements-autonomous-drawbacks:represents>表す</a>ことを意味しない。つまり、ウェブブラウザー、検索エンジン、アクセシビリティ技術などのツールは、定義された名前だけに基づいて、結果の要素をボタンとして自動的に処理しない。</p>

  <p><a href=#autonomous-custom-element id=custom-elements-autonomous-drawbacks:autonomous-custom-element>自律カスタム要素</a>を依然として使用する一方で、様々なユーザーに所望のボタンセマンティクスを伝えるためためには、複数の技術を用いる必要がある：</p>

  <ul><li><p><code id=custom-elements-autonomous-drawbacks:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code>属性の追加は、<code>taco-button</code>を<a id=custom-elements-autonomous-drawbacks:interactive-content-2 href=dom.html#interactive-content-2>インタラクティブコンテンツ</a>にし、<a href=interaction.html#focusable-area id=custom-elements-autonomous-drawbacks:focusable-area>フォーカス可能</a>にする。もし<code>taco-button</code>を論理的に無効にするならば、<code id=custom-elements-autonomous-drawbacks:attr-tabindex-2><a href=interaction.html#attr-tabindex>tabindex</a></code>属性を削除する必要があるだろうことに注意すること。</li><li><p>多様なARIA属性の追加は、セマンティクスをアクセシビリティ技術に伝えるのに役立つ。たとえば、<code id=custom-elements-autonomous-drawbacks:attr-aria-role><a href=infrastructure.html#attr-aria-role>role</a></code>属性を"<code id=custom-elements-autonomous-drawbacks:attr-aria-role-button><a data-x-internal=attr-aria-role-button href=http://momdo.github.io/wai-aria-1.1/#button>button</a></code>"に設定すると、これはボタンであるというセマンティクスを伝えるため、ユーザーはアクセシビリティ技術で通常のボタンのようなやり取りを使用してコントロールと正常にやりとりすることができる。アクセシビリティ技術が子テキストノードを横断して通知する代わりに、<code id=custom-elements-autonomous-drawbacks:attr-aria-label><a data-x-internal=attr-aria-label href=http://momdo.github.io/wai-aria-1.1/#aria-label>aria-label</a></code>属性を設定することで、ボタンに<a href=http://momdo.github.io/wai-aria-1.1/#dfn-accessible-name id=custom-elements-autonomous-drawbacks:concept-accessible-name data-x-internal=concept-accessible-name>アクセシブルな名前</a>を付ける必要がある。それからボタンが論理的に無効にであるときに<code id=custom-elements-autonomous-drawbacks:attr-aria-disabled><a data-x-internal=attr-aria-disabled href=http://momdo.github.io/wai-aria-1.1/#aria-disabled>aria-disabled</a></code>を"<code>true</code>"に設定すると、アクセシビリティ技術にボタンの無効状態が伝わる。</li><li><p>通常予想されるボタンの動作を処理するイベントハンドラーを追加することにより、ボタンのセマンティクスをウェブブラウザユーザーに伝えることを手伝う。この場合、最も関連性の高いイベントハンドラーは、適切な<code id=custom-elements-autonomous-drawbacks:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code>イベントを<code id=custom-elements-autonomous-drawbacks:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code>イベントとしてプロキシするものであるので、キーボードとクリックの両方でボタンをアクティブにすることができる。</li><li><p>In addition to any default visual styling provided for <code>taco-button</code>
   elements, the visual styling will also need to be updated to reflect changes in logical state,
   such as becoming disabled; that is, whatever style sheet has rules for <code>taco-button</code> will also need to have rules for <code>taco-button[disabled]</code>.</li></ul>

  <p>これらの点を念頭に置いて、（無効にする機能を含む）ボタンのセマンティクスを伝える責任を負ったフル機能の<code>taco-button</code>は、次のようになる：</p>

  <pre><code class='js'><c- kr>class</c-> TacoButton <c- kr>extends</c-> HTMLElement <c- p>{</c->
  <c- kr>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- u>"disabled"</c-><c- p>];</c-> <c- p>}</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- kr>super</c-><c- p>();</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"keydown"</c-><c- p>,</c-> e <c- p>=&gt;</c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c->e<c- p>.</c->keyCode <c- o>===</c-> <c- mi>32</c-> <c- o>||</c-> e<c- p>.</c->keyCode <c- o>===</c-> <c- mi>13</c-><c- p>)</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->dispatchEvent<c- p>(</c-><c- k>new</c-> MouseEvent<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>{</c->
          bubbles<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
          cancelable<c- o>:</c-> <c- kc>true</c->
        <c- p>}));</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> e <c- p>=&gt;</c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
        e<c- p>.</c->preventDefault<c- p>();</c->
        e<c- p>.</c->stopPropagation<c- p>();</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->_observer <c- o>=</c-> <c- k>new</c-> MutationObserver<c- p>(()</c-> <c- p>=&gt;</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"aria-label"</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->textContent<c- p>);</c->
    <c- p>});</c->
  <c- p>}</c->

  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"role"</c-><c- p>,</c-> <c- u>"button"</c-><c- p>);</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->

    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->observe<c- p>(</c-><c- k>this</c-><c- p>,</c-> <c- p>{</c->
      childList<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      characterData<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      subtree<c- o>:</c-> <c- kc>true</c->
    <c- p>});</c->
  <c- p>}</c->

  disconnectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->disconnect<c- p>();</c->
  <c- p>}</c->

  get disabled<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->hasAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>);</c->
  <c- p>}</c->

  set disabled<c- p>(</c->v<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->v<c- p>)</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>,</c-> <c- u>""</c-><c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->removeAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->

  attributeChangedCallback<c- p>()</c-> <c- p>{</c->
    <c- c1>// only is called for the disabled attribute due to observedAttributes</c->
    <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->removeAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"aria-disabled"</c-><c- p>,</c-> <c- u>"true"</c-><c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"aria-disabled"</c-><c- p>,</c-> <c- u>"false"</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>このようにかなり複雑な要素定義があっても、その要素はコンシューマーのために使用する喜びとはならない。自身の意志の<code id=custom-elements-autonomous-drawbacks:attr-tabindex-3><a href=interaction.html#attr-tabindex>tabindex</a></code>や<code id=custom-elements-autonomous-drawbacks:attr-aria-*><a href=infrastructure.html#attr-aria-*>aria-*</a></code>属性を継続的に"発芽"させる。これは、現在のところ、（通常はコンシューマーがデフォルトの動作を上書きできるように予約されているにもかかわらず）これらの属性を強制的に使用する必要があり、カスタム要素に対するデフォルトのアクセシビリティセマンティクスやフォーカス動作を指定する方法が存在しないためである。</p>

  <p>対照的に、前節で示したように、単一の<a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element>カスタマイズされた組み込み要素</a>は、<code id=custom-elements-autonomous-drawbacks:the-button-element><a href=form-elements.html#the-button-element>button</a></code>要素のセマンティクスと動作を自動的に継承する。これらの動作を手動で実装する必要はない。一般に、HTMLの既存要素の上に構築される重要な動作やセマンティクスを持つ要素については、<a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element-2>カスタマイズされた組み込み要素</a>の開発、保守、および消費が容易になる。</p>

  <h5 id=custom-elements-upgrades-examples><span class=secno>4.13.1.4</span> Upgrading elements after their creation<a href=#custom-elements-upgrades-examples class=self-link></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>Because <a href=#element-definition id=custom-elements-upgrades-examples:element-definition>element definition</a> can occur at any time, a non-custom element could be
  <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-elements-upgrades-examples:create-an-element data-x-internal=create-an-element>created</a>, and then later become a <a href=#custom-element id=custom-elements-upgrades-examples:custom-element>custom
  element</a> after an appropriate <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition>definition</a> is
  registered. We call this process "upgrading" the element, from a normal element into a custom
  element.</p>

  <p><a href=#upgrades id=custom-elements-upgrades-examples:upgrades>Upgrades</a> enable scenarios where it may be
  preferable for <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition-2>custom element definitions</a> to be
  registered after relevant elements have been initially created, such as by the parser. They allow
  progressive enhancement of the content in the custom element. For example, in the following HTML
  document the element definition for <code>img-viewer</code> is loaded
  asynchronously:</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html&gt;</c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>&gt;</c->
<c- p>&lt;</c-><c- f>title</c-><c- p>&gt;</c->Image viewer example<c- p>&lt;/</c-><c- f>title</c-><c- p>&gt;</c->

<c- p>&lt;</c-><c- f>img-viewer</c-> <c- e>filter</c-><c- o>=</c-><c- s>"Kelvin"</c-><c- p>&gt;</c->
  <c- p>&lt;</c-><c- f>img</c-> <c- e>src</c-><c- o>=</c-><c- s>"images/tree.jpg"</c-> <c- e>alt</c-><c- o>=</c-><c- s>"A beautiful tree towering over an empty savannah"</c-><c- p>&gt;</c->
<c- p>&lt;/</c-><c- f>img-viewer</c-><c- p>&gt;</c->

<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"js/elements/img-viewer.js"</c-> <c- e>async</c-><c- p>&gt;&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>

  <p>The definition for the <code>img-viewer</code> element here is loaded using a
  <code id=custom-elements-upgrades-examples:the-script-element><a href=scripting.html#the-script-element>script</a></code> element marked with the <code id=custom-elements-upgrades-examples:attr-script-async><a href=scripting.html#attr-script-async>async</a></code>
  attribute, placed after the <code>&lt;img-viewer&gt;</code> tag in the markup. While the
  script is loading, the <code>img-viewer</code> element will be treated as an undefined
  element, similar to a <code id=custom-elements-upgrades-examples:the-span-element><a href=text-level-semantics.html#the-span-element>span</a></code>. Once the script loads, it will define the <code>img-viewer</code> element, and the existing <code>img-viewer</code> element on
  the page will be upgraded, applying the custom element's definition (which presumably includes
  applying an image filter identified by the string "Kelvin", enhancing the image's visual
  appearance).</p>

  <hr>

  <p>Note that <a href=#upgrades id=custom-elements-upgrades-examples:upgrades-2>upgrades</a> only apply to elements in the
  document tree. (Formally, elements that are <a id=custom-elements-upgrades-examples:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>.) An element that is not
  inserted into a document will stay un-upgraded. An example illustrates this point:</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html&gt;</c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>&gt;</c->
<c- p>&lt;</c-><c- f>title</c-><c- p>&gt;</c->Upgrade edge-cases example<c- p>&lt;/</c-><c- f>title</c-><c- p>&gt;</c->

<c- p>&lt;</c-><c- f>example-element</c-><c- p>&gt;&lt;/</c-><c- f>example-element</c-><c- p>&gt;</c->

<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
  <c- u>"use strict"</c-><c- p>;</c->

  <c- kr>const</c-> inDocument <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->
  <c- kr>const</c-> outOfDocument <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->

  <c- c1>// Before the element definition, both are HTMLElement:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->

  <c- kr>class</c-> ExampleElement <c- kr>extends</c-> HTMLElement <c- p>{}</c->
  customElements<c- p>.</c->define<c- p>(</c-><c- u>"example-element"</c-><c- p>,</c-> ExampleElement<c- p>);</c->

  <c- c1>// After element definition, the in-document element was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>));</c->

  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->outOfDocument<c- p>);</c->

  <c- c1>// Now that we've moved the element into the document, it too was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>

  <h4 id=custom-element-conformance><span class=secno>4.13.2</span> Requirements for custom element constructors and
  reactions<a href=#custom-element-conformance class=self-link></a></h4>

  <p>When authoring <a href=#custom-element-constructor id=custom-element-conformance:custom-element-constructor>custom element constructors</a>,
  authors are bound by the following conformance requirements:</p>

  <ul><li><p>A parameter-less call to <code>super()</code> must be the first statement in the
   constructor body, to establish the correct prototype chain and <b>this</b> value before any
   further code is run.</li><li><p>A <code>return</code> statement must not appear anywhere inside the constructor
   body, unless it is a simple early-return (<code>return</code> or <code>return
   this</code>).</li><li><p>The constructor must not use the <code id=custom-element-conformance:dom-document-write><a href=dynamic-markup-insertion.html#dom-document-write>document.write()</a></code>
   or <code id=custom-element-conformance:dom-document-open><a href=dynamic-markup-insertion.html#dom-document-open>document.open()</a></code> methods.</li><li><p>The element's attributes and children must not be inspected, as in the non-<a href=#upgrades id=custom-element-conformance:upgrades>upgrade</a> case none will be present, and relying on
   upgrades makes the element less usable.</li><li><p>The element must not gain any attributes or children, as this violates the expectations of
   consumers who use the <code id=custom-element-conformance:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement</a></code> or <code id=custom-element-conformance:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns>createElementNS</a></code> methods.</li><li><p>In general, work should be deferred to <code>connectedCallback</code> as much as
   possible—especially work involving fetching resources or rendering. However, note that <code>connectedCallback</code> can be called more than once, so any initialization work that
   is truly one-time will need a guard to prevent it from running twice.</li><li><p>In general, the constructor should be used to set up initial state and default values, and
   to set up event listeners and possibly a <a id=custom-element-conformance:shadow-root href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-root data-x-internal=shadow-root>shadow root</a>.</li></ul>

  <p>Several of these requirements are checked during <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-element-conformance:create-an-element data-x-internal=create-an-element>element
  creation</a>, either directly or indirectly, and failing to follow them will result in a custom
  element that cannot be instantiated by the parser or DOM APIs. This is true even if the work is
  done inside a constructor-initiated <a id=custom-element-conformance:microtask href=webappapis.html#microtask>microtask</a>, as a <a href=webappapis.html#perform-a-microtask-checkpoint id=custom-element-conformance:perform-a-microtask-checkpoint>microtask checkpoint</a> can occur immediately after construction.</p>

  <p>When authoring <a href=#concept-custom-element-reaction id=custom-element-conformance:concept-custom-element-reaction>custom element reactions</a>,
  authors should avoid manipulating the node tree as this can lead to unexpected results.</p>

  <div class=example>
   <p>An element's <code>connectedCallback</code> can be queued before the element is
   disconnected, but as the callback queue is still processed, it results in a <code>connectedCallback</code> for an element that is no longer connected:</p>

   <pre><code class='js'><c- kr>class</c-> CParent <c- kr>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->firstChild<c- p>.</c->remove<c- p>();</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-parent"</c-><c- p>,</c-> CParent<c- p>);</c->

<c- kr>class</c-> CChild <c- kr>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    console<c- p>.</c->log<c- p>(</c-><c- u>"CChild connectedCallback: isConnected ="</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->isConnected<c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-child"</c-><c- p>,</c-> CChild<c- p>);</c->

<c- kr>const</c-> parent <c- o>=</c-> <c- k>new</c-> CParent<c- p>(),</c->
      child <c- o>=</c-> <c- k>new</c-> CChild<c- p>();</c->
parent<c- p>.</c->append<c- p>(</c->child<c- p>);</c->
document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->parent<c- p>);</c->

<c- c1>// Logs:</c->
<c- c1>// CChild connectedCallback: isConnected = false</c-></code></pre>
  </div>

  <h4 id=custom-elements-core-concepts><span class=secno>4.13.3</span> Core concepts<a href=#custom-elements-core-concepts class=self-link></a></h4>

  <p>A <dfn id=custom-element data-export="">custom element</dfn> is an element that is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=custom-elements-core-concepts:concept-element-custom data-x-internal=concept-element-custom>custom</a>. Informally, this means that its constructor and
  prototype are defined by the author, instead of by the user agent. This author-supplied
  constructor function is called the <dfn id=custom-element-constructor data-export="">custom element constructor</dfn>.</p>

  <p>Two distinct types of <a href=#custom-element id=custom-elements-core-concepts:custom-element>custom elements</a> can be defined:</p>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/is title="The is global attribute allows you to specify that a standard HTML element should behave like a defined custom built-in element (see Using custom elements for more details).">Global_attributes/is</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>67+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>55+</span></span><span class="opera_android yes"><span>Opera Android</span><span>55+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span></details></div></aside><ol><li><p>An <dfn id=autonomous-custom-element data-export="">autonomous custom element</dfn>, which is defined with no <code>extends</code> option. These types of custom elements have a local name equal to their
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name>defined name</a>.</li><li><p>A <dfn id=customized-built-in-element data-export="">customized built-in element</dfn>, which is defined with an <code>extends</code> option. These types of custom elements have a local name equal to the
   value passed in their <code>extends</code> option, and their <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-2>defined name</a> is used as the value of the
   <dfn id=attr-is><code>is</code></dfn> attribute, which therefore must be a <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name>valid
   custom element name</a>.</li></ol>

  <p>After a <a href=#custom-element id=custom-elements-core-concepts:custom-element-2>custom element</a> is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-create-element id=custom-elements-core-concepts:create-an-element data-x-internal=create-an-element>created</a>,
  changing the value of the <code id=custom-elements-core-concepts:attr-is><a href=#attr-is>is</a></code> attribute does not
  change the element's behavior, as it is saved on the element as its <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=custom-elements-core-concepts:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code> value</a>.</p>

  <p><a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element>Autonomous custom elements</a> have the following
  element definition:</p>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=custom-elements-core-concepts:concept-element-categories>カテゴリー</a>：<dd><a id=custom-elements-core-concepts:flow-content-2 href=dom.html#flow-content-2>フローコンテンツ</a>。<dd><a id=custom-elements-core-concepts:phrasing-content-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>。<dd><a id=custom-elements-core-concepts:palpable-content-2 href=dom.html#palpable-content-2>パルパブルコンテンツ</a>。<dt><a href=dom.html#concept-element-contexts id=custom-elements-core-concepts:concept-element-contexts>この要素を使用できるコンテキスト</a>：<dd><a id=custom-elements-core-concepts:phrasing-content-2-2 href=dom.html#phrasing-content-2>フレージングコンテンツ</a>が期待される場所。<dt><a href=dom.html#concept-element-content-model id=custom-elements-core-concepts:concept-element-content-model>コンテンツモデル</a>：<dd><a id=custom-elements-core-concepts:transparent href=dom.html#transparent>透過的</a>。<dt><a href=dom.html#concept-element-attributes id=custom-elements-core-concepts:concept-element-attributes>コンテンツ属性</a>：<dd><a id=custom-elements-core-concepts:global-attributes href=dom.html#global-attributes>Global attributes</a>, except the <code id=custom-elements-core-concepts:attr-is-2><a href=#attr-is>is</a></code> attribute<dd>名前空間を持たないその他の属性（文参照）。<dt><a href=dom.html#concept-element-dom id=custom-elements-core-concepts:concept-element-dom>DOMインターフェイス</a>：<dd>Supplied by the element's author (inherits from <code id=custom-elements-core-concepts:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>)</dl>


  <p>An <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-2>autonomous custom element</a> does not have any special meaning: it
  <a id=custom-elements-core-concepts:represents href=dom.html#represents>represents</a> its children. A <a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element>customized built-in element</a> inherits the
  semantics of the element that it extends.</p>

  <p>Any namespace-less attribute that is relevant to the element's functioning, as determined by
  the element's author, may be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-3>autonomous custom element</a>, so long as
  the attribute name is <a id=custom-elements-core-concepts:xml-compatible href=infrastructure.html#xml-compatible>XML-compatible</a> and contains no <a href=https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters data-x-internal=uppercase-ascii-letters>ASCII upper alphas</a>. The exception is the <code id=custom-elements-core-concepts:attr-is-3><a href=#attr-is>is</a></code> attribute,
  which must not be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-4>autonomous custom element</a> (and which will have no
  effect if it is).</p>

  <p><a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element-2>Customized built-in elements</a> follow the
  normal requirements for attributes, based on the elements they extend. To add custom
  attribute-based behavior, use <code id=custom-elements-core-concepts:attr-data-*><a href=dom.html#attr-data-*>data-*</a></code> attributes.</p>

  <hr>

  <p>A <dfn id=valid-custom-element-name data-export="">valid custom element name</dfn> is a sequence of characters
  <var>name</var> that meets all of the following requirements:</p>

  <ul><li>
    <p><var>name</var> must match the <code id=custom-elements-core-concepts:prod-potentialcustomelementname><a href=#prod-potentialcustomelementname>PotentialCustomElementName</a></code> production:</p>

    <dl><dt><code><dfn id=prod-potentialcustomelementname>PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar>PCENChar</a>)* '-'
     (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar-2>PCENChar</a>)*</code><dt><code><dfn id=prod-pcenchar>PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] |
     [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] |
     [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] |
     [#x10000-#xEFFFF]</code></dl>

    <p>This uses the <a href=https://www.w3.org/TR/xml/#sec-notation>EBNF notation</a> from the
    <cite>XML</cite> specification. <a href=references.html#refsXML>[XML]</a></p>
   </li><li>
    <p><var>name</var> must not be any of the following:</p>

    <ul class=brief><li><code>annotation-xml</code></li><li><code>color-profile</code></li><li><code>font-face</code></li><li><code>font-face-src</code></li><li><code>font-face-uri</code></li><li><code>font-face-format</code></li><li><code>font-face-name</code></li><li><code>missing-glyph</code></li></ul>

    <p class=note>The list of names above is the summary of all hyphen-containing element names
    from the <a href=infrastructure.html#other-applicable-specifications id=custom-elements-core-concepts:other-applicable-specifications>applicable specifications</a>, namely
    <cite>SVG</cite> and <cite>MathML</cite>. <a href=references.html#refsSVG>[SVG]</a> <a href=references.html#refsMATHML>[MATHML]</a></p>
   </li></ul>

  <div class=note>
   <p>These requirements ensure a number of goals for <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-2>valid
   custom element names</a>:</p>

   <ul><li><p>They start with an <a id=custom-elements-core-concepts:lowercase-ascii-letters href=https://triple-underscore.github.io/infra-ja.html#ascii-lower-alpha data-x-internal=lowercase-ascii-letters>ASCII lower alpha</a>, ensuring that the HTML parser will
    treat them as tags instead of as text.</li><li><p>They do not contain any <a href=https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters-2 data-x-internal=uppercase-ascii-letters>ASCII upper alphas</a>,
    ensuring that the user agent can always treat HTML elements ASCII-case-insensitively.</li><li><p>They contain a hyphen, used for namespacing and to ensure forward compatibility (since no
    elements will be added to HTML, SVG, or MathML with hyphen-containing local names in the
    future).</li><li><p>They can always be created with <code id=custom-elements-core-concepts:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement>createElement()</a></code> and <code id=custom-elements-core-concepts:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns>createElementNS()</a></code>, which have restrictions that go
    beyond the parser's.</li></ul>

   <p>Apart from these restrictions, a large variety of names is allowed, to give maximum
   flexibility for use cases like <code>&lt;math-α&gt;</code> or <code>&lt;emotion-😍&gt;</code>.</p>
  </div>

  

  <p>A <dfn id=custom-element-definition>custom element definition</dfn> describes a <a href=#custom-element id=custom-elements-core-concepts:custom-element-3>custom element</a> and consists
  of:</p>

  <dl><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-name data-export="">name</dfn><dd>A <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-3>valid custom element name</a><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-local-name data-export="">local name</dfn><dd>A local name<dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-constructor data-export="">constructor</dfn><dd>A Web IDL <code id=custom-elements-core-concepts:idl-function><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback function type value wrapping
   the <a href=#custom-element-constructor id=custom-elements-core-concepts:custom-element-constructor>custom element constructor</a><dt>A list of <dfn id=concept-custom-element-definition-observed-attributes>observed
   attributes</dfn><dd>A <code>sequence&lt;DOMString&gt;</code><dt>A collection of <dfn id=concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</dfn><dd>A map, whose four keys are the strings "<code>connectedCallback</code>",
   "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and
   "<code>attributeChangedCallback</code>". The corresponding values are either a Web IDL
   <code id=custom-elements-core-concepts:idl-function-2><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback function type value, or null. By default the
   value of each entry is null.<dt>A <dfn id=concept-custom-element-definition-construction-stack>construction
   stack</dfn><dd>A list, initially empty, that is manipulated by the <a href=#concept-upgrade-an-element id=custom-elements-core-concepts:concept-upgrade-an-element>upgrade an element</a> algorithm and the <a href=dom.html#html-element-constructors>HTML element constructors</a>. Each entry in the list will be
   either an element or an <dfn id=concept-already-constructed-marker><i>already
   constructed</i> marker</dfn>.</dl>

  <p>To <dfn id=look-up-a-custom-element-definition data-export="">look up a custom element definition</dfn>, given a <var>document</var>,
  <var>namespace</var>, <var>localName</var>, and <var>is</var>, perform the following steps. They
  will return either a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition>custom element definition</a> or null:</p>

  <ol><li><p>If <var>namespace</var> is not the <a id=custom-elements-core-concepts:html-namespace-2 href=https://triple-underscore.github.io/infra-ja.html#html-namespace data-x-internal=html-namespace-2>HTML namespace</a>, return null.</li><li><p>If <var>document</var>'s <a href=browsers.html#concept-document-bc id=custom-elements-core-concepts:concept-document-bc>browsing context</a> is
   null, return null.</li><li><p>Let <var>registry</var> be <var>document</var>'s <a id=custom-elements-core-concepts:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global object</a>'s
   <code id=custom-elements-core-concepts:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> object.</li><li><p>If there is <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-2>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-3>name</a> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name>local name</a> both equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-3>custom element definition</a>.</li><li><p>If there is a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-4>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-4>name</a> equal to <var>is</var> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name-2>local name</a> equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-5>custom element definition</a>.</li><li><p>Return null.</li></ol>

  

  <h4 id=custom-elements-api><span class=secno>4.13.4</span> The <code id=custom-elements-api:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> interface<a href=#custom-elements-api class=self-link></a></h4>

  <p>Each <code id=custom-elements-api:window><a href=window-object.html#window>Window</a></code> object is associated with a unique instance of a
  <code id=custom-elements-api:customelementregistry-2><a href=#customelementregistry>CustomElementRegistry</a></code> object, allocated when the <code id=custom-elements-api:window-2><a href=window-object.html#window>Window</a></code> object is
  created.</p>

  <p class=note>Custom element registries are associated with <code id=custom-elements-api:window-3><a href=window-object.html#window>Window</a></code> objects, instead
  of <code id=custom-elements-api:document><a href=dom.html#document>Document</a></code> objects, since each <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor>custom element constructor</a> inherits from
  the <code id=custom-elements-api:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code> interface, and there is exactly one <code id=custom-elements-api:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code>
  interface per <code id=custom-elements-api:window-4><a href=window-object.html#window>Window</a></code> object.</p>

  

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/customElements title="The customElements read-only property of the Window interface returns a reference to the CustomElementRegistry object, which can be used to register new custom elements and get information about previously registered custom elements.">Window/customElements</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>54+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.1+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span></details></div></aside><p>The <dfn id=dom-window-customelements><code>customElements</code></dfn> attribute
  of the <code id=custom-elements-api:window-5><a href=window-object.html#window>Window</a></code> interface must return the <code id=custom-elements-api:customelementregistry-3><a href=#customelementregistry>CustomElementRegistry</a></code> object for
  that <code id=custom-elements-api:window-6><a href=window-object.html#window>Window</a></code> object.</p>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry title="The CustomElementRegistry interface provides methods for registering custom elements and querying registered elements. To get an instance of it, use the window.customElements property. ">CustomElementRegistry</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>54+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span></details></div></aside><pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='customelementregistry'><c- g>CustomElementRegistry</c-></dfn> {
  [<a href='#cereactions' id='custom-elements-api:cereactions'><c- g>CEReactions</c-></a>] <c- b>void</c-> <a href='#dom-customelementregistry-define' id='custom-elements-api:dom-customelementregistry-define'><c- g>define</c-></a>(<c- b>DOMString</c-> <c- g>name</c->, <a href='#customelementconstructor' id='custom-elements-api:customelementconstructor'><c- n>CustomElementConstructor</c-></a> <c- g>constructor</c->, <c- b>optional</c-> <a href='#elementdefinitionoptions' id='custom-elements-api:elementdefinitionoptions'><c- n>ElementDefinitionOptions</c-></a> <c- g>options</c->);
  <c- b>any</c-> <a href='#dom-customelementregistry-get' id='custom-elements-api:dom-customelementregistry-get'><c- g>get</c-></a>(<c- b>DOMString</c-> <c- g>name</c->);
  <c- b>Promise</c->&lt;<c- b>void</c->&gt; <a href='#dom-customelementregistry-whendefined' id='custom-elements-api:dom-customelementregistry-whendefined'><c- g>whenDefined</c-></a>(<c- b>DOMString</c-> <c- g>name</c->);
  [<a href='#cereactions' id='custom-elements-api:cereactions-2'><c- g>CEReactions</c-></a>] <c- b>void</c-> <a href='#dom-customelementregistry-upgrade' id='custom-elements-api:dom-customelementregistry-upgrade'><c- g>upgrade</c-></a>(<a href='https://triple-underscore.github.io/DOM4-ja.html#interface-node' data-x-internal='node' id='custom-elements-api:node'><c- n>Node</c-></a> <c- g>root</c->);
};

<c- b>callback</c-> <dfn id='customelementconstructor'><c- g>CustomElementConstructor</c-></dfn> = <c- b>any</c-> ();

<c- b>dictionary</c-> <dfn id='elementdefinitionoptions'><c- g>ElementDefinitionOptions</c-></dfn> {
  <c- b>DOMString</c-> <c- g>extends</c->;
};</code></pre>

  <p>Every <code id=custom-elements-api:customelementregistry-4><a href=#customelementregistry>CustomElementRegistry</a></code> has a set of <a href=#custom-element-definition id=custom-elements-api:custom-element-definition>custom element definitions</a>, initially empty. In general, algorithms in this
  specification look up elements in the registry by any of <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name>name</a>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name>local name</a>, or <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor>constructor</a>.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-5><a href=#customelementregistry>CustomElementRegistry</a></code> also has an <dfn id=element-definition-is-running>element definition is running</dfn>
  flag which is used to prevent reentrant invocations of <a href=#element-definition id=custom-elements-api:element-definition>element definition</a>. It is
  initially unset.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-6><a href=#customelementregistry>CustomElementRegistry</a></code> also has a <dfn id=when-defined-promise-map>when-defined promise map</dfn>,
  mapping <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name>valid custom element names</a> to promises. It
  is used to implement the <code id=custom-elements-api:dom-customelementregistry-whendefined-2><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method.</p>

  

  <dl class=domintro><dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-define-dev><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>,
   <var>constructor</var>)<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element>custom element</a>, mapping the given name to the given constructor as
   an <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element>autonomous custom element</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-2><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-2><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>, <var>constructor</var>,
   { extends: <var>baseLocalName</var> })<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element-2>custom element</a>, mapping the given name to the given constructor as
   a <a href=#customized-built-in-element id=custom-elements-api:customized-built-in-element>customized built-in element</a> for the <a id=custom-elements-api:element-type href=infrastructure.html#element-type>element type</a> identified by the
   supplied <var>baseLocalName</var>. A <a id=custom-elements-api:notsupportederror href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a>
   <code id=custom-elements-api:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> will be thrown upon trying to extend a <a href=#custom-element id=custom-elements-api:custom-element-3>custom element</a> or
   an unknown element.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-3><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-get-dev><a href=#dom-customelementregistry-get>get</a></code>(<var>name</var>)<dd>Retrieves the <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor-2>custom element constructor</a> defined for the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-2>name</a>. Returns undefined if there is no
   <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-2>custom element definition</a> with the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-3>name</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-4><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-whendefined-dev><a href=#dom-customelementregistry-whendefined>whenDefined</a></code>(<var>name</var>)<dd>Returns a promise that will be fulfilled when a <a href=#custom-element id=custom-elements-api:custom-element-4>custom element</a> becomes defined
   with the given name. (If such a <a href=#custom-element id=custom-elements-api:custom-element-5>custom element</a> is already defined, the returned
   promise will be immediately fulfilled.) Returns a promise rejected with a
   <a id=custom-elements-api:syntaxerror href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if not given a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-2>valid
   custom element name</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-5><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-upgrade-dev><a href=#dom-customelementregistry-upgrade>upgrade</a></code>(<var>root</var>)<dd><a href=#concept-try-upgrade id=custom-elements-api:concept-try-upgrade>Tries to upgrade</a> all <a id=custom-elements-api:shadow-including-inclusive-descendant href=https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-descendant data-x-internal=shadow-including-inclusive-descendant>shadow-including
   inclusive descendant</a> elements of <var>root</var>, even if they are not
   <a id=custom-elements-api:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>.</dl>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define title="The define() method of the CustomElementRegistry interface defines a new custom element.">CustomElementRegistry/define</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>66+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="opera_android yes"><span>Opera Android</span><span>53+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span></details></div></aside><p><dfn id=element-definition>Element definition</dfn> is a process of adding a <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-3>custom element definition</a>
  to the <code id=custom-elements-api:customelementregistry-7><a href=#customelementregistry>CustomElementRegistry</a></code>. This is accomplished by the <code id=custom-elements-api:dom-customelementregistry-define-3><a href=#dom-customelementregistry-define>define()</a></code> method. When invoked,
  the <dfn id=dom-customelementregistry-define><code>define(<var>name</var>,
  <var>constructor</var>, <var>options</var>)</code></dfn> method must run these steps:</p>

  

  <ol><li><p>If <a id=custom-elements-api:isconstructor href=https://tc39.github.io/ecma262/#sec-isconstructor data-x-internal=isconstructor>IsConstructor</a>(<var>constructor</var>) is false, then throw a
   <code id=custom-elements-api:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code>.</li><li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-3>valid custom element name</a>, then throw a
   <a id=custom-elements-api:syntaxerror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=custom-elements-api:customelementregistry-8><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-4>name</a> <var>name</var>, then throw a
   <a id=custom-elements-api:notsupportederror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=custom-elements-api:customelementregistry-9><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-2>constructor</a> <var>constructor</var>,
   then throw a <a id=custom-elements-api:notsupportederror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-5><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>localName</var> be <var>name</var>.</li><li><p>Let <var>extends</var> be the value of the <code>extends</code> member of
   <var>options</var>, or null if no such member exists.</li><li>
    <p>If <var>extends</var> is not null, then:</p>

    <ol><li><p>If <var>extends</var> is a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-4>valid custom element name</a>, then throw a
     <a id=custom-elements-api:notsupportederror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-6><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If the <a id=custom-elements-api:element-interface href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface data-x-internal=element-interface>element interface</a> for <var>extends</var> and the <a id=custom-elements-api:html-namespace-2 href=https://triple-underscore.github.io/infra-ja.html#html-namespace data-x-internal=html-namespace-2>HTML
     namespace</a> is <code id=custom-elements-api:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code> (e.g., if <var>extends</var> does not
     indicate an element definition in this specification), then throw a
     <a id=custom-elements-api:notsupportederror-5 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-7><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Set <var>localName</var> to <var>extends</var>.</li></ol>
   </li><li><p>If this <code id=custom-elements-api:customelementregistry-10><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running>element definition is running</a>
   flag is set, then throw a <a id=custom-elements-api:notsupportederror-6 href=https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-8><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Set this <code id=custom-elements-api:customelementregistry-11><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-2>element definition is running</a>
   flag.</li><li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li><p>Let <var>prototype</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get data-x-internal=js-get>Get</a>(<var>constructor</var>, "prototype"). 例外を再度投げる。</li><li><p>If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=custom-elements-api:js-type data-x-internal=js-type>Type</a>(<var>prototype</var>) is not Object, then throw a
     <code id=custom-elements-api:typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.</li><li><p>Let <var>lifecycleCallbacks</var> be a map with the four keys "<code>connectedCallback</code>", "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and "<code>attributeChangedCallback</code>", each
     of which belongs to an entry whose value is null.</p>

     </li><li>
      <p>For each of the four keys <var>callbackName</var> in <var>lifecycleCallbacks</var>, in the
      order listed in the previous step:</p>

      <ol><li><p>Let <var>callbackValue</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-2 data-x-internal=js-get>Get</a>(<var>prototype</var>, <var>callbackName</var>). 例外を再度投げる。</p>

       </li><li><p>If <var>callbackValue</var> is not undefined, then set the value of the entry in
       <var>lifecycleCallbacks</var> with key <var>callbackName</var> to the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=custom-elements-api:concept-idl-convert data-x-internal=concept-idl-convert>converting</a> <var>callbackValue</var> to the Web IDL
       <code id=custom-elements-api:idl-function><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> callback type. Rethrow any exceptions from the
       conversion.</li></ol>
     </li><li><p>Let <var>observedAttributes</var> be an empty <code>sequence&lt;DOMString&gt;</code>.</li><li>
      <p>If the value of the entry in <var>lifecycleCallbacks</var> with key "<code>attributeChangedCallback</code>" is not null, then:</p>

      <ol><li><p>Let <var>observedAttributesIterable</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-3 data-x-internal=js-get>Get</a>(<var>constructor</var>, "observedAttributes"). 例外を再度投げる。</li><li><p>If <var>observedAttributesIterable</var> is not undefined, then set
       <var>observedAttributes</var> to the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=custom-elements-api:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a> <var>observedAttributesIterable</var> to a
       <code>sequence&lt;DOMString&gt;</code>. Rethrow any exceptions from the
       conversion.</li></ol>
    </li></ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li><p>Unset this <code id=custom-elements-api:customelementregistry-12><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-3>element definition is
     running</a> flag.</li></ol>

    <p>Finally, if the first set of substeps threw an exception, then rethrow that exception (thus
    terminating this algorithm). Otherwise, continue onward.</p>
   </li><li><p>Let <var>definition</var> be a new <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-4>custom element definition</a> with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-5>name</a> <var>name</var>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name-2>local name</a> <var>localName</var>,
   <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-3>constructor</a>
   <var>constructor</var>, <a href=#concept-custom-element-definition-observed-attributes id=custom-elements-api:concept-custom-element-definition-observed-attributes>observed attributes</a>
   <var>observedAttributes</var>, and <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-elements-api:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a>
   <var>lifecycleCallbacks</var>.</li><li><p>Add <var>definition</var> to this <code id=custom-elements-api:customelementregistry-13><a href=#customelementregistry>CustomElementRegistry</a></code>.</li><li><p>Let <var>document</var> be this <code id=custom-elements-api:customelementregistry-14><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a id=custom-elements-api:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global
   object</a>'s <a href=window-object.html#concept-document-window id=custom-elements-api:concept-document-window>associated
   <code>Document</code></a>.</li><li><p>Let <var>upgrade candidates</var> be all elements that are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-descendant id=custom-elements-api:shadow-including-descendant data-x-internal=shadow-including-descendant>shadow-including descendants</a> of <var>document</var>, whose namespace
   is the <a id=custom-elements-api:html-namespace-2-2 href=https://triple-underscore.github.io/infra-ja.html#html-namespace data-x-internal=html-namespace-2>HTML namespace</a> and whose local name is <var>localName</var>, in
   <a id=custom-elements-api:shadow-including-tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order data-x-internal=shadow-including-tree-order>shadow-including tree order</a>. Additionally, if <var>extends</var> is non-null, only
   include elements whose <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=custom-elements-api:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a> is equal to <var>name</var>.</li><li><p>For each element <var>element</var> in <var>upgrade candidates</var>, <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-elements-api:enqueue-a-custom-element-upgrade-reaction>enqueue a
   custom element upgrade reaction</a> given <var>element</var> and
   <var>definition</var>.</li><li>
    <p>If this <code id=custom-elements-api:customelementregistry-15><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map>when-defined promise map</a>
    contains an entry with key <var>name</var>:</p>

    <ol><li><p>Let <var>promise</var> be the value of that entry.</li><li><p>Resolve <var>promise</var> with undefined.</li><li><p>Delete the entry with key <var>name</var> from this
     <code id=custom-elements-api:customelementregistry-16><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-2>when-defined promise map</a>.</li></ol>
   </li></ol>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/get title="The get() method of the CustomElementRegistry interface returns the constructor for a previously-defined custom element.">CustomElementRegistry/get</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>66+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="opera_android yes"><span>Opera Android</span><span>53+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span></details></div></aside><p>When invoked, the <dfn id=dom-customelementregistry-get><code>get(<var>name</var>)</code></dfn> method must run these
  steps:</p>

  <ol><li><p>If this <code id=custom-elements-api:customelementregistry-17><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-6>name</a> <var>name</var>, then return that
   entry's <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-4>constructor</a>.</li><li><p>Otherwise, return undefined.</li></ol>

  <aside class="mdn before"><input onclick=toggleStatus(this) value=⋰ type=button><div><b>MDN</b> <details><summary><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/whenDefined title="The whenDefined() method of the CustomElementRegistry interface returns a Promise that resolves when the named element is defined.">CustomElementRegistry/whenDefined</a></summary><p class=mdnsupport><span class="chrome yes"><span>Chrome</span><span>66+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="edge no"><span>Edge</span><span>No</span></span><span class="edge_mobile no"><span>Edge Mobile</span><span>No</span></span><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="opera_android yes"><span>Opera Android</span><span>53+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span></details></div></aside><p>When invoked, the <dfn id=dom-customelementregistry-whendefined><code>whenDefined(<var>name</var>)</code></dfn> method
  must run these steps:</p>

  <ol><li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-5>valid custom element name</a>, then return a new
   promise rejected with a <a id=custom-elements-api:syntaxerror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-9><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>If this <code id=custom-elements-api:customelementregistry-18><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-7>name</a> <var>name</var>, then return a new
   promise resolved with undefined.</li><li><p>Let <var>map</var> be this <code id=custom-elements-api:customelementregistry-19><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-3>when-defined
   promise map</a>.</li><li><p>If <var>map</var> does not contain an entry with key <var>name</var>, create an entry in
   <var>map</var> with key <var>name</var> and whose value is a new promise.</li><li><p>Let <var>promise</var> be the value of the entry in <var>map</var> with key
   <var>name</var>.</li><li><p>Return <var>promise</var>.</li></ol>

  

  <div class=example>
   <p>The <code id=custom-elements-api:dom-customelementregistry-whendefined-3><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method can be
   used to avoid performing an action until all appropriate <a href=#custom-element id=custom-elements-api:custom-element-6>custom
   elements</a> are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-defined id=custom-elements-api:concept-element-defined data-x-internal=concept-element-defined>defined</a>. In this example, we
   combine it with the <code id=custom-elements-api:selector-defined><a href=semantics-other.html#selector-defined>:defined</a></code> pseudo-class to hide a
   dynamically-loaded article's contents until we're sure that all of the <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element-2>autonomous custom elements</a> it uses are defined.</p>

   <pre><code class='js'>articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>true</c-><c- p>;</c->

fetch<c- p>(</c->articleURL<c- p>)</c->
  <c- p>.</c->then<c- p>(</c->response <c- p>=&gt;</c-> response<c- p>.</c->text<c- p>())</c->
  <c- p>.</c->then<c- p>(</c->text <c- p>=&gt;</c-> <c- p>{</c->
    articleContainer<c- p>.</c->innerHTML <c- o>=</c-> text<c- p>;</c->

    <c- k>return</c-> Promise<c- p>.</c->all<c- p>(</c->
      <c- p>[...</c->articleContainer<c- p>.</c->querySelectorAll<c- p>(</c-><c- u>":not(:defined)"</c-><c- p>)]</c->
        <c- p>.</c->map<c- p>(</c->el <c- p>=&gt;</c-> customElements<c- p>.</c->whenDefined<c- p>(</c->el<c- p>.</c->localName<c- p>))</c->
    <c- p>);</c->
  <c- p>})</c->
  <c- p>.</c->then<c- p>(()</c-> <c- p>=&gt;</c-> <c- p>{</c->
    articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>false</c-><c- p>;</c->
  <c- p>});</c-></code></pre>
  </div>

  

  <p>When invoked, the <dfn id=dom-customelementregistry-upgrade><code>upgrade(<var>root</var>)</code></dfn> method must run
  these steps:</p>

  <ol><li><p>Let <var>candidates</var> be a <a id=custom-elements-api:list href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of all of <var>root</var>'s
   <a id=custom-elements-api:shadow-including-inclusive-descendant-2 href=https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-descendant data-x-internal=shadow-including-inclusive-descendant>shadow-including inclusive descendant</a> elements, in <a id=custom-elements-api:shadow-including-tree-order-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order data-x-internal=shadow-including-tree-order>shadow-including tree
   order</a>.</li><li><p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=custom-elements-api:list-iterate data-x-internal=list-iterate>For each</a> <var>candidate</var> of <var>candidates</var>,
   <a href=#concept-try-upgrade id=custom-elements-api:concept-try-upgrade-2>try to upgrade</a> <var>candidate</var>.</li></ol>

  

  <div class=example>
   <p>The <code id=custom-elements-api:dom-customelementregistry-upgrade-2><a href=#dom-customelementregistry-upgrade>upgrade()</a></code> method allows upgrading
   of elements at will. Normally elements are automatically upgraded when they become
   <a id=custom-elements-api:connected-2 href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>, but this method can be used if you need to upgrade before you're ready to
   connect the element.</p>

   <pre><code class='js'><c- kr>const</c-> el <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"spider-man"</c-><c- p>);</c->

<c- kr>class</c-> SpiderMan <c- kr>extends</c-> HTMLElement <c- p>{}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"spider-man"</c-><c- p>,</c-> SpiderMan<c- p>);</c->

console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>));</c-> <c- c1>// not yet upgraded</c->

customElements<c- p>.</c->upgrade<c- p>(</c->el<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>);</c->    <c- c1>// upgraded!</c-></code></pre>
  </div>

  

  <h4 id=upgrades><span class=secno>4.13.5</span> <dfn>Upgrades</dfn><a href=#upgrades class=self-link></a></h4>

  <p>To <dfn id=concept-upgrade-an-element data-export="">upgrade an element</dfn>, given as
  input a <a href=#custom-element-definition id=upgrades:custom-element-definition>custom element definition</a> <var>definition</var> and an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If <var>element</var> is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=upgrades:concept-element-custom data-x-internal=concept-element-custom>custom</a>, then
    return.</p>

    <div class=example>
     <p>This can occur due to reentrant invocation of this algorithm, as in the following
     example:</p>

     <pre><code class='html'><c- cp>&lt;!DOCTYPE html&gt;</c->
<c- p>&lt;</c-><c- f>x-foo</c-> <c- e>id</c-><c- o>=</c-><c- s>"a"</c-><c- p>&gt;&lt;/</c-><c- f>x-foo</c-><c- p>&gt;</c->
<c- p>&lt;</c-><c- f>x-foo</c-> <c- e>id</c-><c- o>=</c-><c- s>"b"</c-><c- p>&gt;&lt;/</c-><c- f>x-foo</c-><c- p>&gt;</c->

<c- p>&lt;</c-><c- f>script</c-><c- p>&gt;</c->
<c- c1>// Defining enqueues upgrade reactions for both "a" and "b"</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"x-foo"</c-><c- p>,</c-> <c- kr>class</c-> <c- kr>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- kr>super</c-><c- p>();</c->

    <c- kr>const</c-> b <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"#b"</c-><c- p>);</c->
    b<c- p>.</c->remove<c- p>();</c->

    <c- c1>// While this constructor is running for "a", "b" is still</c->
    <c- c1>// undefined, and so inserting it into the document will enqueue a</c->
    <c- c1>// second upgrade reaction for "b" in addition to the one enqueued</c->
    <c- c1>// by defining x-foo.</c->
    document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->b<c- p>);</c->
  <c- p>}</c->
<c- p>})</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>&gt;</c-></code></pre>

     <p>This step will thus bail out the algorithm early when <a href=#concept-upgrade-an-element id=upgrades:concept-upgrade-an-element>upgrade an element</a> is invoked
     with "<code>b</code>" a second time.</p>
    </div>
   </li><li><p>If <var>element</var>'s <a id=upgrades:custom-element-state href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> is "<code>failed</code>", then return.</li><li><p>Set <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition id=upgrades:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom
   element definition</a> to <var>definition</var>.</li><li><p>For each <var>attribute</var> in <var>element</var>'s <a id=upgrades:attribute-list href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attribute data-x-internal=attribute-list>attribute list</a>, in
   order, <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction>enqueue a custom element callback reaction</a> with <var>element</var>, callback
   name "<code>attributeChangedCallback</code>", and an argument list containing
   <var>attribute</var>'s local name, null, <var>attribute</var>'s value, and <var>attribute</var>'s
   namespace.</li><li><p>If <var>element</var> is <a id=upgrades:connected href=https://triple-underscore.github.io/DOM4-ja.html#connected data-x-internal=connected>connected</a>, then <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction-2>enqueue a custom element
   callback reaction</a> with <var>element</var>, callback name "<code>connectedCallback</code>", and an empty argument list.</li><li><p>Add <var>element</var> to the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack>construction stack</a>.</li><li><p>Let <var>C</var> be <var>definition</var>'s <a href=#concept-custom-element-definition-constructor id=upgrades:concept-custom-element-definition-constructor>constructor</a>.</li><li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li>
      <p>Let <var>constructResult</var> be the result of <a href=https://heycam.github.io/webidl/#construct-a-callback-function id=upgrades:es-constructing-callback-functions data-x-internal=es-constructing-callback-functions>constructing</a> <var>C</var>, with no
      arguments.</p>

      <p class=note>If <var>C</var> <a href=#custom-element-conformance>non-conformantly</a>
      uses an API decorated with the <code id=upgrades:cereactions><a href=#cereactions>[CEReactions]</a></code> extended
      attribute, then the reactions enqueued at the beginning of this algorithm will execute during
      this step, before <var>C</var> finishes and control returns to this algorithm. Otherwise, they
      will execute after <var>C</var> and the rest of the upgrade process finishes.</p>
     </li><li>
      <p>If <a id=upgrades:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>constructResult</var>, <var>element</var>) is false,
      then throw an <a id=upgrades:invalidstateerror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=upgrades:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</p>

      <p class=note>This can occur if <var>C</var> constructs another instance of the same custom
      element before calling <code>super()</code>, or if <var>C</var> uses JavaScript's
      <code>return</code>-override feature to return an arbitrary object from the
      constructor.</p>
     </li></ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li>
      <p>Remove the last entry from the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack-2>construction stack</a>.</p>

      <div class=note>
       <p>Assuming <var>C</var> calls <code>super()</code> (as it will if it is <a href=#custom-element-conformance>conformant</a>), and that the call succeeds, this will be
       the <a href=#concept-already-constructed-marker id=upgrades:concept-already-constructed-marker><i>already
       constructed</i> marker</a> that replaced the <var>element</var> we pushed at the beginning
       of this algorithm. (The <a href=dom.html#html-element-constructors>HTML element constructor</a>
       carries out this replacement.)</p>

       <p>If <var>C</var> does not call <code>super()</code> (i.e. it is not <a href=#custom-element-conformance>conformant</a>), or if any step in the <a href=dom.html#html-element-constructors>HTML element constructor</a> throws, then this entry will
       still be <var>element</var>.</p>
      </div>
     </li></ol>

    <p>Finally, if the above steps threw an exception, then:</p>

    <ol><li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-2 href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>failed</code>".</li><li><p>Set <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition id=upgrades:concept-element-custom-element-definition-2 data-x-internal=concept-element-custom-element-definition>custom
     element definition</a> to null.</li><li><p>Empty <var>element</var>'s <a href=#custom-element-reaction-queue id=upgrades:custom-element-reaction-queue>custom element reaction queue</a>.</p>

     </li><li><p>Rethrow the exception (thus terminating this algorithm).</li></ol>
   </li><li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-3 href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>custom</code>".</li></ol>

  <p>To <dfn id=concept-try-upgrade data-export="">try to upgrade an element</dfn>, given as
  input an element <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be the result of <a href=#look-up-a-custom-element-definition id=upgrades:look-up-a-custom-element-definition>looking up a custom element definition</a> given <var>element</var>'s <a id=upgrades:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node
   document</a>, <var>element</var>'s namespace, <var>element</var>'s local name, and
   <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value id=upgrades:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a>.</li><li><p>If <var>definition</var> is not null, then <a href=#enqueue-a-custom-element-upgrade-reaction id=upgrades:enqueue-a-custom-element-upgrade-reaction>enqueue a custom element upgrade
   reaction</a> given <var>element</var> and <var>definition</var>.</li></ol>

  

  <h4 id=custom-element-reactions><span class=secno>4.13.6</span> Custom element reactions<a href=#custom-element-reactions class=self-link></a></h4>

  <p>A <a href=#custom-element id=custom-element-reactions:custom-element>custom element</a> possesses the ability to respond to certain occurrences by
  running author code:</p>

  <ul><li><p>When <a href=#upgrades id=custom-element-reactions:upgrades>upgraded</a>, its <a href=#custom-element-constructor id=custom-element-reactions:custom-element-constructor>constructor</a> is run, with no arguments.</li><li><p>When it <a id=custom-element-reactions:becomes-connected href=infrastructure.html#becomes-connected>becomes connected</a>, its <code>connectedCallback</code> is
   called, with no arguments.</li><li><p>When it <a id=custom-element-reactions:becomes-disconnected href=infrastructure.html#becomes-disconnected>becomes disconnected</a>, its <code>disconnectedCallback</code>
   is called, with no arguments.</li><li><p>When it is <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt id=custom-element-reactions:concept-node-adopt data-x-internal=concept-node-adopt>adopted</a> into a new document, its <code>adoptedCallback</code> is called, given the old document and new document as
   arguments.</li><li><p>When any of its attributes are <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-change id=custom-element-reactions:concept-element-attributes-change data-x-internal=concept-element-attributes-change>changed</a>, <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-append id=custom-element-reactions:concept-element-attributes-append data-x-internal=concept-element-attributes-append>appended</a>, <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-remove id=custom-element-reactions:concept-element-attributes-remove data-x-internal=concept-element-attributes-remove>removed</a>, or <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-replace id=custom-element-reactions:concept-element-attributes-replace data-x-internal=concept-element-attributes-replace>replaced</a>, its <code>attributeChangedCallback</code> is called, given the attribute's local name, old value,
   new value, and namespace as arguments. (An attribute's old or new value is considered to be null
   when the attribute is added or removed, respectively.)</li></ul>

  <p>We call these reactions collectively <dfn id=concept-custom-element-reaction>custom
  element reactions</dfn>.</p>

  <p>The way in which <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction>custom element reactions</a>
  are invoked is done with special care, to avoid running author code during the middle of delicate
  operations. Effectively, they are delayed until "just before returning to user script". This means
  that for most purposes they appear to execute synchronously, but in the case of complicated
  composite operations (like <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone id=custom-element-reactions:concept-node-clone data-x-internal=concept-node-clone>cloning</a>, or <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-range id=custom-element-reactions:concept-range data-x-internal=concept-range>range</a> manipulation), they will instead be delayed until after all
  the relevant user agent processing steps have completed, and then run together as a batch.</p>

  <p>Additionally, the precise ordering of these reactions is managed via a
  somewhat-complicated stack-of-queues system, described below. The intention behind this system is
  to guarantee that <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-2>custom element reactions</a> always are invoked in the
  same order as their triggering actions, at least within the local context of a single <a href=#custom-element id=custom-element-reactions:custom-element-2>custom
  element</a>. (Because <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-3>custom element
  reaction</a> code can perform its own mutations, it is not possible to give a global ordering
  guarantee across multiple elements.)</p>

  

  <hr>

  <p>Each <a id=custom-element-reactions:similar-origin-window-agent href=webappapis.html#similar-origin-window-agent>similar-origin window agent</a> has a <dfn id=custom-element-reactions-stack>custom element reactions stack</dfn>,
  which is initially empty. A <a id=custom-element-reactions:similar-origin-window-agent-2 href=webappapis.html#similar-origin-window-agent>similar-origin window agent</a>'s <dfn id=current-element-queue>current element
  queue</dfn> is the <a href=#element-queue id=custom-element-reactions:element-queue>element queue</a> at the top of its <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack>custom element reactions
  stack</a>. Each item in the stack is an <dfn id=element-queue>element queue</dfn>, which is initially empty as
  well. Each item in an <a href=#element-queue id=custom-element-reactions:element-queue-2>element queue</a> is an element. (The elements are not necessarily
  <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom id=custom-element-reactions:concept-element-custom data-x-internal=concept-element-custom>custom</a> yet, since this queue is used for <a href=#upgrades id=custom-element-reactions:upgrades-2>upgrades</a> as well.)</p>

  <p>Each <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-2>custom element reactions stack</a> has an associated <dfn id=backup-element-queue>backup element
  queue</dfn>, which an initially-empty <a href=#element-queue id=custom-element-reactions:element-queue-3>element queue</a>. Elements are pushed onto the
  <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue>backup element queue</a> during operations that affect the DOM without going through an
  API decorated with <code id=custom-element-reactions:cereactions><a href=#cereactions>[CEReactions]</a></code>, or through the parser's
  <a id=custom-element-reactions:create-an-element-for-the-token href=parsing.html#create-an-element-for-the-token>create an element for the token</a> algorithm. An example of this is a user-initiated
  editing operation which modifies the descendants or attributes of an <a id=custom-element-reactions:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>
  element. To prevent reentrancy when processing the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-2>backup element queue</a>, each
  <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-3>custom element reactions stack</a> also has a <dfn id=processing-the-backup-element-queue>processing the backup element
  queue</dfn> flag, initially unset.</p>

  <p>All elements have an associated <dfn id=custom-element-reaction-queue>custom element reaction queue</dfn>, initially empty. Each
  item in the <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue>custom element reaction queue</a> is of one of two types:</p>

  <ul><li><p>An <dfn id=upgrade-reaction>upgrade reaction</dfn>, which will <a href=#upgrades id=custom-element-reactions:upgrades-3>upgrade</a> the custom element and contains a <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition>custom
   element definition</a>; or</li><li><p>A <dfn id=callback-reaction>callback reaction</dfn>, which will call a lifecycle callback, and contains a
   callback function as well as a list of arguments.</li></ul>

  <p>これは、次の模式図にすべて要約される：</p>

  <p><img src=https://html.spec.whatwg.org/multipage/images/custom-element-reactions.svg alt="A custom element reactions stack consists of a stack of element queues. Zooming in on a particular queue, we see that it contains a number of elements (in our example, &lt;x-a&gt;, then &lt;x-b&gt;, then &lt;x-c&gt;). Any particular element in the queue then has a custom element reaction queue. Zooming in on the custom element reaction queue, we see that it contains a variety of queued-up reactions (in our example, upgrade, then attribute changed, then another attribute changed, then connected)." style="width: 80%; max-width: 580px;"></p>

  <p>To <dfn id=enqueue-an-element-on-the-appropriate-element-queue>enqueue an element on the appropriate element queue</dfn>, given an element
  <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>reactionsStack</var> be <var>element</var>'s <a id=custom-element-reactions:relevant-agent href=webappapis.html#relevant-agent>relevant agent</a>'s
   <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-4>custom element reactions stack</a>.</li><li>
    <p>If <var>reactionsStack</var> is empty, then:</p>

    <ol><li><p>Add <var>element</var> to <var>reactionsStack</var>'s <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-3>backup element
     queue</a>.</li><li><p>If <var>reactionsStack</var>'s <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue>processing the backup element queue</a> flag is
     set, then return.</li><li><p>Set <var>reactionsStack</var>'s <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-2>processing the backup element queue</a>
     flag.</li><li>
      <p><a id=custom-element-reactions:queue-a-microtask href=webappapis.html#queue-a-microtask>Queue a microtask</a> to perform the following steps:</p>

      <ol><li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions>Invoke custom element reactions</a> in <var>reactionsStack</var>'s
       <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-4>backup element queue</a>.</li><li><p>Unset <var>reactionsStack</var>'s <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-3>processing the backup element queue</a>
       flag.</li></ol>
     </li></ol>
   </li><li><p>Otherwise, add <var>element</var> to <var>element</var>'s <a id=custom-element-reactions:relevant-agent-2 href=webappapis.html#relevant-agent>relevant agent</a>'s
   <a href=#current-element-queue id=custom-element-reactions:current-element-queue>current element queue</a>.</li></ol>

  <p>To <dfn id=enqueue-a-custom-element-callback-reaction data-export="">enqueue a custom element callback reaction</dfn>, given a <a href=#custom-element id=custom-element-reactions:custom-element-3>custom
  element</a> <var>element</var>, a callback name <var>callbackName</var>, and a list of
  arguments <var>args</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be <var>element</var>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition id=custom-element-reactions:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom element definition</a>.</p>

   </li><li><p>Let <var>callback</var> be the value of the entry in <var>definition</var>'s <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-element-reactions:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a> with
   key <var>callbackName</var>.</li><li><p>If <var>callback</var> is null, then return</li><li>
    <p>If <var>callbackName</var> is "<code>attributeChangedCallback</code>", then:</p>

    <ol><li><p>Let <var>attributeName</var> be the first element of <var>args</var>.</li><li><p>If <var>definition</var>'s <a href=#concept-custom-element-definition-observed-attributes id=custom-element-reactions:concept-custom-element-definition-observed-attributes>observed attributes</a> does
     not contain <var>attributeName</var>, then return.</li></ol>
   </li><li><p>Add a new <a href=#callback-reaction id=custom-element-reactions:callback-reaction>callback reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-2>custom element
   reaction queue</a>, with callback function <var>callback</var> and arguments
   <var>args</var>.</li><li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</li></ol>

  <p>To <dfn id=enqueue-a-custom-element-upgrade-reaction data-export="">enqueue a custom element upgrade reaction</dfn>, given an element
  <var>element</var> and <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-2>custom element definition</a> <var>definition</var>, run the
  following steps:</p>

  <ol><li><p>Add a new <a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction>upgrade reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-3>custom element
   reaction queue</a>, with <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-3>custom element definition</a>
   <var>definition</var>.</li><li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue-2>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</li></ol>

  <p>To <dfn id=invoke-custom-element-reactions>invoke custom element reactions</dfn> in an <a href=#element-queue id=custom-element-reactions:element-queue-4>element queue</a>
  <var>queue</var>, run the following steps:</p>

  <ol><li>
    <p>For each <a href=#custom-element id=custom-element-reactions:custom-element-4>custom element</a> <var>element</var> in <var>queue</var>:</p>

    <ol><li><p>Let <var>reactions</var> be <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-4>custom element reaction
     queue</a>.</li><li>
      <p>Repeat until <var>reactions</var> is empty:</p>

      <ol><li>
        <p>Remove the first element of <var>reactions</var>, and let <var>reaction</var> be that
        element. Switch on <var>reaction</var>'s type:</p>

        <dl class=switch><dt><a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction-2>upgrade reaction</a><dd><a href=#concept-upgrade-an-element id=custom-element-reactions:concept-upgrade-an-element>Upgrade</a> <var>element</var> using
         <var>reaction</var>'s <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-4>custom element definition</a>.<dt><a href=#callback-reaction id=custom-element-reactions:callback-reaction-2>callback reaction</a><dd><a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=custom-element-reactions:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>reaction</var>'s
         callback function with <var>reaction</var>'s arguments, and with <var>element</var> as the
         <a href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value id=custom-element-reactions:dfn-callback-this-value data-x-internal=dfn-callback-this-value>callback this value</a>.</dl>

        <p>If this throws an exception, catch it, and <a id=custom-element-reactions:report-the-exception href=webappapis.html#report-the-exception>report the exception</a>.</p>
       </li></ol>
     </li></ol>
   </li></ol>

  <hr>

  <p>To ensure <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-4>custom element reactions</a> are
  triggered appropriately, we introduce the <dfn id=cereactions data-dfn-type=extended-attribute data-lt=CEReactions data-export=""><code>[CEReactions]</code></dfn> IDL <a id=custom-element-reactions:extended-attribute href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-extended-attribute data-x-internal=extended-attribute>extended
  attribute</a>. It indicates that the relevant algorithm is to be supplemented with additional
  steps in order to appropriately track and invoke <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-5>custom element reactions</a>.</p>

  <p>The <code id=custom-element-reactions:cereactions-2><a href=#cereactions>[CEReactions]</a></code> extended attribute must take no
  arguments, and must not appear on anything other than an operation, attribute, setter, or deleter.
  Additionally, it must not appear on readonly attributes.</p>

  <p>Operations, attributes, setters, or deleters annotated with the <code id=custom-element-reactions:cereactions-3><a href=#cereactions>[CEReactions]</a></code> extended attribute must run the following steps in place
  of the ones specified in their description:</p>

  <ol><li><p><a href=https://triple-underscore.github.io/infra-ja.html#stack-push id=custom-element-reactions:stack-push data-x-internal=stack-push>Push</a> a new <a href=#element-queue id=custom-element-reactions:element-queue-5>element queue</a> onto this object's
   <a id=custom-element-reactions:relevant-agent-3 href=webappapis.html#relevant-agent>relevant agent</a>'s <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-5>custom element reactions stack</a>.</li><li><p>Run the originally-specified steps for this construct, catching any exceptions. If the
   steps return a value, let <var>value</var> be the returned value. If they throw an exception, let
   <var>exception</var> be the thrown exception.</li><li><p>Let <var>queue</var> be the result of <a href=https://triple-underscore.github.io/infra-ja.html#stack-pop id=custom-element-reactions:stack-pop data-x-internal=stack-pop>popping</a> from this
   object's <a id=custom-element-reactions:relevant-agent-4 href=webappapis.html#relevant-agent>relevant agent</a>'s <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-6>custom element reactions stack</a>.</li><li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions-2>Invoke custom element reactions</a> in <var>queue</var>.</li><li><p>If an exception <var>exception</var> was thrown by the original steps, rethrow
   <var>exception</var>.</li><li><p>If a value <var>value</var> was returned from the original steps, return
   <var>value</var>.</li></ol>

  <div class=note>
   <p>The intent behind this extended attribute is somewhat subtle. One way of accomplishing its
   goals would be to say that every operation, attribute, setter, and deleter on the platform
   must have these steps inserted, and to allow implementers to optimize away
   unnecessary cases (where no DOM mutation is possible that could cause <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-6>custom element reactions</a> to occur).</p>

   <p>However, in practice this imprecision could lead to non-interoperable implementations of <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-7>custom element reactions</a>, as some implementations
   might forget to invoke these steps in some cases. Instead, we settled on the approach of
   explicitly annotating all relevant IDL constructs, as a way of ensuring interoperable behavior
   and helping implementations easily pinpoint all cases where these steps are necessary.</p>
  </div>

  <p>Any nonstandard APIs introduced by the user agent that could modify the DOM in such a way as to
  cause <a href=#enqueue-a-custom-element-callback-reaction id=custom-element-reactions:enqueue-a-custom-element-callback-reaction>enqueuing a custom element
  callback reaction</a> or <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-element-reactions:enqueue-a-custom-element-upgrade-reaction>enqueuing a
  custom element upgrade reaction</a>, for example by modifying any attributes or child elements,
  must also be decorated with the <code id=custom-element-reactions:cereactions-4><a href=#cereactions>[CEReactions]</a></code> attribute.</p>

  <div class=note>
   <p>As of the time of this writing, the following nonstandard or not-yet-standardized APIs are
   known to fall into this category:</p>

   <ul><li><p><code id=custom-element-reactions:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>'s <code>outerText</code> IDL attribute</li><li><p><code id=custom-element-reactions:htmlinputelement><a href=input.html#htmlinputelement>HTMLInputElement</a></code>'s <code>webkitdirectory</code> and <code>incremental</code> IDL attributes</li><li><p><code id=custom-element-reactions:htmllinkelement><a href=semantics.html#htmllinkelement>HTMLLinkElement</a></code>'s <code>disabled</code> and <code>scope</code> IDL attributes</li><li><p><code id=custom-element-reactions:shadowroot><a data-x-internal=shadowroot href=https://triple-underscore.github.io/DOM4-ja.html#interface-shadowroot>ShadowRoot</a></code>'s <code>innerHTML</code> IDL attribute</li></ul>
  </div>

  


  <nav><a href=canvas.html>← 4.12.5 canvas要素</a> – <a href=./>目次</a> – <a href=semantics-other.html>4.14 専用要素なしの一般的語彙 →</a></nav>
</body></html>